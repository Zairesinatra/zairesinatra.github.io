<!DOCTYPE html>
<html lang="en">
<head>

    <title>NodeJS</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="../assets/built/screen.css%3Fv=ab47967965.css" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.18.2/tocbot.css">
    <link rel="stylesheet" type="text/css" href="../assets/css/screen.css%3Fv=ab47967965.css" />
    <meta name="description" content="Atwood 定律：任何能够用 JavaScript 实现的应用系统，最终都必将用 JavaScript 实现。" />
    <link rel="icon" href="../content/images/size/w256h256/2021/07/ghost-orb.png" type="image/png" />
    <link rel="canonical" href="index.html" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="amp/index.html" />
    
    <meta property="og:site_name" content="zairesinatra" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="NodeJS" />
    <meta property="og:description" content="Atwood 定律：任何能够用 JavaScript 实现的应用系统，最终都必将用 JavaScript 实现。" />
    <meta property="og:url" content="yourdomain.com/node/" />
    <meta property="og:image" content="yourdomain.com/content/images/2021/11/NodeJS.jpg" />
    <meta property="article:published_time" content="2021-07-08T15:02:00.000Z" />
    <meta property="article:modified_time" content="2022-07-03T14:25:45.000Z" />
    <meta property="article:tag" content="Technology growth" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="NodeJS" />
    <meta name="twitter:description" content="Atwood 定律：任何能够用 JavaScript 实现的应用系统，最终都必将用 JavaScript 实现。" />
    <meta name="twitter:url" content="yourdomain.com/node/" />
    <meta name="twitter:image" content="yourdomain.com/content/images/2021/11/NodeJS.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Ziyi Xie" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Technology growth" />
    <meta name="twitter:site" content="@xieziyi0422" />
    <meta property="og:image:width" content="2000" />
    <meta property="og:image:height" content="1125" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "zairesinatra",
        "url": "yourdomain.com/",
        "logo": {
            "@type": "ImageObject",
            "url": "yourdomain.com/content/images/2021/07/zs-1.JPG",
            "width": 60,
            "height": 60
        }
    },
    "author": {
        "@type": "Person",
        "name": "Ziyi Xie",
        "image": {
            "@type": "ImageObject",
            "url": "yourdomain.com/content/images/2021/07/zs-2.JPG",
            "width": 1079,
            "height": 1079
        },
        "url": "yourdomain.com/author/ziyi/",
        "sameAs": []
    },
    "headline": "NodeJS",
    "url": "yourdomain.com/node/",
    "datePublished": "2021-07-08T15:02:00.000Z",
    "dateModified": "2022-07-03T14:25:45.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "yourdomain.com/content/images/2021/11/NodeJS.jpg",
        "width": 2000,
        "height": 1125
    },
    "keywords": "Technology growth",
    "description": "Atwood 定律：任何能够用 JavaScript 实现的应用系统，最终都必将用 JavaScript 实现。",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "yourdomain.com/"
    }
}
    </script>

    <meta name="generator" content="Ghost 5.2" />
    <link rel="alternate" type="application/rss+xml" title="zairesinatra" href="../rss/index.html" />
    <script defer src="https://unpkg.com/@tryghost/portal@~2.2.0/umd/portal.min.js" data-ghost="yourdomain.com/" data-key="f5d74add11f1d16d3e59c12945" data-api="yourdomain.com/ghost/api/content/" crossorigin="anonymous"></script><style id="gh-members-styles">.gh-post-upgrade-cta-content,
.gh-post-upgrade-cta {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    text-align: center;
    width: 100%;
    color: #ffffff;
    font-size: 16px;
}

.gh-post-upgrade-cta-content {
    border-radius: 8px;
    padding: 40px 4vw;
}

.gh-post-upgrade-cta h2 {
    color: #ffffff;
    font-size: 28px;
    letter-spacing: -0.2px;
    margin: 0;
    padding: 0;
}

.gh-post-upgrade-cta p {
    margin: 20px 0 0;
    padding: 0;
}

.gh-post-upgrade-cta small {
    font-size: 16px;
    letter-spacing: -0.2px;
}

.gh-post-upgrade-cta a {
    color: #ffffff;
    cursor: pointer;
    font-weight: 500;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a:hover {
    color: #ffffff;
    opacity: 0.8;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a.gh-btn {
    display: block;
    background: #ffffff;
    text-decoration: none;
    margin: 28px 0 0;
    padding: 8px 18px;
    border-radius: 4px;
    font-size: 16px;
    font-weight: 600;
}

.gh-post-upgrade-cta a.gh-btn:hover {
    opacity: 0.92;
}</style>
    <script defer src="../public/cards.min.js%3Fv=ab47967965"></script>
    <link rel="stylesheet" type="text/css" href="../public/cards.min.css%3Fv=ab47967965.css">
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Q4HQV7NBSG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'G-Q4HQV7NBSG');
</script>

<!-- 2022 prismjs update -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/themes/prism-tomorrow.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/toolbar/prism-toolbar.min.css" rel="stylesheet">

<script>
window.addEventListener('DOMContentLoaded', (event) => {      
    document.querySelectorAll('pre[class*=language-]').forEach(function(node) {
        node.classList.add('line-numbers');
	});
    Prism.highlightAll();
});
</script>

<!-- prism -->
<style>
pre[class*="language-"] {
    margin: 0 0 1.5em !important;
}
pre[class*="line-numbers"]>code {
    padding: 0 ;
}
code {
    text-shadow: none !important;
}
.token.operator {
    background: none !important;
}

:not(pre)>code[class*="language-"],
pre[class*="language-"] {
    background: #202124 !important;
}
</style>

<!-- customer theme by zs -->
<style>
/* Generated with http://k88hudson.github.io/syntax-highlighting-theme-generator/www */
/* http://k88hudson.github.io/react-markdocs */
/**
 * @author k88hudson
 *
 * Based on prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */
/*********************************************************
* General
*/
pre[class*="language-"],
code[class*="language-"] {
  color: #d98e73;
  font-size: 13px;
  text-shadow: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  direction: ltr;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  line-height: 1.5;
  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;
  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}
pre[class*="language-"]::selection,
code[class*="language-"]::selection,
pre[class*="language-"]::mozselection,
code[class*="language-"]::mozselection {
  text-shadow: none;
  background: #b3d4fc;
}
@media print {
  pre[class*="language-"],
  code[class*="language-"] {
    text-shadow: none;
  }
}
pre[class*="language-"] {
  padding: 1em;
  margin: .5em 0;
  overflow: auto;
  background: #1e1e1f;
}
:not(pre) > code[class*="language-"] {
  padding: .1em .3em;
  border-radius: .3em;
  color: #db4c69;
  background: #f9f2f4;
}
/*********************************************************
* Tokens
*/
.namespace {
  opacity: .7;
}
.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
  color: #93a1a1;
}
.token.punctuation {
  color: #f3f3f3;
}
.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
  color: #88deff;
}
.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
  color: #ddb974;
}
.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
  color: #f3f3f3;
  background: #1e1e1f;
}
.token.atrule,
.token.attr-value,
.token.keyword {
  color: #06b4fe;
}
.token.function {
  color: #80caf1;
}
.token.regex,
.token.important,
.token.variable {
  color: #ee9900;
}
.token.important,
.token.bold {
  font-weight: bold;
}
.token.italic {
  font-style: italic;
}
.token.entity {
  cursor: help;
}
/*********************************************************
* Line highlighting
*/
pre[data-line] {
  position: relative;
}
pre[class*="language-"] > code[class*="language-"] {
  position: relative;
  z-index: 1;
}
.line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: #1e1e1f;
  box-shadow: inset 5px 0 0 #1e1e1f;
  z-index: 0;
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}
</style>

<!-- 音乐播放器 -->
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><style>:root {--ghost-accent-color: #15171A;}</style>

</head>
<body class="post-template tag-technology-growth has-cover">
<div class="viewport">

    <header id="gh-head" class="gh-head outer">
        <nav class="gh-head-inner inner">

            <div class="gh-head-brand">
                <a class="gh-head-logo" href="../index.html">
                        <img src="../content/images/2021/07/zs-1.JPG" alt="zairesinatra" />
                </a>
                <a class="gh-burger" role="button">
                    <div class="gh-burger-box">
                        <div class="gh-burger-inner"></div>
                    </div>
                </a>
            </div>
            <div class="gh-head-menu">
                <ul class="nav">
    <li class="nav-home"><a href="../index.html">Home</a></li>
    <li class="nav-welcome"><a href="../welcome/index.html">Welcome</a></li>
    <li class="nav-author"><a href="../selfintro/index.html">Author</a></li>
    <li class="nav-tag"><a href="../tag/index.html">Tag</a></li>
    <li class="nav-links"><a href="http://nav.zairesinatra.com/">Links</a></li>
</ul>

            </div>
            <div class="gh-head-actions">
                <div class="gh-social">
                        <a class="gh-social-link gh-social-twitter" href="https://twitter.com/xieziyi0422" title="Twitter" target="_blank" rel="noopener"><svg class="icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><path d="M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z"/></svg></a>
                </div>
                        <a class="gh-head-button" href="index.html#/portal/signup" data-portal="signup">Subscribe</a>
            </div>
        </nav>
    </header>

    <div class="site-content">
        



<main id="site-main" class="site-main">
<article class="article post tag-technology-growth ">

    <header class="article-header gh-canvas">

        <div class="article-tag post-card-tags">
                <span class="post-card-primary-tag">
                    <a href="../tag/technology-growth/index.html">Technology growth</a>
                </span>
        </div>

        <h1 class="article-title">NodeJS</h1>

            <p class="article-excerpt">Atwood 定律：任何能够用 JavaScript 实现的应用系统，最终都必将用 JavaScript 实现。</p>

        <div class="article-byline">
        <section class="article-byline-content">

            <ul class="author-list">
                <li class="author-list-item">
                    <a href="../author/ziyi/index.html" class="author-avatar">
                        <img class="author-profile-image" src="../content/images/size/w100/2021/07/zs-2.JPG" alt="Ziyi Xie" />
                    </a>
                </li>
            </ul>

            <div class="article-byline-meta">
                <h4 class="author-name"><a href="../author/ziyi/index.html">Ziyi Xie</a></h4>
                <div class="byline-meta-content">
                    <time class="byline-meta-date" datetime="2021-07-08">Jul 8, 2021</time>
                        <span class="byline-reading-time"><span class="bull">&bull;</span> 22 min read</span>
                </div>
            </div>

        </section>
        </div>

            <figure class="article-image">
                <img
                    srcset="../content/images/size/w2000/2021/11/NodeJS.jpg 2000w"
                    sizes="(min-width: 1400px) 1400px, 92vw"
                    src="../content/images/size/w2000/2021/11/NodeJS.jpg"
                    alt="NodeJS"
                />
                    <figcaption>NodeJS</figcaption>
            </figure>

    </header>

    <section class="gh-content gh-canvas">
        <aside class="toc-container">
            <div class="toc"></div>
        </aside>
        <!--kg-card-begin: markdown--><h2 id="%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B">快速上手</h2>
<h3 id="%E6%B5%8F%E8%A7%88%E5%99%A8%E5%86%85%E6%A0%B8">浏览器内核</h3>
<blockquote>
<p>=&gt; 主流浏览器内核组成<br>
IE 到 Edge 浏览器 =&gt; Trident 转向 Blink<br>
Chrome 浏览器 =&gt; Webkit 转向 Blink -&gt; 统称为 Chromium<br>
Firefox 浏览器 =&gt; Gecko<br>
Safari 浏览器 =&gt; Webkit<br>
Opera 浏览器 =&gt; Presto 变更为 Webkit，现在转向 Blink<br>
事实上，常说的浏览器内核指的是浏览器排版引擎 layout engine，也称为浏览器引、页面渲染引擎或样板引擎</p>
</blockquote>
<ul>
<li>浏览器内核负责对网页语法的解释以及渲染网页，通常由渲染引擎和 JS 引擎两部分组成</li>
<li>Webkit 中是 WebCore 负责 HTML 解析、布局、渲染；JavaScriptCore 负责解析，执行 JS 代码</li>
</ul>
<h3 id="%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E8%BF%87%E7%A8%8B">浏览器渲染过程</h3>
<p>在浏览网页过程中，所有资源并非一捆下载，而是解析时到具体的标签时，再去相应的定位处下载资源。</p>
<ul>
<li>进入页面 HTML 被首先下载，HTML Parser 开始解析标签并生成 DOM Tree</li>
<li>DOM Tree 生成时会有 JS 引擎帮助解析 JavaScript 代码对 DOM 进行操作</li>
<li>因 HTML 的解析过程是自上而下的，所以在遇见 &lt;link&gt; 标签表示的 CSS 样式时，会根据 CSS Paser 生成对应的 CSS Rules 并与 DOM Tree 结合产生 Render Tree</li>
<li>Render Tree 在生成时会根据 Layout Engine 进行针对浏览器状态的适配调整，并在完成后进行 Painting 与 Display</li>
<li>HTML 解析过程中遇见 JavaScript 会停止解析，不同于 CSS 异步加载执行，因为 JavaScript 代码可以操作 DOM</li>
</ul>
<div style="overflow:scroll">
<svg id="SvgjsSvg1006" width="1051" height="474" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1007"><marker id="SvgjsMarker1078" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1079" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1082" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1083" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1086" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1087" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1090" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1091" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1094" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1095" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1098" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1099" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1102" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1103" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1112" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1113" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1116" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1117" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1120" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1121" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1124" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1125" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker></defs><g id="SvgjsG1008" transform="translate(25,143)"><path id="SvgjsPath1009" d="M 0 61.666666666666664L 0 0L 100 0L 100 61.666666666666664Q 75 45 50 61.666666666666664Q 25 78.33333333333333 0 61.666666666666664Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1010"><text id="SvgjsText1011" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="100px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="20.875" transform="rotate(0)"><tspan id="SvgjsTspan1012" dy="16" x="50"><tspan id="SvgjsTspan1013" style="text-decoration:;">HTML</tspan></tspan></text></g></g><g id="SvgjsG1014" transform="translate(204,143)"><path id="SvgjsPath1015" d="M 0 0L 100 0L 100 70L 0 70Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1016"><text id="SvgjsText1017" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="24.375" transform="rotate(0)"><tspan id="SvgjsTspan1018" dy="16" x="50"><tspan id="SvgjsTspan1019" style="text-decoration:;">HTML Parser</tspan></tspan></text></g></g><g id="SvgjsG1020" transform="translate(383,143)"><path id="SvgjsPath1021" d="M 23.333333333333332 0L 100 0L 76.66666666666667 70L 0 70L 23.333333333333332 0Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1022"><text id="SvgjsText1023" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="70px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="24.375" transform="rotate(0)"><tspan id="SvgjsTspan1024" dy="16" x="50"><tspan id="SvgjsTspan1025" style="text-decoration:;">DOM Tree</tspan></tspan></text></g></g><g id="SvgjsG1026" transform="translate(383,261)"><path id="SvgjsPath1027" d="M 0 0L 100 0L 100 70L 0 70Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1028"><text id="SvgjsText1029" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="24.375" transform="rotate(0)"><tspan id="SvgjsTspan1030" dy="16" x="50"><tspan id="SvgjsTspan1031" style="text-decoration:;">Attachment</tspan></tspan></text></g></g><g id="SvgjsG1032" transform="translate(383,379)"><path id="SvgjsPath1033" d="M 23.333333333333332 0L 100 0L 76.66666666666667 70L 0 70L 23.333333333333332 0Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1034"><text id="SvgjsText1035" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="70px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="24.375" transform="rotate(0)"><tspan id="SvgjsTspan1036" dy="16" x="50"><tspan id="SvgjsTspan1037" style="text-decoration:;">Style Rules</tspan></tspan></text></g></g><g id="SvgjsG1038" transform="translate(204,379)"><path id="SvgjsPath1039" d="M 0 0L 100 0L 100 70L 0 70Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1040"><text id="SvgjsText1041" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="24.375" transform="rotate(0)"><tspan id="SvgjsTspan1042" dy="16" x="50"><tspan id="SvgjsTspan1043" style="text-decoration:;">CSS Parser</tspan></tspan></text></g></g><g id="SvgjsG1044" transform="translate(25,379)"><path id="SvgjsPath1045" d="M 0 61.666666666666664L 0 0L 100 0L 100 61.666666666666664Q 75 45 50 61.666666666666664Q 25 78.33333333333333 0 61.666666666666664Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1046"><text id="SvgjsText1047" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="100px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="20.875" transform="rotate(0)"><tspan id="SvgjsTspan1048" dy="16" x="50"><tspan id="SvgjsTspan1049" style="text-decoration:;">CSS</tspan></tspan></text></g></g><g id="SvgjsG1050" transform="translate(564,256)"><path id="SvgjsPath1051" d="M 23.333333333333332 0L 100 0L 76.66666666666667 70L 0 70L 23.333333333333332 0Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1052"><text id="SvgjsText1053" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="70px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="15.875" transform="rotate(0)"><tspan id="SvgjsTspan1054" dy="16" x="50"><tspan id="SvgjsTspan1055" style="text-decoration:;">Render</tspan></tspan><tspan id="SvgjsTspan1056" dy="16" x="50"><tspan id="SvgjsTspan1057" style="text-decoration:;">Tree</tspan></tspan></text></g></g><g id="SvgjsG1058" transform="translate(564,143)"><path id="SvgjsPath1059" d="M 0 0L 100 0L 100 70L 0 70Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1060"><text id="SvgjsText1061" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="24.375" transform="rotate(0)"><tspan id="SvgjsTspan1062" dy="16" x="50"><tspan id="SvgjsTspan1063" style="text-decoration:;">Layout</tspan></tspan></text></g></g><g id="SvgjsG1064" transform="translate(745,256)"><path id="SvgjsPath1065" d="M 0 0L 100 0L 100 70L 0 70Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1066"><text id="SvgjsText1067" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="24.375" transform="rotate(0)"><tspan id="SvgjsTspan1068" dy="16" x="50"><tspan id="SvgjsTspan1069" style="text-decoration:;">Painting</tspan></tspan></text></g></g><g id="SvgjsG1070" transform="translate(926,266)"><path id="SvgjsPath1071" d="M 16.666666666666668 0L 83.33333333333333 0C 105.55555555555556 0 105.55555555555556 50 83.33333333333333 50L 16.666666666666668 50C -5.555555555555556 50 -5.555555555555556 0 16.666666666666668 0Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1072"><text id="SvgjsText1073" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="14.375" transform="rotate(0)"><tspan id="SvgjsTspan1074" dy="16" x="50"><tspan id="SvgjsTspan1075" style="text-decoration:;">Display</tspan></tspan></text></g></g><g id="SvgjsG1076"><path id="SvgjsPath1077" d="M126 178L164.5 178L164.5 178L200.39999999999998 178" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1078)"></path></g><g id="SvgjsG1080"><path id="SvgjsPath1081" d="M126 414L164.5 414L164.5 414L200.39999999999998 414" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1082)"></path></g><g id="SvgjsG1084"><path id="SvgjsPath1085" d="M305 178L349.33333333333337 178L349.33333333333337 178L391.06666666666666 178" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1086)"></path></g><g id="SvgjsG1088"><path id="SvgjsPath1089" d="M305 414L349.33333333333337 414L349.33333333333337 414L391.06666666666666 414" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1090)"></path></g><g id="SvgjsG1092"><path id="SvgjsPath1093" d="M484 296L528.8807403920117 296L528.8807403920117 295.8117333157177L571.1614807840234 295.8117333157177" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1094)"></path></g><g id="SvgjsG1096"><path id="SvgjsPath1097" d="M653.3333333333334 291L698.6666666666667 291L698.6666666666667 291L741.4 291" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1098)"></path></g><g id="SvgjsG1100"><path id="SvgjsPath1101" d="M846 291L885.5 291L885.5 291L922.4 291" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1102)"></path></g><g id="SvgjsG1104" transform="translate(383,25)"><path id="SvgjsPath1105" d="M 0 0L 100 0L 100 70L 0 70Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1106"><text id="SvgjsText1107" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="24.375" transform="rotate(0)"><tspan id="SvgjsTspan1108" dy="16" x="50"><tspan id="SvgjsTspan1109" style="text-decoration:;">DOM</tspan></tspan></text></g></g><g id="SvgjsG1110"><path id="SvgjsPath1111" d="M433 96L433 119L433 119L433 139.4" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1112)"></path></g><g id="SvgjsG1114"><path id="SvgjsPath1115" d="M433 214L433 237L433 237L433 257.4" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1116)"></path></g><g id="SvgjsG1118"><path id="SvgjsPath1119" d="M433 378L433 355L433 355L433 334.6" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1120)"></path></g><g id="SvgjsG1122"><path id="SvgjsPath1123" d="M614 214L614 234.5L614 234.5L614 252.39999999999998" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1124)"></path></g></svg>
</div>
<h3 id="javascript-engine">JavaScript Engine</h3>
<p>高级的编程语言最终都是需要转成机器指令来执行的。JavaScript 无论是交给浏览器还是 Node.JS，最后都是需要只认识机器语言指令集的 CPU 执行。所以需要 JS 引擎帮助将 JavaScript 代码翻译成 CPU 指令进行执行。</p>
<blockquote>
<p>=&gt; 常见 JavaScript Engine<br>
SpiderMonkey =&gt; The first JavaScript engine &amp; Developed by Brendan Eich<br>
Chakra =&gt; 微软开发并用于 IE 浏览器<br>
JavaScriptCore =&gt; Apple 开发并用于 WebKit<br>
v8 =&gt; Google 开发用于 Chromium</p>
</blockquote>
<h3 id="v8-%E5%BC%95%E6%93%8E%E5%8E%9F%E7%90%86">V8 引擎原理</h3>
<p>C++ 编写的 <a href="https://v8.dev/">V8 engine</a> 由 Google 开源，是高性能 JS 和 WebAssembly 引擎，用于 Chrome 和 Node 等。V8 可以独立运行，也可以嵌入到任何 C++ 应用程序中。</p>
<blockquote>
<p>V8 engine implements ECMAScript and WebAssembly, and runs on Windows 7 or later, macOS 10.12+, and Linux systems that use x64, IA-32, ARM, or MIPS processors.</p>
<ul>
<li>ECMAScript is a Standard for scripting languages such as JavaScript, JScript, etc. It is a trademark scripting language specification. JavaScript is a language based on ECMAScript. A standard for scripting languages like JavaScript, JScript is ECMAScript.</li>
<li>WebAssembly (abbreviated Wasm) is a binary instruction format for a stack-based virtual machine. Wasm is designed as a portable compilation target for programming languages, enabling deployment on the web for client and server applications.</li>
</ul>
</blockquote>
<p>JS 经过<a href="https://esprima.org/">词法分析</a>生成由 type 与 value 组成的对象并存储在 tokens 数组。随后的语法分析生成 <a href="https://astexplorer.net/">AST</a> 抽象语法树。</p>
<p>类似 Babel 将 TS 转为 JS，也是先生成 Abstract Syntax Tree 并作出相应修改，产生 new Abstract Syntax Tree，再 generate code 为 JS。</p>
<p>同理 Vue 中 Template 也是先转换成 Abstract Syntax Tree 再 CreateVNode 虚拟节点，最后产生 JS。</p>
<pre><code class="language-js">const name = 'zs'
/* 词法分析 */
[
  { type: 'Keyword', value: 'const' },
  { type: 'Identifier', value: 'name' },
  { type: 'Punctuator', value: '=' },
  { type: 'String', value: &quot;'zs'&quot; }
]

/* 语法分析 */
{
  &quot;type&quot;: &quot;Program&quot;,
  &quot;start&quot;: 0,
  &quot;end&quot;: 17,
  &quot;body&quot;: [
    {
      &quot;type&quot;: &quot;VariableDeclaration&quot;,
      &quot;start&quot;: 0,
      &quot;end&quot;: 17,
      &quot;declarations&quot;: [
        {
          &quot;type&quot;: &quot;VariableDeclarator&quot;,
          &quot;start&quot;: 6,
          &quot;end&quot;: 17,
          &quot;id&quot;: {
            &quot;type&quot;: &quot;Identifier&quot;,
            &quot;start&quot;: 6,
            &quot;end&quot;: 10,
            &quot;name&quot;: &quot;name&quot;
          },
          &quot;init&quot;: {
            &quot;type&quot;: &quot;Literal&quot;,
            &quot;start&quot;: 13,
            &quot;end&quot;: 17,
            &quot;value&quot;: &quot;zs&quot;,
            &quot;raw&quot;: &quot;'zs'&quot;
          }
        }
      ],
      &quot;kind&quot;: &quot;const&quot;
    }
  ],
  &quot;sourceType&quot;: &quot;module&quot;
}
</code></pre>
<div style="overflow:scroll">
<svg id="SvgjsSvg1006" width="1097" height="426" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1007"><marker id="SvgjsMarker1060" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1061" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1064" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1065" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1068" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1069" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1072" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1073" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1076" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1077" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1080" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1081" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1084" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1085" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1088" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1089" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1092" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1093" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1108" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1109" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker></defs><g id="SvgjsG1008" transform="translate(25,81)"><path id="SvgjsPath1009" d="M 0 4Q 0 0 4 0L 96 0Q 100 0 100 4L 100 66Q 100 70 96 70L 4 70Q 0 70 0 66Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1010"><text id="SvgjsText1011" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="24.375" transform="rotate(0)"><tspan id="SvgjsTspan1012" dy="16" x="50"><tspan id="SvgjsTspan1013" style="text-decoration:;">JS 源代码</tspan></tspan></text></g></g><g id="SvgjsG1014" transform="translate(214,81)"><path id="SvgjsPath1015" d="M 23.333333333333332 0L 100 0L 76.66666666666667 70L 0 70L 23.333333333333332 0Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1016"><text id="SvgjsText1017" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="70px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="24.375" transform="rotate(0)"><tspan id="SvgjsTspan1018" dy="16" x="50"><tspan id="SvgjsTspan1019" style="text-decoration:;">Parse</tspan></tspan></text></g></g><g id="SvgjsG1020" transform="translate(403,81)"><path id="SvgjsPath1021" d="M 0 4Q 0 0 4 0L 96 0Q 100 0 100 4L 100 66Q 100 70 96 70L 4 70Q 0 70 0 66Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1022"><text id="SvgjsText1023" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="15.875" transform="rotate(0)"><tspan id="SvgjsTspan1024" dy="16" x="50"><tspan id="SvgjsTspan1025" style="text-decoration:;">AST</tspan></tspan><tspan id="SvgjsTspan1026" dy="16" x="50"><tspan id="SvgjsTspan1027" style="text-decoration:;">抽象语法树</tspan></tspan></text></g></g><g id="SvgjsG1028" transform="translate(592,81)"><path id="SvgjsPath1029" d="M 23.333333333333332 0L 100 0L 76.66666666666667 70L 0 70L 23.333333333333332 0Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1030"><text id="SvgjsText1031" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="70px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="24.375" transform="rotate(0)"><tspan id="SvgjsTspan1032" dy="16" x="50"><tspan id="SvgjsTspan1033" style="text-decoration:;">Ignition</tspan></tspan></text></g></g><g id="SvgjsG1034" transform="translate(592,331)"><path id="SvgjsPath1035" d="M 23.333333333333332 0L 100 0L 76.66666666666667 70L 0 70L 23.333333333333332 0Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1036"><text id="SvgjsText1037" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="70px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="24.375" transform="rotate(0)"><tspan id="SvgjsTspan1038" dy="16" x="50"><tspan id="SvgjsTspan1039" style="text-decoration:;">TurboFan</tspan></tspan></text></g></g><g id="SvgjsG1040" transform="translate(781,81)"><path id="SvgjsPath1041" d="M 0 4Q 0 0 4 0L 96 0Q 100 0 100 4L 100 66Q 100 70 96 70L 4 70Q 0 70 0 66Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1042"><text id="SvgjsText1043" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="15.875" transform="rotate(0)"><tspan id="SvgjsTspan1044" dy="16" x="50"><tspan id="SvgjsTspan1045" style="text-decoration:;">bytecode</tspan></tspan><tspan id="SvgjsTspan1046" dy="16" x="50"><tspan id="SvgjsTspan1047" style="text-decoration:;">字节码</tspan></tspan></text></g></g><g id="SvgjsG1048" transform="translate(781,331)"><path id="SvgjsPath1049" d="M 0 4Q 0 0 4 0L 96 0Q 100 0 100 4L 100 66Q 100 70 96 70L 4 70Q 0 70 0 66Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1050"><text id="SvgjsText1051" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="7.875" transform="rotate(0)"><tspan id="SvgjsTspan1052" dy="16" x="50"><tspan id="SvgjsTspan1053" style="text-decoration:;">Machine</tspan></tspan><tspan id="SvgjsTspan1054" dy="16" x="50"><tspan id="SvgjsTspan1055" style="text-decoration:;">Code优化的</tspan></tspan><tspan id="SvgjsTspan1056" dy="16" x="50"><tspan id="SvgjsTspan1057" style="text-decoration:;">机器码</tspan></tspan></text></g></g><g id="SvgjsG1058"><path id="SvgjsPath1059" d="M126 116L175.33333333333337 116L175.33333333333337 116L222.06666666666666 116" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1060)"></path></g><g id="SvgjsG1062"><path id="SvgjsPath1063" d="M303.3333333333333 116L352.66666666666663 116L352.66666666666663 116L399.4 116" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1064)"></path></g><g id="SvgjsG1066"><path id="SvgjsPath1067" d="M504 116L553.3333333333333 116L553.3333333333333 116L600.0666666666666 116" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1068)"></path></g><g id="SvgjsG1070"><path id="SvgjsPath1071" d="M681.3333333333334 116L730.6666666666667 116L730.6666666666667 116L777.4 116" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1072)"></path></g><g id="SvgjsG1074"><path id="SvgjsPath1075" d="M882 116L930.8333333333335 116L930.8333333333335 116L980.6666666666667 116" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1076)"></path></g><g id="SvgjsG1078"><path id="SvgjsPath1079" d="M681.3333333333334 366L730.6666666666667 366L730.6666666666667 366L777.4 366" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1080)"></path></g><g id="SvgjsG1082"><path id="SvgjsPath1083" d="M642 152L642 241L642 241L642 327.4" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1084)"></path></g><g id="SvgjsG1086"><path id="SvgjsPath1087" d="M831 330L831 241L831 241L831 154.6" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1088)"></path></g><g id="SvgjsG1090"><path id="SvgjsPath1091" d="M882 366L932.3333333333335 366L932.3333333333335 366L983.6666666666667 366" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1092)"></path></g><g id="SvgjsG1094" transform="translate(952,96)"><path id="SvgjsPath1095" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1096"><text id="SvgjsText1097" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="9.375" transform="rotate(0)"><tspan id="SvgjsTspan1098" dy="16" x="60"><tspan id="SvgjsTspan1099" style="text-decoration:;">运行结果</tspan></tspan></text></g></g><g id="SvgjsG1100" transform="translate(952,346)"><path id="SvgjsPath1101" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1102"><text id="SvgjsText1103" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="9.375" transform="rotate(0)"><tspan id="SvgjsTspan1104" dy="16" x="60"><tspan id="SvgjsTspan1105" style="text-decoration:;">运行结果</tspan></tspan></text></g></g><g id="SvgjsG1106"><path id="SvgjsPath1107" d="M791 152L791 241L673 241L673 327.4" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1108)"></path></g><g id="SvgjsG1110" transform="translate(844,225.25)"><path id="SvgjsPath1111" d="M 0 0L 162 0L 162 41L 0 41Z" stroke="none" fill="none"></path><g id="SvgjsG1112"><text id="SvgjsText1113" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="162px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1.375" transform="rotate(0)"><tspan id="SvgjsTspan1114" dy="16" x="81"><tspan id="SvgjsTspan1115" style="text-decoration:;">Deoptimization =&gt;</tspan></tspan><tspan id="SvgjsTspan1116" dy="16" x="81"><tspan id="SvgjsTspan1117" style="text-decoration:;">函数传入不同类型参数</tspan></tspan></text></g></g><g id="SvgjsG1118" transform="translate(592,25)"><path id="SvgjsPath1119" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1120"><text id="SvgjsText1121" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="0.875" transform="rotate(0)"><tspan id="SvgjsTspan1122" dy="16" x="60"><tspan id="SvgjsTspan1123" style="text-decoration:;">an interpreter</tspan></tspan><tspan id="SvgjsTspan1124" dy="16" x="60"><tspan id="SvgjsTspan1125" style="text-decoration:;">不确定转换的机器码</tspan></tspan></text></g></g><g id="SvgjsG1126" transform="translate(741.5,35)"><path id="SvgjsPath1127" d="M 0 0L 183.5 0L 183.5 25L 0 25Z" stroke="none" fill="none"></path><g id="SvgjsG1128"><text id="SvgjsText1129" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="184px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-6.625" transform="rotate(0)"><tspan id="SvgjsTspan1130" dy="16" x="92"><tspan id="SvgjsTspan1131" style="text-decoration:;">跨平台；不同环境不同 cpu 架</tspan></tspan><tspan id="SvgjsTspan1132" dy="16" x="92"><tspan id="SvgjsTspan1133" style="text-decoration:;">构，执行的机器指令也不一样</tspan></tspan></text></g></g><g id="SvgjsG1134" transform="translate(857,120.5)"><path id="SvgjsPath1135" d="M 0 0L 179 0L 179 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1136"><text id="SvgjsText1137" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="179px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="9.375" transform="rotate(0)"><tspan id="SvgjsTspan1138" dy="16" x="89.5"><tspan id="SvgjsTspan1139" style="text-decoration:;">转汇编再转机器指令</tspan></tspan></text></g></g><g id="SvgjsG1140" transform="translate(513,213)"><path id="SvgjsPath1141" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1142"><text id="SvgjsText1143" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-7.125" transform="rotate(0)"><tspan id="SvgjsTspan1144" dy="16" x="60"><tspan id="SvgjsTspan1145" style="text-decoration:;">逐个对函数编译，收</tspan></tspan><tspan id="SvgjsTspan1146" dy="16" x="60"><tspan id="SvgjsTspan1147" style="text-decoration:;">集函数执行频率信息</tspan></tspan><tspan id="SvgjsTspan1148" dy="16" x="60"><tspan id="SvgjsTspan1149" style="text-decoration:;">并用于推测性优化</tspan></tspan></text></g></g><g id="SvgjsG1150" transform="translate(214,27.5)"><path id="SvgjsPath1151" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1152"><text id="SvgjsText1153" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="9.375" transform="rotate(0)"><tspan id="SvgjsTspan1154" dy="16" x="60"><tspan id="SvgjsTspan1155" style="text-decoration:;">词法分析、语法分析</tspan></tspan></text></g></g></svg>
</div>
<p><a href="https://v8.dev/blog/scanner">官方 V8 引擎原理</a>中是通过 Blink 将源码交给 V8 engine，以 Stream 获取到源码并且进行编码转换；Scanner 进行词法分析生成 tokens，再经过 Parser 和 PreParser 转换成 AST。不同于前者的直接解析转换，后者是预解析，因为并不是所有的 JS 代码在一开始时就会被执行，所以通过延迟解析将不必要的函数进行预解析（函数的全量解析是在函数被调用时才进行 =&gt; 函数 outer 内部定义函数 inner，那 inner 函数就会进行预解析）。生成的抽象语法树会被 Ignition 转成字节码后执行。</p>
<h3 id="%E9%AB%98%E5%85%89%E6%97%B6%E5%88%BB">高光时刻</h3>
<p>NodeJS 有两个高光特性，非阻塞 IO 与事件驱动。</p>
<ul>
<li>非阻塞 IO 模型</li>
</ul>
<p>测试一下测试一下测试一下测试一下测试一下测试一下测试一下测试一下测试一下测试一下测试一下测试一下测试一下测试一下测试一下测试一下测试一下测试一下</p>
<blockquote>
<p>IO 即计算机输入输出，常见有外接硬件、磁盘读写、网络传输甚至数据库操作。</p>
</blockquote>
<p>阻塞 IO 就是进行 IO 操作时，进程处于休眠状态，等待 IO 操作完成再进行下一次的操作。</p>
<p>顾名思义，非阻塞 IO 就是在程序遇见 IO 操作时，主程序不必等待底层 IO 返回结果，直接执行下一步指令，IO 操作完毕再通知主进程即可。通知可以理解为在 IO 操作后，触发一个事件函数使主进程得到响应。</p>
<ul>
<li>事件驱动</li>
</ul>
<p>区别于 Nginx 多进程单线程，NodeJS 通过事件驱动的方式处理请求时无需为每一个请求创建额外的线程。每一个 IO 操作都会被添加到事件队列中，线程循环地处理队列上的工作任务，当执行过程中遇到阻塞，线程不会停下来等待结果，而是留下一个处理结果的回调函数，转而继续执行队列中的下一个任务。这个传递到队列中的回调函数在阻塞任务运行结束后才被线程调用。</p>
<h3 id="repl-read-eval-print-loop">REPL Read-Eval-Print Loop</h3>
<p>REPL 即读取-求值-输出循环，可以简单理解为一个交互式编程环境。</p>
<pre><code class="language-shell">$ node
Welcome to Node.js v14.17.1.
Type &quot;.help&quot; for more information.
$ process
process { version: 'v14.17.1', versions: { node: '14.17.1', v8: '8.4.371.23-...
</code></pre>
<pre><code class="language-javascript">node index.js zszszs age=22 // 给 node 传参使用 process 内置对象的 argv(argument vector) 接收
console.trace(); // 打印函数调用栈
</code></pre>
<h3 id="io-%E5%AF%86%E9%9B%86%E4%B8%8E-web-%E5%BC%80%E5%8F%91">IO 密集与 WEB 开发</h3>
<ul>
<li>IO 密集与 CPU 密集</li>
</ul>
<p>CPU 密集 =&gt; 程序大部分时间用于处理逻辑运算、文件压缩解压与数据加密解密</p>
<p>IO 密集 =&gt; 程序大部分时间用来做数据存储以及网络读取的操作</p>
<ul>
<li>WEB 开发的 IO 密集</li>
</ul>
<p>当浏览器中的请求到达服务器时，除了使用 cpu 进行计算 uri 路径的文件位置，剩下的都是文件读取以及数据库操作，由此可见 http 请求大部分还是 IO 操作。此外在页面渲染时，除开使用 cpu 计算，其他涉及读取模板文件或根据数据生成 Html 都算做 IO 操作。所以说 WEB 开发是典型的 IO 密集的场景。</p>
<ul>
<li>进程与线程</li>
</ul>
<p>进程 Process 通俗来说就是正在内存中运行的程序，多进程是通过 cpu 调度算法在纳秒单位切换执行多个进程。线程是进程内一个相对独立的可调度的执行单元，也就是进程中单一顺序的控制流。多任务就是说在一个进程可以并发多个线程，而每条线程并行执行不同的任务。一个进程开启一项任务，就是打开了一个线程，类似于 Downie4 开始了一个下载任务。</p>
<h3 id="globals-%E5%85%A8%E5%B1%80%E5%AF%B9%E8%B1%A1"><a href="https://nodejs.org/api/globals.html">Globals 全局对象</a></h3>
<p>全局对象 =&gt; 在程序的任何位置可以直接访问的对象</p>
<p>在 JS 源代码通过 Parse 转换为 AST 的阶段，会创建全局对象 GlobalObject，并放入 window 属性（即 this 指向当前 GlobalObject）、setTimeout...。存在部分特殊的全局变量，这些全局变量实际上是模块中的变量，只不过每个模块都有，所以看起来好像是全局变量，但在命令行交互中不可直接使用。</p>
<pre><code class="language-javascript">// 常见的全局变量
process // 提供Node进程相关信息
console // 控制台
// 定时器全局函数
setTimeout(() =&gt; {},time)
setInterval(() =&gt; {},time)
setImmediate(() =&gt; {})
process.nextTick(() =&gt; {})
// 全局对象
global // global. 按两下 Tab
</code></pre>
<pre><code class="language-javascript">// 特殊的全局变量
// 需要进入文件所在文件夹再 node index.js
__dirname // 打印当前文件夹所在目录绝对路径
__filename // 打印当前文件所在目录绝对路径
exports、module、require() // 模块化相关
</code></pre>
<p>V8 在创建 GO 后，为执行代码还需要 ECStack Execution Context Stack 执行上下文栈作为容器去接收 GEC Global Execution Context 全局执行上下文。</p>
<p>VO Variable Object 变量对象在编译时，其内每一项只是对应 GO 的初始未赋值属性，只有在执行期间才会对相应属性更改。</p>
<pre><code class="language-javascript">/* --- 伪代码 --- */
/*
GO =&gt;
var globalObject = {
  String:&quot;Class&quot;, Date:&quot;Class&quot;,setTimeout:&quot;Func&quot;,window:globalObject,name:undefined,age:undefined
}
*/
// 解释变量提升为什么出现 undefined
var name = &quot;zs&quot;
console.log(age) // 编译完成但未执行 =&gt; GO 中还是 undefined
var age = 22
</code></pre>
<h3 id="node-%E5%88%9B%E5%BB%BA-web-%E6%9C%8D%E5%8A%A1%E5%99%A8">Node 创建 Web 服务器</h3>
<p>官方文档 =&gt; <a href="http://nodejs.cn/api/http.html#class-httpserver">事件</a>、<a href="http://nodejs.cn/api/http.html#httpcreateserveroptions-requestlistener">Web Server</a></p>
<ul>
<li>获取 ip 的 server</li>
</ul>
<pre><code class="language-javascript">// 创建 web 服务器
const http = require('http')
const port = 8089
const server = http.createServer((req,res)=&gt;{
    // setHeader 用于设置单个标头 =&gt; res.setHeader('Content-Type','text/html; charset=utf-8') | 设置多个选择 res.writeHead
    // 解决中文乱码问题 =&gt; 设置 Content-Type =&gt; {'Content-Type': 'text/html; charset=utf-8'}
    res.writeHead(200, { 'Content-Type': 'text/html; charset=utf-8' });
    console.log(&quot;ok&quot;)
    var ipAddress,headers = req.headers,forwardedIpsStr = headers['x-real-ip'] || headers['x-forwarded-for'];
    forwardedIpsStr ? ipAddress = forwardedIpsStr : ipAddress = null;
    if (!ipAddress) { ipAddress = req.socket.remoteAddress; }
    console.log(ipAddress)
}).listen(port,()=&gt;{ // 调用服务器的 server.listen(端口号,cb回调) 方法即可启动服务器 -&gt; 服务器启动成功就会调用这个回调函数
    console.log(`http server running at http://127.0.0.1:${port}`)
})

/* 服务器实例的 on() 方法为服务器绑定一个事件 =&gt; listening、connection、close... */
server.on('listening',(req,res)=&gt;{
    console.log(&quot;server is listening&quot;)
    // server.close(); // 测试 close 事件
})
server.on('connection',(req,res)=&gt;{
    console.log(&quot;Client is connected&quot;)
})
// req 请求对象包含了与客户端相关的数据和属性(不能写request)
server.on('request',(req,res)=&gt;{ // 只要有客户端请求就会触发 request 事件
    const remoteAddress = res.socket.remoteAddress;
    const localAddress = req.socket.localAddress;
    const port = res.socket.remotePort;
    const str = `your request url is ${req.url}, and request method is ${req.method}, and remoteAddress is ${remoteAddress} and your source port is ${port} and your localAddress is ${localAddress}.`
    // request 事件处理函数返回客户端相关的数据或属性 =&gt; res.end() -&gt; 发送指定内容并结束请求过程
    res.end(str)
})
server.on('close',function(){console.log(&quot;Node server is closed&quot;)})
</code></pre>
<ul>
<li>处理 chunk 的 server</li>
</ul>
<pre><code class="language-javascript">const http = require('http');
const port = 8089;
http.createServer((req,res)=&gt;{
    let data = '';
    req.on(&quot;data&quot;,(chunk)=&gt;{data += chunk});
    req.on(&quot;end&quot;,function(){
        let method = req.method,headers = JSON.stringify(req.headers),httpVersion = req.httpVersion,requestUrl = req.url;
        res.writeHead(200,{&quot;content-type&quot;:&quot;text/plain;charset=utf-8&quot;})
        let responseData = method + '-' + headers + '-' + httpVersion + '-' + requestUrl;
        res.end(responseData);
    })
}).listen(port,()=&gt;{console.log(`server is running at http://127.0.0.1:${port}`)})
</code></pre>
<!--kg-card-end: markdown--><!--kg-card-begin: markdown--><h2 id="%E6%A8%A1%E5%9D%97%E5%8C%96">模块化</h2>
<ul>
<li>模块的导入与导出</li>
</ul>
<p>NodeJS 专用的 CommonJS 模块（CJS）不同于 ES6 模块 (ESM)。在 ES6 中 export 与 export default 均可用于导出模块，并在需要的文件或模块中通过 &quot;import from 模块名&quot; 的方式将其导入。在 ES6 中通过 export 方式导出，就要在导入时要加上 {}，而 export default 则不需要，直接导入即可，且默认输出的导入，不需要知道所要加载模块的变量名。因为在一个文件或模块中，export、import 可以有多个，而 export default 仅有一个。</p>
<pre><code class="language-js">// ES6 —— export
// a.js
export const str = &quot;zairesinatra&quot;;
export function zs (sth) { 
  return sth;
}
// 对应的导入方式：
// b.js
import { str, zs } from 'a'; // 也可以分开写两次，导入的时候带花括号

// ES6 —— export default
// a.js
const str = &quot;zairesinatra&quot;;
export default str;
// 对应的导入方式：
//b.js
import str from 'a'; //导入的时候没有花括号

// ES6 —— 自由命名
// a.js
let name = &quot;xzy&quot;;
export default name // name不能加大括号
// 原本直接export name外部是无法识别的，加上default就可以了.但是一个文件内最多只能有一个export default。
// 其实此处相当于为name变量值&quot;xzy&quot;起了一个系统默认的变量名default，自然default只能有一个值，所以一个文件内不能有多个export default。
// b.js
// 本质上，a.js文件的export default输出一个叫做default的变量，然后系统允许你为它取任意名字。所以可以为import的模块起任何变量名，且不需要用大括号包含
import zs from &quot;./a.js&quot;
import zy from &quot;./a.js&quot; 
console.log(zs,zy)   // xzy,xzy
</code></pre>
<p>在 CommonJS 中，<strong>使用 require 引入后返回的只有 module.exports 这个对象</strong>。而在编写模块时用到的 exports 对象实际上只是对 module.exports 的引用。module.exports 初始值为一个空对象 {}。<a href="https://stackoverflow.com/questions/7137397/module-exports-vs-exports-in-node-js/7142924">SOF 点此</a>。</p>
<pre><code class="language-javascript">// 区分 exports 与 module.exports
// 如果覆盖 exports 的值,那么将丢失对 module.exports 的引用,而 module.exports 就是作为公共接口公开的内容
var module = new Module(...);
var exports = module.exports;
</code></pre>
<pre><code class="language-javascript">// CommonJS —— 导出单个模块
// formatTime
function formatTime (){
    // 需要的格式 yyyy-MM-dd hh:mm:ss
    var date = new Date(); // 或者传入一个时间戳
    Y = date.getFullYear() + '-';
    M = (date.getMonth()+1 &lt; 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
    D = date.getDate() + ' ';
    h = date.getHours() + ':';
    m = date.getMinutes() + ':';
    s = date.getSeconds(); 
    console.log(Y+M+D+h+m+s); // 当前时间格式化输出
}
module.exports = formatTime
// requireFT
var requireFT = require('./formatTime') // 当然 .js 可以省略
requireFT() // 2019-08-29 20:33:48

// CommonJS —— 导出多个模块
// func.js
var func1 = () =&gt;{console.log('I am func1')}
var func2 = function(){console.log('I am func2')}
module.exports.func1 = func1;
module.exports.func2 = func2;
// 可简写
module.exports = { // 键值同名可以只写一个
    func1: func1, // func1,
    func2: func2 // func2
}

// requireFunc.js
var requireObj = require('./formatTime')
requireObj.func1(); // I am func1
requireObj.func2(); // I am func2
</code></pre>
<pre><code class="language-javascript">// mod1.js
let name = &quot;zs&quot;; // 字符串是值引用,已经指定了地址
setTimeout(() =&gt; {
  name = &quot;zszszs&quot;
}, 1000)
module.exports = {
  name: name
}
// exec1.js
const mod1 = require('./mod1')
setTimeout(() =&gt; {
  console.log(mod1.name); // zs
}, 2000)

// mod2.js
let info = { name: &quot;zs&quot;}; // 引用对象在堆内存开辟空间
setTimeout(() =&gt; {
  info.name = &quot;zszszs&quot; // 改变了指针
}, 1000)
module.exports = {
  info // info 赋值的是内存地址
}
// exec2.js
const mod2 = require('./mod2')
setTimeout(() =&gt; {
  console.log(mod2.info.name); // zszszs
}, 2000)
</code></pre>
<ul>
<li>require 细节</li>
</ul>
<p>require 是一个函数，帮助引入文件模块中的导出对象，其过程是同步的。</p>
<p>require 查找规则依据是否为核心模块，直接返回 fs、path、http... 并停止查找或分类讨论。</p>
<p>如果以 ./ 或 ../ 或 / 开头的本地文件进行查找。有后缀名时，按照后缀名格式进行查找，没有则按文件、js 文件、json 文件、node 文件的顺序查找。若没有找到，则按目录名进行查找。</p>
<p>直接以名称引入，且非核心模块，则按层级顺序依次从最近的 node_modules 文件夹查找到根目录的 node_modules 文件夹。</p>
<ul>
<li>模块的加载过程</li>
</ul>
<p>模块被第一次引入，模块的 JS 代码被运行一次；若模块被多次引入，也只会加载一次，因为每个模块对象 module 都有一个属性 loaded，为 false 时表示没有加载，true 则已加载完成。</p>
<p>如出现下图的循环引入，则加载顺序为 main、a、c、d、e、b。这是一种图结构；图结构在遍历时有深度优先搜索和广度优先搜索，然而 Node 采用深度优先搜索。</p>
<p><img src="../content/images/2021/11/circlecall.png" alt="circlecall" loading="lazy"></p>
<ul>
<li>AMD 和 CMD</li>
</ul>
<p>AMD 是 Asynchronous Module Definition 移步模块化的缩写，采用异步加载模块。常用的库是 require.js 和 curl.js。</p>
<pre><code class="language-html">&lt;script src=&quot;./lib/require.js&quot; data-main=&quot;./index.js&quot;&gt;&lt;/script&gt;
</code></pre>
<pre><code class="language-js">// index.js
(function(){
  require.config({
    baseUrl: '',
    path: {
      &quot;bar&quot;: &quot;./modules/bar&quot;, // 对应模块的映射关系
      &quot;foo&quot;: &quot;./modules/foo&quot;
    }
  })
  require(['foo'], function(foo){})
})()
</code></pre>
<pre><code class="language-javascript">// bar.js
define(function() {
  const name = &quot;zszs&quot;;
  const age = 21;
  const sayHello = function(){
    console.log(&quot;hi&quot; + name);
  }
  return {
    name: name,
    age: age,
    sayHello: sayHello
  }
})
</code></pre>
<pre><code class="language-javascript">// foo.js
define(['bar'], function(bar){
  console.log(bar.name);
  console.log(bar.age);
  bar.sayHello(&quot;zy&quot;);
})
</code></pre>
<p>CMD 是 Common Module Definition 通用模块定义的缩写，也采用异步加载模块。实现方案是 SeaJS。</p>
<pre><code class="language-html">&lt;script src=&quot;./lib.sea.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
  seajs.use('./index.js')
&lt;/script&gt;
</code></pre>
<pre><code class="language-javascript">// index.js
define(function(require, exports, module){
  const foo = require('./modules/foo');
  console.log(foo.name);
  console.log(foo.age)
  console.log(foo.sayHello('zy'))
})
</code></pre>
<pre><code class="language-javascript">// foo.js
define(function(require, exports, module){
  const name = &quot;zs&quot;;
  const age = 21;
  const sayHello = function(name){
    console.log(&quot;hi&quot; + name);
  }
  module.exports = {
    name,
    age,
    sayHello
  }
})
</code></pre>
<ul>
<li><a href="https://www.ruanyifeng.com/blog/2020/08/how-nodejs-use-es6-module.html">Node.js 如何处理 ES6 模块</a>。</li>
</ul>
<!--kg-card-end: markdown--><!--kg-card-begin: markdown--><h2 id="%E6%A8%A1%E5%9D%97%E5%A4%84%E7%90%86">模块处理</h2>
<p>由于 ESM 模块与 CJS 模块互不兼容。require() 是同步加载，后面的代码必须等待这个命令执行完，才会执行。import 命令则是异步加载，或者更准确地说，ES6 模块有一个独立的静态解析阶段，依赖关系的分析是在那个阶段完成的，最底层的模块第一个执行。</p>
<p>NodeJS 要求 ES6 模块采用 .mjs 后缀文件名。也就是说，只要脚本文件里面使用 import 或者 export 命令，那么就必须采用 .mjs 后缀名。NodeJS 遇到 .mjs 文件，就默认为 ES6 模块，同时启用严格模式。如果不希望将后缀名改成 .mjs，也可以在项目的 package.json 文件中，指定 type 字段为 module。</p>
<pre><code class="language-json">{ &quot;type&quot;: &quot;module&quot; }
</code></pre>
<p>如果此时还要使用 CommonJS 模块，那么需要将 CommonJS 脚本的后缀名都改成<code>.cjs</code>。如果没有 type 字段，或者 type 字段为 commonjs，则 .js 脚本会被解释成 CommonJS 模块。</p>
<p>总结就是 .mjs 文件总是以 ES6 模块加载，.cjs 文件总是以 CommonJS 模块加载，.js 文件的加载取决于 package.json 里的 type 字段设置。但是 ES6 模块与 CommonJS 模块尽量不要混用。混和加载相反后缀名文件会产生报错。</p>
<ul>
<li>全局模块与核心模块</li>
</ul>
<p>在项目中可以随时访问，不需要引入的模块称为全局模块（包括全局对象与全局变量）。不需要单独下载，可以直接引入 (require的参数就是路径) 的模块称为核心模块 (path、fs、http)。</p>
<ul>
<li>CommonJS 模块加载 ES6 模块</li>
</ul>
<p>CommonJS 的<code>require()</code>命令不能加载 ES6 模块，会报错，只能使用<code>import()</code>这个方法加载。</p>
<pre><code class="language-js">// CommonJS模块
(async () =&gt; {
  await import('./my-app.mjs'); // 可在 CommonJS 模块中运行
})();
// require() 不支持 ES6 模块的一个原因是它是同步加载的，而 ES6 模块内部可以使用异步的命令,导致无法被同步加载
</code></pre>
<ul>
<li>ES6 模块加载 CommonJS 模块</li>
</ul>
<p>ES6 模块的 import 命令可以加载 CommonJS 模块，但是只能整体加载，不能只加载单一的输出项。</p>
<pre><code class="language-js">import packageMain from 'commonjs-package'; // 正确
import { method } from 'commonjs-package'; // 报错
// ES6 模块需要支持静态代码分析,而 CommonJS 模块的输出接口是 module.exports 对象,无法被静态分析,所以只能整体加载
// 需要使用单一的输出项可以写成下面这样
import packageMain from 'commonjs-package';
const { method } = packageMain;
</code></pre>
<!--kg-card-end: markdown--><!--kg-card-begin: markdown--><h2 id="buffer-%E7%BC%93%E5%86%B2%E5%8C%BA">Buffer 缓冲区</h2>
<p>核心库 Buffer 类似一个整数数组，其元素为十六进制的两位数。Buffer 创建内存中空间的每一个元素范围是 00-ff =&gt; 0-255 =&gt; 00000000-11111111 =&gt; 8bit =&gt; 1byte，所以实际上一个元素就表示内存中的一个字节。此外 Buffer 中的内存不是通过 Javascript 分配，而是在底层通过 C++ 申请的，对应 V8 堆内存之外的一块原始内存。</p>
<p>服务器响应的可能是图片、音乐、视频之流的二进制文件，而 JavaScript 没有二进制数据类型，这就需要 Buffer 库为 NodeJS 提供存储原始数据的方法来处理二进制数据。此外计算机中的二进制都会以十六进制显示，所以尽管存储的是二进制，显示的却还是十六进制。</p>
<pre><code class="language-javascript">console.log(Buffer.from('Hello zs')) // &lt;Buffer 48 65 6c 6c 6f 20 7a 73&gt;
console.log(Buffer.from('Hello zs').length) // 占用内存大小;一个英文占1字节 - 8
console.log('Hello zs'.length) // 字符串长度 - 8
console.log(Buffer.from('Hello 紫').length) // 占用内存大小;一个汉字占3字节 - 9
console.log('Hello 紫'.length) // 字符串长度 - 7
</code></pre>
<pre><code class="language-javascript">// new Buffer()构造函数来创建对象实例,但是Buffer对内存的权限操作相比很大,可以直接捕获一些敏感信息, 所以在v6.0以后被替代

// Buffer.alloc(size[, fill[, encoding]]) 返回一个指定大小的Buffer实例,如果没有设置 fill,则默认填满 0.
// Buffer 大小一旦确定则不能修改,Buffer实际上是对底层内存的直接操作,在内存中分配出连续的长度为确定的空间.这一点与数组不同,内存空间不连续则性能较差
// 创建一个长度为 10、且用0 填充的Buffer
const buf1 = Buffer.alloc(10);
// 创建一个长度为 10、且用 0x1 填充的 Buffer 
const buf2 = Buffer.alloc(10, 1);

// Buffer.allocUnsafe(size)返回一个指定大小的 Buffer 实例,此方法比调用既分配空间又清空数据的 Buffer.alloc() 更快。但是 Buffer 实例不会被初始化则可能包含敏感的旧数据,需要使用 fill() 或 write() 重写
// 创建一个长度为 10、且未初始化的 Buffer
const buf3 = Buffer.allocUnsafe(10);
// 适用在不确定的时间内从池中保留一小块内存的情况
Buffer.allocUnsafeSlow(size)

// Buffer.from(array) 返回一个被 array 的值初始化的新的 Buffer 实例,这里传入的 array 的元素只能是数字,不然就会自动被 0 覆盖
// 创建一个包含 [0x1, 0x2, 0x3] 的 Buffer
const buf4 = Buffer.from([1, 2, 3]);

// Buffer.from(arrayBuffer[, byteOffset[, length]]) 返回一个新建的与给定的 ArrayBuffer 共享同一内存的 Buffer
// Buffer.from(buffer) 复制传入的 Buffer 实例的数据,并返回一个新的 Buffer 实例
console.log(Buffer.from(Buffer.from('Hello zs')), Buffer.compare(Buffer.from('Hello zs'), Buffer.from(Buffer.from('Hello zs')))) // &lt;Buffer 48 65 6c 6c 6f 20 7a 73&gt; 0

// Buffer.from(string[, encoding]) 返回一个被 string 的值初始化的新的 Buffer 实例
// 创建一个包含 UTF-8 字节 [0x74, 0xc3, 0xa9, 0x73, 0x74] 的 Buffer
const buf5 = Buffer.from('tést');

// 创建一个包含 Latin-1 字节 [0x74, 0xe9, 0x73, 0x74] 的 Buffer
const buf6 = Buffer.from('tést', 'latin1');
</code></pre>
<!--kg-card-end: markdown--><!--kg-card-begin: markdown--><h2 id="koa2">Koa2</h2>
<p>Express 自带 Router、路由规则、View 等功能，更接近于 Web FrameWork 的概念。Koa 因为没有捆绑中间件，所以轻量的同时自由度也更高，更像是对 HTTP 的封装，官方提供一系列 Koa 的<a href="https://github.com/koajs/koa/wiki">中间件</a>，以供按需组合。</p>
<ul>
<li>Hello World</li>
</ul>
<pre><code class="language-javascript">// 必修的 hello world 应用
const Koa = require('koa');
const app = new Koa();
app.use(async ctx =&gt; {
  ctx.body = 'Hello World';
});
app.listen(3000);
</code></pre>
<ul>
<li>级联</li>
</ul>
<pre><code class="language-javascript">
</code></pre>
<!--kg-card-end: markdown--><!--kg-card-begin: markdown--><h2 id="%E7%BB%93%E6%9D%9F">结束</h2>
<p>本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh"> CC BY-SA 4.0 </a>协议，转载请注明出处！</p>
<!--kg-card-end: markdown-->
    </section>


    
    <section class="article-comments gh-canvas">
        <div id="disqus_thread"></div>
        <script>
            var disqus_config = function () {
                this.page.url = "yourdomain.com/node/";
                this.page.identifier = "ghost-612a36d2f60ced083419000d"
            };
            (function() {
            var d = document, s = d.createElement('script');
            s.src = 'https://zsxzy.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
            })();
        </script>
    </section>
   

</article>
</main>

    <section class="footer-cta outer">
        <div class="inner">
            <h2 class="footer-cta-title">Sign up for more like this.</h2>
            <a class="footer-cta-button" href="index.html#/portal" data-portal>
                <div class="footer-cta-input">Enter your email</div>
                <span>Subscribe</span>
            </a>
        </div>
    </section>



            <aside class="read-more-wrap outer">
                <div class="read-more inner">
                        
<article class="post-card post">

    <a class="post-card-image-link" href="../g-toc-css/index.html">

        <img class="post-card-image"
            srcset="../content/images/size/w600/2022/04/SLAMDUNK.png 600w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="../content/images/size/w600/2022/04/SLAMDUNK.png"
            alt="SLAM DUNK"
            loading="lazy"
        />


    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../g-toc-css/index.html">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    G&amp;TOC&amp;CSS
                </h2>
            </header>
                <div class="post-card-excerpt">TOC 的需求实现以及相关的思考总结。</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2022-05-01">May 1, 2022</time>
                <span class="sep">—</span>
                <span class="post-card-meta-length">6 min read</span>
        </footer>

    </div>

</article>
                        
<article class="post-card post">

    <a class="post-card-image-link" href="../mybatis/index.html">

        <img class="post-card-image"
            srcset="../content/images/size/w600/2022/07/GreenTreesUnderBlueSky.jpg 600w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="../content/images/size/w600/2022/07/GreenTreesUnderBlueSky.jpg"
            alt="Green Trees Under Blue Sky"
            loading="lazy"
        />


    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../mybatis/index.html">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    MyBatis
                </h2>
            </header>
                <div class="post-card-excerpt">半自动 ORM Object Relation Mapping 持久层框架 MyBatis</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2022-02-02">Feb 2, 2022</time>
                <span class="sep">—</span>
                <span class="post-card-meta-length">44 min read</span>
        </footer>

    </div>

</article>
                        
<article class="post-card post">

    <a class="post-card-image-link" href="../mysqlnote/index.html">

        <img class="post-card-image"
            srcset="../content/images/size/w600/2022/04/cloud.jpg 600w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="../content/images/size/w600/2022/04/cloud.jpg"
            alt="mysql"
            loading="lazy"
        />


    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../mysqlnote/index.html">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    MySQL 笔记
                </h2>
            </header>
                <div class="post-card-excerpt">MYSQL 基础篇</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2021-12-22">Dec 22, 2021</time>
                <span class="sep">—</span>
                <span class="post-card-meta-length">82 min read</span>
        </footer>

    </div>

</article>
                </div>
            </aside>



    </div>

    <footer class="site-footer outer">
        <div class="inner">
            <section class="copyright"><a href="../index.html">zairesinatra</a> &copy; 2022</section>
            <nav class="site-footer-nav">
                
            </nav>
            <div><a href="https://ghost.org/" target="_blank" rel="noopener">Powered by Ghost</a></div>
        </div>
    </footer>

</div>


<script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>
<script src="../assets/built/casper.js%3Fv=ab47967965"></script>
<script>
$(document).ready(function () {
    // Mobile Menu Trigger
    $('.gh-burger').click(function () {
        $('body').toggleClass('gh-head-open');
    });
    // FitVids - Makes video embeds responsive
    $(".gh-content").fitVids();
});
</script>

<!-- 2022 prismjs update -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/autoloader/prism-autoloader.min.js" onload="Prism.plugins.autoloader.languages_path='https://cdn.bootcss.com/prism/1.19.0/components/'"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-javascript.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-powershell.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-sql.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-jsx.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-java.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/toolbar/prism-toolbar.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
<script defer src="https://cdn.bootcss.com/prism/1.19.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>



<!-- music -->
<script src="http://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
<script src="http://cdn.jsdelivr.net/npm/meting@1.2.0/dist/Meting.min.js"></script>
<script>
	var meting_api='http://api.mizore.cn/meting/api.php?server=:server&type=:type&id=:id'
		$('.carousel').carousel({
			interval: 3000
		})
</script>
<!-- music -->
<div class="aplayer" data-id="7260570761" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false" data-volume="0.6" lrc-type="0"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.18.2/tocbot.min.js"></script>
<script>
    tocbot.init({
        tocSelector: '.toc',
        contentSelector: '.gh-content',
        hasInnerContainers: true
    });
    var tc = document.querySelector(".toc-container");
    var tch = tc.clientHeight;
    var ah = document.querySelector(".article-header");
    var ahh = ah.clientHeight;
    window.addEventListener("scroll", function () {
    if(document.body.clientWidth > 1170){
        var scrollY = document.documentElement.scrollTop || document.body.scrollTop;
        var ihh = window.innerHeight;
        if(scrollY >= ihh + tch + ahh){
            var ctc = document.querySelector(".toc-container");
            ctc.style.position="sticky";
            ctc.style.position="-webkit-sticky";
            ctc.style.top = "120px";
            ctc.style.marginLeft = "800px";
            ctc.style.minWidth= "260px";
        }
        if(scrollY < tch + ahh -10){
            var ctc = document.querySelector(".toc-container");
            ctc.style.position="";
            ctc.style.top = "";
            ctc.style.marginLeft = "";
            console.log("zszszs")
        }
    }
    })
</script>
</body>
</html>
