<!DOCTYPE html>
<html ⚡>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

    <title>Ghost 更新与迁移</title>

    <meta name="description" content="Ghost 部落格平台" />
    <link rel="icon" href="../../content/images/size/w256h256/2021/07/ghost-orb.png" type="image/png" />
    <link rel="canonical" href="../index.html" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    
    <meta property="og:site_name" content="zairesinatra" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Ghost 更新与迁移" />
    <meta property="og:description" content="Ghost 部落格平台" />
    <meta property="og:url" content="https://zairesinatra.github.io//newghostzs/" />
    <meta property="og:image" content="https://zairesinatra.github.io//content/images/2023/03/TheMigrationOfGhostBlog.png" />
    <meta property="article:published_time" content="2021-01-14T13:41:00.000Z" />
    <meta property="article:modified_time" content="2023-03-24T20:39:20.000Z" />
    <meta property="article:tag" content="Technology growth" />
    <meta property="article:tag" content="Bugs handled" />
    <meta property="article:tag" content="GHOSTblog" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Ghost 更新与迁移" />
    <meta name="twitter:description" content="Ghost 部落格平台" />
    <meta name="twitter:url" content="https://zairesinatra.github.io//newghostzs/" />
    <meta name="twitter:image" content="https://zairesinatra.github.io//content/images/2023/03/TheMigrationOfGhostBlog.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Ziyi Xie" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Technology growth, Bugs handled, GHOSTblog" />
    <meta name="twitter:site" content="@xieziyi0422" />
    <meta property="og:image:width" content="1920" />
    <meta property="og:image:height" content="1080" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "zairesinatra",
        "url": "https://zairesinatra.github.io//",
        "logo": {
            "@type": "ImageObject",
            "url": "https://zairesinatra.github.io//content/images/2021/07/zs-1.JPG",
            "width": 60,
            "height": 60
        }
    },
    "author": {
        "@type": "Person",
        "name": "Ziyi Xie",
        "image": {
            "@type": "ImageObject",
            "url": "https://zairesinatra.github.io//content/images/2021/07/zs-2.JPG",
            "width": 1079,
            "height": 1079
        },
        "url": "https://zairesinatra.github.io//author/ziyi/",
        "sameAs": []
    },
    "headline": "Ghost 更新与迁移",
    "url": "https://zairesinatra.github.io//newghostzs/",
    "datePublished": "2021-01-14T13:41:00.000Z",
    "dateModified": "2023-03-24T20:39:20.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://zairesinatra.github.io//content/images/2023/03/TheMigrationOfGhostBlog.png",
        "width": 1920,
        "height": 1080
    },
    "keywords": "Technology growth, Bugs handled, GHOSTblog",
    "description": "Ghost 部落格平台",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://zairesinatra.github.io//"
    }
}
    </script>

    <meta name="generator" content="Ghost 5.33" />
    <link rel="alternate" type="application/rss+xml" title="zairesinatra" href="../../rss/index.html" />

    <style amp-custom>
    *,
    *::before,
    *::after {
        box-sizing: border-box;
    }

    html {
        overflow-x: hidden;
        overflow-y: scroll;
        font-size: 62.5%;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    }

    body {
        min-height: 100vh;
        margin: 0;
        padding: 0;
        color: #3a4145;
        font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;
        font-size: 1.7rem;
        line-height: 1.55em;
        font-weight: 400;
        font-style: normal;
        background: #fff;
        scroll-behavior: smooth;
        overflow-x: hidden;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    p,
    ul,
    ol,
    li,
    dl,
    dd,
    hr,
    pre,
    form,
    table,
    video,
    figure,
    figcaption,
    blockquote {
        margin: 0;
        padding: 0;
    }

    ul[class],
    ol[class] {
        padding: 0;
        list-style: none;
    }

    img {
        display: block;
        max-width: 100%;
    }

    input,
    button,
    select,
    textarea {
        font: inherit;
        -webkit-appearance: none;
    }

    fieldset {
        margin: 0;
        padding: 0;
        border: 0;
    }

    label {
        display: block;
        font-size: 0.9em;
        font-weight: 700;
    }

    hr {
        position: relative;
        display: block;
        width: 100%;
        height: 1px;
        border: 0;
        border-top: 1px solid currentcolor;
        opacity: 0.1;
    }

    ::selection {
        text-shadow: none;
        background: #cbeafb;
    }

    mark {
        background-color: #fdffb6;
    }

    small {
        font-size: 80%;
    }

    sub,
    sup {
        position: relative;
        font-size: 75%;
        line-height: 0;
        vertical-align: baseline;
    }
    sup {
        top: -0.5em;
    }
    sub {
        bottom: -0.25em;
    }

    ul li + li {
        margin-top: 0.6em;
    }

    a {
        color: var(--ghost-accent-color, #1292EE);
        text-decoration-skip-ink: auto;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        margin: 0;
        font-weight: 700;
        color: #121212;
        line-height: 1.4em;
    }

    h1 {
        font-size: 3.4rem;
        line-height: 1.1em;
    }

    h2 {
        font-size: 2.4rem;
        line-height: 1.2em;
    }

    h3 {
        font-size: 1.8rem;
    }

    h4 {
        font-size: 1.7rem;
    }

    h5 {
        font-size: 1.6rem;
    }

    h6 {
        font-size: 1.6rem;
    }

    amp-img {
        height: 100%;
        width: 100%;
        max-width: 100%;
        max-height: 100%;
    }

    amp-img img {
        object-fit: cover;
    }
    
    amp-youtube {
        height: calc(100vw / 1.78);
        width: 100vw;
        position: relative;
    }

    amp-youtube img {
        position: absolute;
    }

    .page-header {
        padding: 50px 5vmin 30px;
        text-align: center;
        font-size: 2rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .page-header a {
        color: #121212;
        font-weight: 700;
        text-decoration: none;
        font-size: 1.6rem;
        letter-spacing: -0.1px;
    }

    .post {
        max-width: 680px;
        margin: 0 auto;
    }

    .post-header {
        margin: 0 5vmin 5vmin;
        text-align: center;
    }

    .post-meta {
        margin: 1rem 0 0 0;
        text-transform: uppercase;
        color: #738a94;
        font-weight: 500;
        font-size: 1.3rem;
    }

    .post-image {
        margin: 0 0 5vmin;
    }

    .post-image img {
        display: block;
        width: 100%;
        height: auto;
    }

    .post-content {
        padding: 0 5vmin;
    }

    .post-content > * + * {
        margin-top: 1.5em;
    }

    .post-content [id]:not(:first-child) {
        margin: 2em 0 0;
    }

    .post-content > [id] + * {
        margin-top: 1rem;
    }

    .post-content [id] + .kg-card,
    .post-content blockquote + .kg-card {
        margin-top: 40px;
    }

    .post-content > ul,
    .post-content > ol,
    .post-content > dl {
        padding-left: 1.9em;
    }

    .post-content hr {
        margin-top: 40px;
    }

    .post .post-content hr + * {
        margin-top: 40px;
    }

    .post-content amp-img {
        background-color: #f8f8f8;
    }

    .post-content blockquote {
        position: relative;
        font-style: italic;
    }

    .post-content blockquote::before {
        content: "";
        position: absolute;
        left: -1.5em;
        top: 0;
        bottom: 0;
        width: 0.3rem;
        background: var(--ghost-accent-color, #1292EE);
    }

    .post-content blockquote.kg-blockquote-alt {
        font-size: 1.2em;
        font-style: italic;
        line-height: 1.6em;
        text-align: center;
        color: #738a94;
        padding: 0.75em 3em 1.25em;
    }

    .post-content blockquote.kg-blockquote-alt::before {
        display: none;
    }

    .post-content :not(.kg-card):not([id]) + .kg-card {
        margin-top: 40px;
    }

    .post-content .kg-card + :not(.kg-card) {
        margin-top: 40px;
    }

    .kg-card figcaption {
        padding: 1.5rem 1.5rem 0;
        text-align: center;
        font-weight: 500;
        font-size: 1.3rem;
        line-height: 1.4em;
        opacity: 0.6;
    }

    .kg-card figcaption strong {
        color: rgba(0,0,0,0.8);
    }

    .post-content :not(pre) code {
        vertical-align: middle;
        padding: 0.15em 0.4em 0.15em;
        border: #e1eaef 1px solid;
        font-weight: 400;
        font-size: 0.9em;
        line-height: 1em;
        color: #15171a;
        background: #f0f6f9;
        border-radius: 0.25em;
    }

    .post-content > pre {
        overflow: scroll;
        padding: 16px 20px;
        color: #fff;
        background: #1F2428;
        border-radius: 5px;
        box-shadow: 0 2px 6px -2px rgba(0,0,0,.1), 0 0 1px rgba(0,0,0,.4);
    }

    .kg-embed-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
    }

    .kg-image-card img {
        margin: auto;
    }

    .kg-gallery-card + .kg-gallery-card {
        margin-top: 0.75em;
    }

    .kg-gallery-container {
        position: relative;
    }

    .kg-gallery-row {
        display: flex;
        flex-direction: row;
        justify-content: center;
    }

    .kg-gallery-image {
        width: 100%;
        height: 100%;
    }

    .kg-gallery-row:not(:first-of-type) {
        margin: 0.75em 0 0 0;
    }

    .kg-gallery-image:not(:first-of-type) {
        margin: 0 0 0 0.75em;
    }

    .kg-bookmark-card,
    .kg-bookmark-publisher {
        position: relative;
    }

    .kg-bookmark-container,
    .kg-bookmark-container:hover {
        display: flex;
        flex-wrap: wrap;
        flex-direction: row-reverse;
        color: currentColor;
        background: rgba(255,255,255,0.6);
        font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;
        text-decoration: none;
        border-radius: 3px;
        box-shadow: 0 2px 6px -2px rgba(0, 0, 0, 0.1), 0 0 1px rgba(0, 0, 0, 0.4);
        overflow: hidden;
    }

    .kg-bookmark-content {
        flex-basis: 0;
        flex-grow: 999;
        padding: 20px;
        order: 1;
    }

    .kg-bookmark-title {
        font-weight: 600;
        font-size: 1.5rem;
        line-height: 1.3em;
    }

    .kg-bookmark-description {
        display: -webkit-box;
        max-height: 45px;
        margin: 0.5em 0 0 0;
        font-size: 1.4rem;
        line-height: 1.55em;
        overflow: hidden;
        opacity: 0.8;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }

    .kg-bookmark-metadata {
        margin-top: 20px;
    }

    .kg-bookmark-metadata {
        display: flex;
        align-items: center;
        font-weight: 500;
        font-size: 1.3rem;
        line-height: 1.3em;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .kg-bookmark-description {
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
        overflow: hidden;
    }

    .kg-bookmark-metadata amp-img {
        width: 18px;
        height: 18px;
        max-width: 18px;
        max-height: 18px;
        margin-right: 10px;
    }

    .kg-bookmark-thumbnail {
        display: flex;
        flex-basis: 20rem;
        flex-grow: 1;
        justify-content: flex-end;
    }

    .kg-bookmark-thumbnail amp-img {
        max-height: 200px;
    }

    .kg-bookmark-author {
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
    }

    .kg-bookmark-publisher::before {
        content: "•";
        margin: 0 .5em;
    }

    .kg-toggle-card-icon {
        display: none;
    }

    .kg-toggle-content {
        margin-top: 0.8rem;
    }

    .kg-product-card-container {
        background: transparent;
        padding: 20px;
        width: 100%;
        border-radius: 5px;
        box-shadow: inset 0 0 0 1px rgb(124 139 154 / 25%);
    }

    .kg-product-card-description p {
        margin-top: 1.5em;
    }

    .kg-product-card-description ul {
        margin-left: 24px;
    }

    .kg-product-card-title {
        font-size: 1.9rem;
        font-weight: 700;
    }

    .kg-product-card-rating-star {
        height: 28px;
        width: 20px;
        margin-right: 2px;
    }

    .kg-product-card-rating-star svg {
    width: 16px;
    height: 16px;
    fill: currentColor;
    opacity: 0.15;
    }

    .kg-product-card-rating-active.kg-product-card-rating-star svg {
    opacity: 1;
    }

    .kg-nft-card-container {
        position: relative;
        display: flex;
        flex: auto;
        flex-direction: column;
        text-decoration: none;
        font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;
        font-size: 1.4rem;
        font-weight: 400;
        box-shadow: 0 2px 6px -2px rgb(0 0 0 / 10%), 0 0 1px rgb(0 0 0 / 40%);
        width: 100%;
        max-width: 512px;
        color: #15212A;
        background: #fff;
        border-radius: 5px;
        transition: none;
        margin: 0 auto;
    }

    .kg-nft-metadata {
        padding: 2.0rem;
    }

    .kg-nft-image-container {
        position: relative;
    }

    .kg-nft-image {
        display: flex;
        border-radius: 5px 5px 0 0;
    }

    .kg-nft-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 20px;
    }

    .kg-nft-header h4.kg-nft-title {
        font-size: 1.9rem;
        font-weight: 700;
        margin: 0;
        color: #15212A;
    }

    .kg-nft-header amp-img {
        max-width: 114px;
        max-height: 26px;
    }

    .kg-nft-opensea-logo {
        margin-top: 2px;
        width: 100px;
    }

    .kg-nft-creator {
        font-family: inherit;
        color: #95A1AD;
    }

    .kg-nft-creator span {
        font-weight: 500;
        color: #15212A;
    }

    .kg-nft-card p.kg-nft-description {
        font-size: 1.4rem;
        line-height: 1.4em;
        margin: 2.0rem 0 0;
        color: #222;
    }

    .kg-button-card {
        display: flex;
        position: static;
        align-items: center;
        width: 100%;
        justify-content: center;
    }

    .kg-btn {
        display: flex;
        position: static;
        align-items: center;
        padding: 0 2.0rem;
        height: 4.0rem;
        line-height: 4.0rem;
        font-size: 1.65rem;
        font-weight: 600;
        text-decoration: none;
        border-radius: 5px;
        transition: opacity 0.2s ease-in-out;
    }

    .kg-btn:hover {
        opacity: 0.85;
    }

    .kg-btn-accent {
        background-color: var(--ghost-accent-color, #1292EE);
        color: #fff;
    }

    .kg-callout-card {
        display: flex;
        padding: 20px 28px;
        border-radius: 3px;
    }

    .kg-callout-card-grey {
        background: rgba(124, 139, 154, 0.13);
    }

    .kg-callout-card-white {
        background: transparent;
        box-shadow: inset 0 0 0 1px rgba(124, 139, 154, 0.25);
    }

    .kg-callout-card-blue {
        background: rgba(33, 172, 232, 0.12);
    }

    .kg-callout-card-green {
        background: rgba(52, 183, 67, 0.12);
    }

    .kg-callout-card-yellow {
        background: rgba(240, 165, 15, 0.13);
    }

    .kg-callout-card-red {
        background: rgba(209, 46, 46, 0.11);
    }

    .kg-callout-card-pink {
        background: rgba(225, 71, 174, 0.11);
    }

    .kg-callout-card-purple {
        background: rgba(135, 85, 236, 0.12);
    }

    .kg-callout-card-accent {
        background: var(--ghost-accent-color);
        color: #fff;
    }

    .kg-callout-card-accent a {
        color: #fff;
    }

    .kg-callout-emoji {
        padding-right: 16px;
        line-height: 1.3;
        font-size: 1.25em;
    }

    .kg-header-card {
        padding: 6em 3em;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
    }

    .kg-header-card.kg-size-small {
        padding-top: 4em;
        padding-bottom: 4em;
    }

    .kg-header-card.kg-size-large {
        padding-top: 12em;
        padding-bottom: 12em;
    }

    .kg-header-card.kg-width-full {
        padding-left: 4em;
        padding-right: 4em;
    }

    .kg-header-card.kg-align-left {
        text-align: left;
        align-items: flex-start;
    }

    .kg-header-card.kg-style-dark {
        background: #15171a;
        color: #ffffff;
    }

    .kg-header-card.kg-style-light {
        color: #15171a;
        border: 1px solid rgba(124, 139, 154, 0.25);
        border-width: 1px 0;
    }

    .kg-header-card.kg-style-accent {
        background-color: var(--ghost-accent-color);
    }

    .kg-header-card.kg-style-image {
        background-color: #e7e7eb;
        background-size: cover;
        background-position: center center;
    }

    .kg-header-card h2 {
        font-size: 4em;
        font-weight: 700;
        line-height: 1.1em;
        margin: 0;
    }

    .kg-header-card h2 strong {
        font-weight: 800;
    }

    .kg-header-card.kg-size-small h2 {
        font-size: 3em;
    }

    .kg-header-card.kg-size-large h2 {
        font-size: 5em;
    }

    .kg-header-card h3 {
        font-size: 1.25em;
        font-weight: 500;
        line-height: 1.3em;
        margin: 0;
    }

    .kg-header-card h3 strong {
        font-weight: 600;
    }

    .kg-header-card.kg-size-small h3 {
        font-size: 1em;
    }

    .kg-header-card.kg-size-large h3 {
        font-size: 1.5em;
    }

    .kg-header-card:not(.kg-style-light) h2,
    .kg-header-card:not(.kg-style-light) h3 {
        color: #ffffff;
    }

    .kg-header-card a.kg-header-card-button {
        display: flex;
        position: static;
        align-items: center;
        padding: 0 1.2em;
        height: 2.4em;
        line-height: 1em;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
        font-size: 0.95em;
        font-weight: 600;
        text-decoration: none;
        border-radius: 5px;
        transition: opacity 0.2s ease-in-out;
        background-color: var(--ghost-accent-color);
        color: #ffffff;
        margin: 1.75em 0 0;
    }

    .kg-header-card a.kg-header-card-button:hover {
        opacity: 0.85;
    }

    .kg-header-card.kg-size-large a.kg-header-card-button {
        margin-top: 2em;
    }

    .kg-header-card.kg-size-small a.kg-header-card-button {
        margin-top: 1.5em;
    }

    .kg-header-card.kg-style-image a.kg-header-card-button,
    .kg-header-card.kg-style-dark a.kg-header-card-button {
        background: #ffffff;
        color: #15171a;
    }

    .kg-header-card.kg-style-accent a.kg-header-card-button {
        background: #ffffff;
        color: var(--ghost-accent-color);
    }

    .kg-audio-card {
        display: flex;
        width: 100%;
        box-shadow: inset 0 0 0 1px rgba(124, 139, 154, 0.25);
    }

    .kg-audio-thumbnail {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 80px;
        min-width: 80px;
        height: 80px;
        background: transparent;
        object-fit: cover;
        aspect-ratio: 1/1;
        border-radius: 3px 0 0 3px;
    }

    .kg-audio-thumbnail.placeholder {
        background: var(--ghost-accent-color);
    }

    .kg-audio-thumbnail.placeholder svg {
        width: 24px;
        height: 24px;
        fill: white;
    }

    .kg-audio-player-container {
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        width: 100%;
        --seek-before-width: 0%;
        --volume-before-width: 100%;
        --buffered-width: 0%;
    }

    .kg-audio-title {
        width: 100%;
        padding: 8px 12px 0;
        border: none;
        font-family: inherit;
        font-size: 1.1em;
        font-weight: 700;
        background: transparent;
    }

    .kg-audio-player {
        display: none;
    }

    .kg-width-full.kg-card-hascaption {
        display: grid;
        grid-template-columns: inherit;
    }

    .post-content table {
        border-collapse: collapse;
        width: 100%;
    }

    .post-content th {
        padding: 0.5em 0.8em;
        text-align: left;
        font-size: .75em;
        text-transform: uppercase;
    }

    .post-content td {
        padding: 0.4em 0.7em;
    }

    .post-content tbody tr:nth-child(2n + 1) {
        background-color: rgba(0,0,0,0.1);
        padding: 1px;
    }

    .post-content tbody tr:nth-child(2n + 2) td:last-child {
        box-shadow:
            inset 1px 0 rgba(0,0,0,0.1),
            inset -1px 0 rgba(0,0,0,0.1);
    }

    .post-content tbody tr:nth-child(2n + 2) td {
        box-shadow: inset 1px 0 rgba(0,0,0,0.1);
    }

    .post-content tbody tr:last-child {
        border-bottom: 1px solid rgba(0,0,0,.1);
    }

    .page-footer {
        padding: 60px 5vmin;
        margin: 60px auto 0;
        text-align: center;
        background-color: #f8f8f8;
    }

    .page-footer h3 {
        margin: 0.5rem 0 0 0;
    }

    .page-footer p {
        max-width: 500px;
        margin: 1rem auto 1.5rem;
        font-size: 1.7rem;
        line-height: 1.5em;
        color: rgba(0,0,0,0.6)
    }

    .powered {
        display: inline-flex;
        align-items: center;
        margin: 30px 0 0;
        padding: 6px 9px 6px 6px;
        border: rgba(0,0,0,0.1) 1px solid;
        font-size: 12px;
        line-height: 12px;
        letter-spacing: -0.2px;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
        font-weight: 500;
        color: #222;
        text-decoration: none;
        background: #fff;
        border-radius: 6px;
    }

    .powered svg {
        height: 16px;
        width: 16px;
        margin: 0 6px 0 0;
    }

    @media (max-width: 600px) {
        body {
            font-size: 1.6rem;
        }
        h1 {
            font-size: 3rem;
        }

        h2 {
            font-size: 2.2rem;
        }
    }

    @media (max-width: 400px) {
        h1 {
            font-size: 2.6rem;
            line-height: 1.15em;
        }
        h2 {
            font-size: 2rem;
            line-height: 1.2em;
        }
        h3 {
            font-size: 1.7rem;
        }
    }

    :root {--ghost-accent-color: #15171A;}
    </style>

    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>

    

</head>

<body class="amp-template">
    <header class="page-header">
        <a href="../../index.html">
                <amp-img class="site-icon" src="https://zairesinatra.github.io//content/images/2021/07/ghost-orb.png" width="50" height="50" layout="fixed" alt="zairesinatra"></amp-img>
        </a>
    </header>

    <main class="content" role="main">
        <article class="post">

            <header class="post-header">
                <h1 class="post-title">Ghost 更新与迁移</h1>
                <section class="post-meta">
                    Ziyi Xie -
                    <time class="post-date" datetime="2021-01-14">14 Jan 2021</time>
                </section>
            </header>
            <figure class="post-image">
                <amp-img src="https://zairesinatra.github.io//content/images/2023/03/TheMigrationOfGhostBlog.png" width="600" height="340" layout="responsive" 
                alt="The Migration Of Ghost Blog"
                ></amp-img>
            </figure>
            <section class="post-content">

                <h2 id="%E5%86%85%E5%AE%B9%E8%BF%BD%E5%8A%A0">内容追加</h2>
<p>最近更新日期：2023-02-08</p>
<p>本次记录迁移至 DigitalOcean 的过程，IP 检查借助 <a href="https://geoiplookup.net/">geoiplookup</a>，Prism.js 配置使用 <a href="http://k88hudson.github.io/syntax-highlighting-theme-generator/www/">k88hudson</a>。</p>
<h3 id="commands-memo">Commands Memo</h3>
<blockquote>
<p><a href="https://docs.digitalocean.com/reference/doctl/how-to/install/">doctl</a>, the DigitalOcean command-line tool, to connect to your Droplet with SSH.</p>
</blockquote>
<p><code>doctl compute ssh</code> 指令：通过提供的 ID 或名称使用 SSH 访问 Droplet。</p>
<pre><code class="language-shell">doctl compute ssh ghostonubuntu2204-digitalocean --ssh-key-path /Users/.../..._id_rsa
</code></pre>
<blockquote>
<p>ssh-add is a command for adding SSH private keys into the SSH authentication agent for implementing single sign-on with SSH.</p>
</blockquote>
<p>将密钥文件路径作为参数提供给 <code>ssh-add</code> 后，即可使用 <code>ssh user@ip</code> 访问。</p>
<pre><code class="language-shell">ssh-add ~/.ssh/..._id_rsa
</code></pre>
<pre><code class="language-shell">ssh -v root@???
</code></pre>
<p>未将私钥添加给 <code>ssh-agent</code> 而直接用 <code>ssh user@ip</code> 访问会出现权限的异常。</p>
<pre><code class="language-shell">debug1: Trying private key: /Users/.../id_dsa
debug1: No more authentication methods to try.
root@143.198.100.???: Permission denied (publickey).
</code></pre>
<p>使用 <code>~/.ssh/config</code> 可简化每次重启就要 <code>ssh-add ~/.ssh/?_rsa</code> 的操作。</p>
<h3 id="mosh">Mosh</h3>
<p>由于最近迁移的服务器部署在 San Francisco，从国内通过 ssh 进行连接时，存在较大的延迟，故使用这款基于 UDP 的 Mosh。</p>
<blockquote>
<p>SSH waits for the server's reply before showing you your own typing. That can make for a lousy user interface. Mosh is different: it gives an instant response to typing, deleting, and line editing.</p>
</blockquote>
<p>VPS 可通过 <code>sudo apt-get install mosh</code> 安装，在开启服务时需要注意防火墙的状态和限制的端口，Ubuntu 可使用 <code>ufw status</code> 进行查看，或使用 <code>lsof -i :60001</code> 进行验证。Local 的 Mac 直接通过 <code>brew install mosh</code> 安装即可。</p>
<p>直接连接时会导致滚动页面的失效，且滚动的是历史命令。这是由于 Mosh 仅是相当于远程服务端的 screen snapshot 所造成的。</p>
<p>如果需要阻止 mosh 替代屏幕，那么应该加上 <code>--no-init</code>。</p>
<pre><code class="language-shell">mosh root@143.198.100.??? --no-init
</code></pre>
<h3 id="add-swap-space">Add Swap Space</h3>
<p>内存负载过高会导致应用不定期的离线以及文件上传失败等问题，除开升级硬件配置以外，也可以通过交换文件的方式来向服务器添加额外的交换空间。</p>
<p>在内存不够的情况下，操作系统会先把内存中暂时不用的数据，存储到硬盘的交换空间，腾出内存来让别的程序运行。具体过程可参考 digitalocean 的 <a href="https://www.digitalocean.com/community/tutorials/how-to-add-swap-space-on-ubuntu-20-04">tutorials</a>。</p>
<h3 id="cloudflare-dns">Cloudflare DNS</h3>
<p>登录状态在 Cloudflare 导航栏中点击 Websites 并选择需要 DNS 的域名，在 Quick Actions 中可以进一步地修改已经设置过的 DNS Settings。</p>
<p>需要注意 Cloudflare 自动完成的域名解析可能会添加不需要的配置：</p>
<ul>
<li>不需要用到的 CDN 服务：将 Proxy status 设置为 DNS only</li>
<li>额外的域名解析：在 Actions 中的 Edit 里删除即可</li>
</ul>
<h2 id="%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B">快速上手</h2>
<h3 id="node">Node</h3>
<p>最新 Ghost 版本需要 Node@14.x，应安装适用于 Ubuntu 的 <a href="https://github.com/nodesource/distributions">二进制发行版</a>。</p>
<pre><code class="language-shell"># Using Ubuntu 添加 Node.js ppa(Person Package achives) 安装 Node.js
# cURL is an abbreviation for Client URL Request Library which is used to transfer data from one place to another place. 
# -f (--fail) 表示在服务器错误时, 阻止一个返回表示错误原因的 html 页面
# -S (--show-error) 使curl在失败时显示错误消息 -s (--silent) 不显示进度表或错误信息的安静模式
# -L (--location) 如果服务器报告请求的页面已移动到其他位置,将使curl在新位置上重新执行请求
curl -fsSL https://deb.nodesource.com/setup_14.x | sudo -E bash -
sudo apt-get install -y nodejs
node -v
# v14.17.2
</code></pre>
<h3 id="ghost">Ghost</h3>
<p>Ghost@v3 需先通过 <code>ghost update v3</code> 获取到最新的 v3.x 版本，再运行 <code>ghost update</code> 升级到 v4。</p>
<p>更新期间出现目录所属权限的问题：使用 <code>sudo chown /var/www/ghost</code> 命令。</p>
<pre><code class="language-shell">sudo systemctl is-active ghost_zairesinatra-com
✔ Checking system Node.js version - found v10.24.0、Ensuring user is not logged in as ghost user
✖ Checking if logged in user is directory owner
✖ Checking current folder permissions
✔ Checking folder permissions、Checking file permissions、Checking content folder ownership、Checking memory availability、Checking free space
One or more errors occurred.

1) Checking if logged in user is directory owner

Message: Your user does not own the directory /var/www/ghost and is also not a member of the owning group.
You must either log in with the user that owns the directory or add your user to the owning group.
Help: https://ghost.org/docs/install/ubuntu/#create-a-new-user

2) Checking current folder permissions

Message: The directory /var/www/ghost is not writable by your user. You must grant write access and try again.
Help: https://ghost.org/docs/install/ubuntu/#create-a-directory

Debug Information:
OS: Ubuntu, v18.04.4 LTS、Node Version: v10.24.0、Ghost Version: 3.41.9、Ghost-CLI Version: 1.17.3、Environment: production、Command: 'ghost update'

Try running ghost doctor to check your system for known issues.
</code></pre>
<p>更新前出现报错：ghost-cli@1.5.0 后 root 不允许运行 Ghost 相关的命令。</p>
<p>解决方式：将当前安装迁移到新的 Linux 用户</p>
<pre><code class="language-shell">We discovered that you are using the DigitalOcean One-Click install. You need to create a user with regular account privileges and migrate your installation to this user.
</code></pre>
<p>增加一个新用户，并添加到 sudo 组。</p>
<pre><code class="language-shell">$ adduser &lt;user&gt;
$ usermod -aG sudo &lt;user&gt;
</code></pre>
<p>创建新实例文件并移动到指定的位置 =&gt; 文件从属关系给予新用户。</p>
<pre><code class="language-shell">$ mkdir -p /home/&lt;user&gt;/.ghost/
$ chown &lt;user&gt;:&lt;user&gt; /home/&lt;user&gt;/.ghost
$ mv /root/.ghost/config /home/&lt;user&gt;/.ghost/config
$ chown &lt;user&gt;:&lt;user&gt; /home/&lt;user&gt;/.ghost/config
</code></pre>
<p>切换到 Ghost 安装目录 <code>/var/www/ghost</code> 以更改所有权，并以新身份登录。</p>
<pre><code class="language-shell">$ cd /var/www/ghost
$ find . -group root -user root -exec chown &lt;user&gt;:&lt;user&gt; {} \;
$ su - &lt;user&gt;
</code></pre>
<p>继续更新；启动后为非 https 状态，需配置 config.production.json 文件后重启。</p>
<pre><code class="language-shell">$ ghost update v3
+ sudo systemctl is-active ghost_zairesinatra-com
✔ Checking system Node.js version - found v14.17.2
✔ Ensuring user is not logged in as ghost user
✔ Checking if logged in user is directory owner
✔ Checking current folder permissions
✔ Checking folder permissions
✔ Checking file permissions
✔ Checking content folder ownership
✔ Checking memory availability
✔ Checking free space
✔ Checking for available migrations
✔ Checking for latest Ghost version

# 3.42.5

This release contains a security patch.

* 🔒 Added a way to hide the secret settings once they are set - Thibaut Patel

---

View the changelogs for full details:
* Ghost - https://github.com/tryghost/ghost/compare/3.42.4...3.42.5
* Ghost-Admin - https://github.com/tryghost/admin/compare/3.42.4...3.42.5

✔ Fetched release notes
Version already installed.
ℹ Downloading and updating Ghost [skipped]
✔ Linking latest Ghost and recording versions
ℹ Removing old Ghost versions [skipped]
newghostzs@VM-4-10-ubuntu:/var/www/ghost$ ghost update
+ sudo systemctl is-active ghost_zairesinatra-com
✔ Checking system Node.js version - found v14.17.2
✔ Ensuring user is not logged in as ghost user
✔ Checking if logged in user is directory owner
✔ Checking current folder permissions
✔ Checking folder permissions
✔ Checking file permissions
✔ Checking content folder ownership
✔ Checking memory availability
✔ Checking free space
✔ Checking for available migrations
✔ Checking for latest Ghost version

# 4.10.1

* 🐛 Fixed GScan error when handling partials with undefined names - Thibaut Patel

---

View the changelogs for full details:
* Ghost - https://github.com/tryghost/ghost/compare/v4.10.0...v4.10.1
* Admin - https://github.com/tryghost/admin/compare/v4.10.0...v4.10.1

✔ Fetched release notes
✔ Downloading and updating Ghost to v4.10.1


Checking theme compatibility for Ghost 4.10.1

✔ Your theme is compatible.

You can also check theme compatibility at https://gscan.ghost.org

Please review the full list of breaking changes at https://ghost.org/docs/changes/

? Are you sure you want to proceed with migrating to Ghost 4.10.1? Yes
✔ Updating to a major version
✔ Linking latest Ghost and recording versions
✔ Removing old Ghost versions
</code></pre>
<h3 id="nginx">Nginx</h3>
<p>考虑到直接输入根域名重定向到 www 的页面，在 ghost 自带生成的 nginx ssl 配置外，额外自行写一个 nginx 重定向的 conf 配置。</p>
<pre><code class="language-shell"># sites-available 中的 zs.com-ssl.conf
server {
	#监听 80 和 443端口
        listen 80;
        listen 443 ssl http2;
        #域名
        server_name	zs.com;
        # 放置的项目路径
        root /var/www/html;
        # 显示首页
        index index.html;
        # 配置ssl证书的位置-放置位置
        # 也可通过 ghost config url https://xxx.com 与 ghost setup nginx ssl 完成
        # ghost 初次设置了url后可通过 ghost setup ssl 直接生成 ssl nginx 配置
        ssl_certificate	/etc/nginx/ssl/zs.com_nginx/zs.com_bundle.crt;
        ssl_certificate_key	/etc/nginx/ssl/zs.com_nginx/zs.com.key;
        #开启强制http跳转https
        if ($server_port = 80){
       	rewrite ^(/.*)$ https://$host$1 permanent;
       	}
	location / {
		return 301 https://www.zs.com$request_uri;
	}
}
</code></pre>
<pre><code class="language-shell"># 建立软连接
$ ln -s /etc/nginx/sites-available/zs.com-ssl.conf /etc/nginx/sites-enabled/zs.com-ssl.conf
</code></pre>
<pre><code class="language-shell"># 测试配置文件
$ sudo nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
# 重启服务
$ sudo nginx -s reload
</code></pre>
<h3 id="lets-encrypt">Let's Encrypt</h3>
<p>收到官方邮件的提醒，表示在一定时间后 LetsEncrypt 的证书将要到期，这里值得注意的是，通过 Ghost 集成的 LetsEncrypt 证书只有 90 天的有效期，意味着需要一个季度手动更新一次。</p>
<blockquote>
<p>Your certificate (or certificates) for the names listed below will expire in 17 days (on 20 Jul 19 07:56 +0000). Please make sure to renew your certificate before then, or visitors to your web site will encounter errors.<br />
We recommend renewing certificates automatically when they have a third of their total lifetime left. For Let's Encrypt's current 90-day certificates, that means renewing 30 days before expiration. See <a href="https://letsencrypt.org/docs/integration-guide/">https://letsencrypt.org/docs/integration-guide/</a> for details.</p>
</blockquote>
<ul>
<li>Renew Ghost Let's Encrypt SSL</li>
</ul>
<pre><code class="language-shell"># Renew certificate
ghost setup ssl-renew
# Switch to root user
sudo su
# Upgrade acme.sh inside letsencrypt
"/etc/letsencrypt"/acme.sh --upgrade --home "/etc/letsencrypt"
# Renew SSL through acme.sh
"/etc/letsencrypt"/acme.sh --cron --home "/etc/letsencrypt" --debug --log
# 执行到这一步若出现 Add '--force' to force to renew. 的提示表示当前还是处于有效期, 需要进行强行更新
"/etc/letsencrypt"/acme.sh --cron --home "/etc/letsencrypt" --debug --log --force
# 查看当前证书信息
/etc/letsencrypt/acme.sh --home "/etc/letsencrypt" --list
</code></pre>
<ul>
<li>check expiry date of SSL cert for ghost blog =&gt; <a href="https://www.thesslstore.com/knowledgebase/ssl-support/how-to-check-a-certificates-expiration-date-chrome/">clickme</a></li>
</ul>
<p>Chrome 中点开 view site information 并选择 connection is secure，在 certificate is valid 中查看。</p>
<h2 id="%E7%89%88%E6%9C%AC%E8%BF%AD%E4%BB%A3">版本迭代</h2>
<p>由于 Ghost 或 Node 版本的更新会导致部分内容存在不兼容的情况，此章节记录对于这种改动处理时需要注意的方面。</p>
<h3 id="ghost-init">Ghost Init</h3>
<pre><code class="language-css">.post-template .gh-head,
.page-template .gh-head {
  background: #000000 !important;
}
.site-footer {
  background: #000000 !important;
}
.post-card-tags {
  color: var(--color-secondary-text) !important;
}
.gh-portal-triggerbtn-container.with-label::before {
  display: none !important;
}
/* 需提前，否则闪烁 */
.footer-cta,
a.gh-head-button {
  display: none;
}
</code></pre>
<h3 id="update-node">Update Node</h3>
<pre><code class="language-shell">$ npm install -g ghost-cli@latest
added 491 packages, and audited 492 packages in 24s
41 packages are looking for funding
  run `npm fund` for details
6 vulnerabilities (5 moderate, 1 high)
To address all issues (including breaking changes), run:
  npm audit fix --force
Run `npm audit` for details.
</code></pre>
<p><a href="https://docs.npmjs.com/cli/v8/commands/npm-audit">npm audit</a> 命令将项目中配置的依赖项的描述提交到默认注册表，并要求报告已知漏洞。如果发现任何漏洞，将计算影响和适当的补救措施。如果没有发现漏洞，该命令将以 0 退出代码退出；若某些漏洞无法自动修复，则需要人工干预或审查。</p>
<pre><code class="language-shell">$ npm audit fix --force
npm WARN using --force Recommended protections disabled.
npm ERR! code ENOLOCK
npm ERR! audit This command requires an existing lockfile.
npm ERR! audit Try creating one first with: npm i --package-lock-only
npm ERR! audit Original error: loadVirtual requires existing shrinkwrap file
npm ERR! A complete log of this run can be found in: /Users/xieziyi/.npm/_logs/2022-07-27T05_03_02_392-debug-0.log
</code></pre>
<p>执行指导修复的代码 <code>npm i --package-lock-only</code>，没有 package.json 文件。</p>
<pre><code class="language-shell">$ npm i --package-lock-only
npm ERR! code ENOENT
npm ERR! syscall open
npm ERR! path /Users/xieziyi/package.json
npm ERR! errno -2
npm ERR! enoent ENOENT: no such file or directory, open '/Users/xieziyi/package.json'
npm ERR! enoent This is related to npm not being able to find a file.
npm ERR! enoent
npm ERR! A complete log of this run can be found in:
npm ERR! /Users/xieziyi/.npm/_logs/2022-07-27T05_03_19_779Z-debug-0.log
</code></pre>
<p>在当前目录进行 npm 初始化创建 package.json 文件。</p>
<pre><code class="language-shell">$ cd /Users/xieziyi
$ npm init -y
Wrote to /Users/xieziyi/package-json:{...}
$ npm install -g ghost-cli@latest
changed 491 packages, and audited 492 packages in 3s
41 packages are looking for funding
  run `npm fund` for details
6 vulnerabilities (5 moderate, 1 high)
To address all issues (including breaking changes), run: npm audit fix --force
Run `npm audit` for details.
$ npm fund
xieziyi@1.0.0
$ npm audit fix --force
npm WARN using --force Recommended protections disabled.
up to date, audited 1 package in 89ms
found 0 vulnerabilities
</code></pre>
<h3 id="update-ghost">Update Ghost</h3>
<p>ghost update 会取代旧版本服务，对于旧版文件的更改将失效，需要在新 version 中再次进行配置。</p>
<ul>
<li>2022-08-21 更新 =&gt; v5.10.1</li>
</ul>
<p><a href="https://ghost.org/integrations/disqus/">Disqus</a> 在 Ghost v5.10.1 中不再有 65-69 行的评论代码块提示。可在 Ghost 新增特性 comments 代码块下追加 Disqus 代码。</p>
<pre><code class="language-hbs">{{#if comments}}
    &lt;section class="article-comments gh-canvas"&gt;
        {{comments}}
    &lt;/section&gt;
{{/if}}
&lt;section class="article-comments gh-canvas"&gt;
    &lt;div id="disqus_thread"&gt;&lt;/div&gt;
    &lt;script&gt;
        var disqus_config = function () {
            this.page.url = "{{url absolute="true"}}";
            this.page.identifier = "ghost-{{comment_id}}"
        };
        (function() {
        var d = document, s = d.createElement('script');
        s.src = 'https://zsxzy.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();
    &lt;/script&gt;
&lt;/section&gt;
</code></pre>
<h3 id="ghost-github-pages">Ghost &amp; Github Pages</h3>
<p>虽然 GitHub Pages 上 Jekyll 与 Ghost 项目仍然在稳定运行，但因为有科学上网的限制，可能会存在访问上的痛点。考虑到往后的迁移，故记录备份与配置的过程。</p>
<p>命令 <code>ghost start|stop</code> 须在该安装 Ghost 的文件夹目录下执行，否则会出现 <code>Working directory is not a recognisable Ghost installation.</code> 的错误。</p>
<p>将 Local Ghost 生成静态页面步骤如下：</p>
<ul>
<li>将 <a href="https://github.com/Zairesinatra/myShare/blob/main/gui.sh">shellScript</a> 保存在本地 Ghost 网站的根目录中，用于将 Local Ghost 编译成静态页面</li>
<li>修改该文件中 <code># Define urls and https</code> 部分</li>
</ul>
<pre><code class="language-shell"># Define urls and https
from_url=https://zairesinatra.github.io/ # change this if your local ghost url is different
to_url=yourdomain.com # change it to your real domain name (no add https)
to_https=true # set true to enable HTTPS (e.g. GitHub Pages)
</code></pre>
<ul>
<li>键入 <code>chmod +x gui.sh</code> 增加 shellScript 权限</li>
<li>运行脚本，生成静态文件目录</li>
</ul>
<pre><code class="language-shell"> ./gui.sh or source gui.sh or sh gui.sh
</code></pre>
<h2 id="bugs-%E8%A7%A3%E5%86%B3">Bugs 解决</h2>
<h3 id="internal-server-error">Internal Server Error</h3>
<p>通过 FTP 将所有图片复制到 VPS 下的 /var/www/ghost/content/images 目录。在准备上传文章的配图时，提示上传失败，原因说是内部服务器的错误。</p>
<p>当无法保存图片时，通常可以考虑一下问题是否出在了文件夹的权限方面。众所周知，应该使用特定的用户来访问和修改博客的内容。</p>
<pre><code class="language-shell">sudo chown -R &lt;ghostuser&gt;:&lt;ghostuser&gt; ./content
</code></pre>
<p>就在本人认为问题已经得到解决的时候，又出现了如下的异常：</p>
<pre><code class="language-shell">$ ghost start
+ sudo systemctl is-active ghost_www-zairesinatra-com
✔ Checking system Node.js version - found v16.14.2
✔ Ensuring user is not logged in as ghost user
✔ Checking if logged in user is directory owner
✔ Checking current folder permissions
+ sudo systemctl is-active ghost_www-zairesinatra-com
✔ Validating config
✔ Checking folder permissions
✔ Checking file permissions
✔ Checking memory availability
✔ Checking binary dependencies
✔ Checking systemd unit file
✔ Checking systemd node version - found v16.14.2
✖ Starting Ghost: www-zairesinatra-com
A SystemError occurred.

Message: Systemd process manager has not been set up or is corrupted.
Help: Run ghost setup linux-user systemd and try again.

Debug Information:
    OS: Ubuntu, v18.04.4 LTS
    Node Version: v16.14.2
    Ghost Version: 4.44.0
    Ghost-CLI Version: 1.19.3
    Environment: production
    Command: 'ghost start'

Try running ghost doctor to check your system for known issues.

You can always refer to https://ghost.org/docs/ghost-cli/ for troubleshooting.
</code></pre>
<p>欲通过 <code>ghost setup</code> 重设配置，但出现了跳过部分配置的情况。</p>
<pre><code class="language-shell">$ ghost setup linux-user systemd
Systemd service has already been set up. Skipping Systemd setup
ℹ Setting up Systemd [skipped]
</code></pre>
<p><a href="https://ghost.org/docs/ghost-cli/">官方文档</a>表示某些输出可能不会存在日志文件中，可尝试 <code>ghost run</code> 命令。</p>
<pre><code class="language-shell">$ ghost run
INFO Ghost is running in production...
...
Sharp wasn't installed
</code></pre>
<p>在 Github Issues 上查到与 Sharp 相关的问题 =&gt; <a href="https://github.com/TryGhost/Ghost/issues/10421">点此</a>。</p>
<p>这是更换了文件夹内容后出现的状况，且开始并未表示 Sharp 存在问题，根据<a href="https://github.com/TryGhost/Ghost-CLI/issues/397">此处</a>的理解，尝试重新进行设置，可成功的完成修复。</p>
<blockquote>
<p>"Directory was linked using NFS so ghost-cli couldn't change its permissions or owner, therefore it kind of silently failed where it did."</p>
</blockquote>
<pre><code class="language-shell">$ id -u ghost
$ stat /var/www/&lt;ghost-blog&gt;
$ ghost setup # or ghost setup systemd
</code></pre>
<h3 id="cascading-problems-caused-by-version-compatibility">Cascading problems caused by version compatibility</h3>
<p>Ghost cannot be installed normally in some specific Node version environments, so nvm is usually used to install multiple Node versions.</p>
<p>Since there are no precompiled NodeJS binaries for versions prior to 15.x for Apple's new M1 chip (arm64 architecture). I encountered some problems when using nvm: when using <code>nvm install v14.15.4</code> to install Node, the compilation was successful, but the installation failed.</p>
<pre><code class="language-shell"># 为下载预编译的 x64 二进制文件 =&gt; 将 shell 的体系结构从 arm64 更改为 x86
$ arch -x86_64 zsh
# 输出机器的体系结构 =&gt; 结果有 i386、i486、mips、alpha
$ arch
i386
# 使用 nvm 安装节点
$ nvm install v14.17.1
# 检查架构是否正确
node -p process.arch
x86
</code></pre>
<p>多提一句，体系结构的粘性是从 Rosetta 在 PowerPC 到 Intel 过渡中的工作方式的一种变化，在 macOS Big Sur 中，如果可以最大程度地提高兼容性，子进程将更喜欢父进程的架构。因此，例如启动 x86_64 sh 将导致来自该 shell 的 python 调用也是 x86_64。</p>
<h3 id="kexexchangeidentification">kex_exchange_identification</h3>
<p>在使用 <code>doctl compute ssh...</code> 访问 Droplet 时出现 port 22 直接关闭的情况。</p>
<pre><code class="language-shell">$ doctl compute ssh ghostonubuntu2204-digitalocean --ssh-key-path ~/.ssh/digitalocean_id_rsa
kex_exchange_identification: Connection closed by remote host
Connection closed by ??? port 22
Error: exit status 255
</code></pre>
<p>使用 <code>ssh -v user@ip</code> Verbose Mode 进行 debug 如下。</p>
<pre><code class="language-shell">$ ssh -v root@???
OpenSSH_9.0p1, LibreSSL 3.3.6
debug1: Reading configuration data ~/.ssh/config
debug1: Reading configuration data /etc/ssh/ssh_config
...
debug1: Local version string SSH-2.0-OpenSSH_9.0
kex_exchange_identification: Connection closed by remote host
Connection closed by ??? port 22
</code></pre>
<p>Ubuntu 22.04 中出现 "Connection refused by port 22" 的常见原因：</p>
<ul>
<li>没有安装 OpenSSH 的包</li>
<li>SSH 服务未激活</li>
<li>错误的端口连接</li>
<li>防火墙的规则阻止了连接请求</li>
<li>开启了全局模式的代理</li>
<li>文件 <code>/etc/ssh/sshd_config</code> 中 MaxStartups 和 MaxSessions 的限制</li>
</ul>
<pre><code class="language-shell"># Check the OpenSSH installation
$ sudo apt list --installed | grep openssh-server
# If the OpenSSH package is not installed
$ sudo apt install openssh-server -y
</code></pre>
<pre><code class="language-shell"># View the status of the SSH server
$ sudo systemctl status ssh
# To activate the service,
$ sudo systemctl start ssh
</code></pre>
<pre><code class="language-shell"># Check sshd port
$ sudo netstat -ltnp | grep sshd
# Specify port for ssh connection
$ ssh -p [port_number] [username]@[ip_address]
</code></pre>
<blockquote>
<p>SSH is a popular and effective way to connect to remote Linux machines in the command line. The ssh daemon (sshd) reads the configuration file located in /etc/ssh/sshd_config.</p>
</blockquote>
<blockquote>
<p>The MaxStartups setting specifies the maximum number of concurrent unauthenticated connections to the SSH daemon. Additional connections are dropped until authentication succeeds or the LoginGraceTime expires for a connection.</p>
</blockquote>
<p><code>MaxStartups</code> 中的 <code>start:rate:full</code> 表示当连接数达到 start 时，就会开始有 rate 的概率拒绝连接；当连接数达到 full 时，后续的连接将被全部拒绝。</p>
<blockquote>
<p>The MaxSessiosn setting defines the maximum number of open sessions per connection.</p>
</blockquote>
<p>要禁用 shell 的多路复用时，可以将其值设置为 <code>1</code>。将 <code>MaxSessiosn</code> 设置为 <code>0</code> 时会禁用所有的会话，包括 login、shell 和 subsystem。</p>
<h3 id="ssh-acceleration-and-optimization">SSH acceleration and optimization</h3>
<p>A 记录解析域名到 IP 地址，而 PTR 记录解析 IP 地址到域名。</p>
<blockquote>
<p>A PTR (pointer) record maps an IP address to the domain name. It's often called a "reverse DNS entry" because it converts an IP address to a name.</p>
</blockquote>
<p>服务器会先根据 Client IP 进行 DNS PTR 反向查询 Domain 或 Hostname，然后根据查询出的客户端域名或主机名进行 DNS 正向 A 记录查询，并验证是否与原始 IP 地址一致，以此来防止客户端的欺骗。</p>
<p>由于常规使用的都是没有 PTR 记录的动态 IP，所以这种验证并没有太大的作用。</p>
<p>GSSAPI 全称是 Generic Security Services API，在这里主要是作为一种 OpenSSH Authentication 的方式。</p>
<p>OpenSSH Authentication Methods:</p>
<ul>
<li>Password authentication: Client will ask you to enter a password, will encrypt it and use it to authenticate itself to a server.</li>
<li>Public key authentication: Each client uses a key pair to authenticate itself to a server. Server should find the key in the list of allowed keys.</li>
<li>Host based authentication: This method is similar to public key authentication, but client should not only use correct key, but also must connect from correct host.</li>
<li>Keyboard authentication: Server will use client to present zero or more prompts to client PC operator and request answers from operator.</li>
<li>Challenge Response Authentication: Used to configure keyboard authentication. You should use specific backend send the challenges and check the responses.</li>
<li>GSSAPI Authentication: GSSAPI is a IETF standard for strong encrypted authentication. OpenSSH uses GSSAPI and kerberos 5 code to authenticate clients.</li>
</ul>
<p>密码或者公钥的认证并不会阻止系统执行 GSSAPI Authentication 的过程，那么连接时就难免在此处消耗一定的时间，造成 SSH 登录慢的体验。</p>
<p>综上，可将 <code>UseDNS</code> 与 <code>GSSAPIAuthentication</code> 设置 <code>no</code>，并重启 ssh 服务。</p>
<blockquote>
<p>The service command is a wrapper script that allows system administrators to start, stop, and check the status of services without worrying too much about the actual init system being used. Prior to systemd's introduction, it was a wrapper for /etc/init.d scripts and Upstart's initctl command, and now it is a wrapper for these two and systemctl as well. - <a href="https://askubuntu.com/questions/903354/difference-between-systemctl-and-service-commands">askubuntu</a></p>
</blockquote>
<blockquote>
<p>The Secure Shell Daemon application (SSH daemon or sshd) is the daemon program for ssh. This program is an alternative to rlogin and rsh and provides encrypted communications between two untrusted hosts over an insecure network. The sshd is the daemon that listens for connections from clients on port 22.</p>
</blockquote>
<pre><code class="language-yaml"># /etc/ssh/sshd_config
UseDNS no
GSSAPIAuthentication no
</code></pre>
<pre><code class="language-shell">service sshd restart
systemctl restart sshd.service
</code></pre>
<pre><code class="language-shell"># shorthand
sed -i -e 's/UseDNS yes/UseDNS no/g' -e 's/GSSAPIAuthentication yes/GSSAPIAuthentication no/g' /etc/ssh/sshd_config &amp;&amp; systemctl restart sshd.service
</code></pre>
<p>因服务器部署在海外地区，除开上述的配置外，还可以采取代理服务器的方法进行远程连接。OpenSSH ProxyJump 和 ProxyCommand 指令可以让 SSH 通过 Jump Host 连接到 Remote Server。Jump Host 也称作 Jump Server 或 Bastion Host。</p>
<p>A Bastion Host or a Jump Server is an intermediary device that an SSH client connects to first before accessing the target remote Linux system. An SSH Jump server acts as a gateway to your IT resources, thus reducing the attack surface.</p>
<pre><code class="language-shell"># Dynamic jump host list
ssh -J username1@host1:port,username2@host2:port username3@host3:port
</code></pre>
<pre><code class="language-shell"># Static jump host list
# ~/.ssh/config
Host vps1
  HostName vps1.example.org
  User ...
  PreferredAuthentications password
Host ultimateVps
  HostName ultimateVps.example.org
  PreferredAuthentications publickey
  IdentityFile ~/.ssh/..._id_rsa
  ProxyJump vps1
</code></pre>
<p>通常情况下，国内与海外服务器的网络路由可能会因为一个结点的拥堵而导致网络质量的降级。在长距离的跨国网络中，众多路由节点都会存在有拥堵的风险，那么此时可以考虑在合适的位置添加一个额外的路由节点来改变原本的路由，绕过某些可能会造成拥堵的节点，那么就可以缩短链路的距离，改善网络的质量。</p>
<pre><code class="language-shell">scp -vrCo 'ProxyJump root@vps1' root@ultimateVps:/.../... /Users/...
</code></pre>
<h3 id="%E8%B7%AF%E5%BE%84%E5%90%8E%E7%BC%80%E9%94%99%E8%AF%AF%E6%89%80%E5%AF%BC%E8%87%B4%E7%9A%84%E5%9B%BE%E6%98%BE%E5%A4%B1%E8%B4%A5">路径后缀错误所导致的图显失败</h3>
<p><amp-img src="https://res.cloudinary.com/dzb9ldnvl/image/upload/v1676476821/Ghost/GhostConfigGithubPages/blogsrcerror_sbtvqy.png" alt="blogsrcerror" width="2560" height="450" layout="responsive"></amp-img></p>
<p>因默认自动编译生成的是动态网站，而实际需编译成静态网站时，应当修改默认文件中的相关配置。将所有的 <code>.hbs</code> 文件中的格式选型代码进行指定删减。</p>
<pre><code class="language-html">{{#if feature_image}}
  &lt;figure class="article-image"&gt;
    {{!-- This is a responsive image, it loads different sizes depending on device
    https://medium.freecodecamp.org/a-guide-to-responsive-images-with-ready-to-use-templates-c400bd65c433 --}}
    &lt;img
      srcset="{{img_url feature_image size="xl"}} 2000w"
      sizes="(min-width: 1400px) 1400px, 92vw"
      src="{{img_url feature_image size="xl"}}"
      alt="{{title}}"
    /&gt;
  &lt;/figure&gt;
{{/if}}
</code></pre>
<h3 id="%E6%9B%B4%E6%96%B0%E6%89%80%E8%87%B4%E7%9A%84%E6%95%B0%E6%8D%AE%E5%81%87%E6%80%A7%E4%B8%A2%E5%A4%B1">更新所致的数据假性丢失</h3>
<p>根目录中存在一个叫 <code>config.development.json</code> 的配置文件，这个文件决定了启动的端口号以及所使用的数据库等内容。</p>
<p>Ghost 默认使用 sqlite3 数据库（我记得以前使用的是 MySQL？），那么数据消失的问题就应该查看环境中对数据库的配置是否出现了异常。</p>
<p><code>config.development.json</code> 中 sqlite3 被指定为了 ghost-dev，故进行改正。</p>
<pre><code class="language-json">"database": {
  "client": "sqlite3",
  "connection": {
    "filename": "/Users/.../zs-ghost/content/data/ghost-local.db"
  }
}
</code></pre>
<p>若需要将 sqlite3 迁移到 MySQL，可参考如下配置。<a href="https://ghost.org/docs/faq/troubleshooting-mysql-database/">troubleshooting</a></p>
<pre><code class="language-json">"database": {
  "client": "mysql",
  "connection": {
    "host": "127.0.0.1",
    "user": "???",
    "password": "???",
    "database": "ghost-dev",
    "charset": "utf8"
  }
},
</code></pre>
<p>注意此处 <code>host</code> 不能设置为 <code>localhost</code>，否则会出现启动异常。</p>
<pre><code class="language-shell">Ghost was able to start, but errored during boot with: connect ECONNREFUSED ::1:3306
</code></pre>
<h2 id="%E7%BB%93%E6%9D%9F">结束</h2>
<p>本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh"> CC BY-SA 4.0 协议 </a>，转载请注明出处！</p>


            </section>

        </article>
    </main>
    <footer class="page-footer">
            <amp-img class="site-icon" src="https://zairesinatra.github.io//content/images/2021/07/ghost-orb.png" width="50" height="50" layout="fixed" alt="zairesinatra"></amp-img>
        <h3>zairesinatra</h3>
            <p>The best time to recognize yourself is ten years ago, followed by now.</p>
        <p><a href="../../index.html">Read more posts →</a></p>
        <a class="powered" href="https://ghost.org" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 156 156"><g fill="none" fill-rule="evenodd"><rect fill="#15212B" width="156" height="156" rx="27"/><g transform="translate(36 36)" fill="#F6F8FA"><path d="M0 71.007A4.004 4.004 0 014 67h26a4 4 0 014 4.007v8.986A4.004 4.004 0 0130 84H4a4 4 0 01-4-4.007v-8.986zM50 71.007A4.004 4.004 0 0154 67h26a4 4 0 014 4.007v8.986A4.004 4.004 0 0180 84H54a4 4 0 01-4-4.007v-8.986z"/><rect y="34" width="84" height="17" rx="4"/><path d="M0 4.007A4.007 4.007 0 014.007 0h41.986A4.003 4.003 0 0150 4.007v8.986A4.007 4.007 0 0145.993 17H4.007A4.003 4.003 0 010 12.993V4.007z"/><rect x="67" width="17" height="17" rx="4"/></g></g></svg> Published with Ghost</a>
    </footer>
    
</body>
</html>
