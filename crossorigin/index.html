<!DOCTYPE html>
<html lang="en">
<head>

    <title>非同源策略请求</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="../assets/built/screen.css%3Fv=7d64696598.css" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.18.2/tocbot.css">
    <link rel="stylesheet" type="text/css" href="../assets/css/screen.css%3Fv=7d64696598.css" />
    <meta name="description" content="跨域 &#x3D;&gt; JSONP—CORS—Proxy" />
    <link rel="icon" href="../content/images/size/w256h256/2021/07/ghost-orb.png" type="image/png" />
    <link rel="canonical" href="index.html" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="amp/index.html" />
    
    <meta property="og:site_name" content="zairesinatra" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="非同源策略请求" />
    <meta property="og:description" content="跨域 &#x3D;&gt; JSONP—CORS—Proxy" />
    <meta property="og:url" content="https://zairesinatra.github.io//crossorigin/" />
    <meta property="og:image" content="https://zairesinatra.github.io//content/images/2023/02/familyguy.jpg" />
    <meta property="article:published_time" content="2021-02-14T13:47:00.000Z" />
    <meta property="article:modified_time" content="2023-02-19T09:49:11.000Z" />
    <meta property="article:tag" content="Technology growth" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="非同源策略请求" />
    <meta name="twitter:description" content="跨域 &#x3D;&gt; JSONP—CORS—Proxy" />
    <meta name="twitter:url" content="https://zairesinatra.github.io//crossorigin/" />
    <meta name="twitter:image" content="https://zairesinatra.github.io//content/images/2023/02/familyguy.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Ziyi Xie" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Technology growth" />
    <meta name="twitter:site" content="@xieziyi0422" />
    <meta property="og:image:width" content="1920" />
    <meta property="og:image:height" content="1080" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "zairesinatra",
        "url": "https://zairesinatra.github.io//",
        "logo": {
            "@type": "ImageObject",
            "url": "https://zairesinatra.github.io//content/images/2021/07/zs-1.JPG",
            "width": 60,
            "height": 60
        }
    },
    "author": {
        "@type": "Person",
        "name": "Ziyi Xie",
        "image": {
            "@type": "ImageObject",
            "url": "https://zairesinatra.github.io//content/images/2021/07/zs-2.JPG",
            "width": 1079,
            "height": 1079
        },
        "url": "https://zairesinatra.github.io//author/ziyi/",
        "sameAs": []
    },
    "headline": "非同源策略请求",
    "url": "https://zairesinatra.github.io//crossorigin/",
    "datePublished": "2021-02-14T13:47:00.000Z",
    "dateModified": "2023-02-19T09:49:11.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://zairesinatra.github.io//content/images/2023/02/familyguy.jpg",
        "width": 1920,
        "height": 1080
    },
    "keywords": "Technology growth",
    "description": "跨域 &#x3D;&gt; JSONP—CORS—Proxy",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://zairesinatra.github.io//"
    }
}
    </script>

    <meta name="generator" content="Ghost 5.33" />
    <link rel="alternate" type="application/rss+xml" title="zairesinatra" href="../rss/index.html" />
    <script defer src="https://cdn.jsdelivr.net/ghost/portal@~2.24/umd/portal.min.js" data-ghost="https://zairesinatra.github.io//" data-key="f5d74add11f1d16d3e59c12945" data-api="https://zairesinatra.github.io//ghost/api/content/" crossorigin="anonymous"></script><style id="gh-members-styles">.gh-post-upgrade-cta-content,
.gh-post-upgrade-cta {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    text-align: center;
    width: 100%;
    color: #ffffff;
    font-size: 16px;
}

.gh-post-upgrade-cta-content {
    border-radius: 8px;
    padding: 40px 4vw;
}

.gh-post-upgrade-cta h2 {
    color: #ffffff;
    font-size: 28px;
    letter-spacing: -0.2px;
    margin: 0;
    padding: 0;
}

.gh-post-upgrade-cta p {
    margin: 20px 0 0;
    padding: 0;
}

.gh-post-upgrade-cta small {
    font-size: 16px;
    letter-spacing: -0.2px;
}

.gh-post-upgrade-cta a {
    color: #ffffff;
    cursor: pointer;
    font-weight: 500;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a:hover {
    color: #ffffff;
    opacity: 0.8;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a.gh-btn {
    display: block;
    background: #ffffff;
    text-decoration: none;
    margin: 28px 0 0;
    padding: 8px 18px;
    border-radius: 4px;
    font-size: 16px;
    font-weight: 600;
}

.gh-post-upgrade-cta a.gh-btn:hover {
    opacity: 0.92;
}</style>
    <script defer src="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/sodo-search.min.js" data-key="f5d74add11f1d16d3e59c12945" data-styles="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/main.css" data-sodo-search="https://zairesinatra.github.io//" crossorigin="anonymous"></script>
    <link href="https://zairesinatra.github.io//webmentions/receive/" rel="webmention" />
    <script defer src="../public/cards.min.js%3Fv=7d64696598"></script>
    <link rel="stylesheet" type="text/css" href="../public/cards.min.css%3Fv=7d64696598.css">
    <script defer src="../public/member-attribution.min.js%3Fv=7d64696598"></script>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NXZH6Q3K52"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NXZH6Q3K52');
</script>
<!-- Ghost Init -->
<style>
.post-template .gh-head,
.page-template .gh-head {
  background: #000000 !important;
}
.site-footer {
  background: #000000 !important;
}
.post-card-tags {
  color: var(--color-secondary-text) !important;
}
.gh-portal-triggerbtn-container.with-label::before {
  display: none !important;
}
/* 需提前，否则闪烁 */
.footer-cta,
a.gh-head-button {
  display: none;
}
.algoliaouterwrapper i svg {
  width: 0;
}
/* 更多内容去除外边距 */
.footer-cta + .read-more-wrap {
  margin-top: unset;
}
</style>

<!-- 2023 => prismjs -->
<script src="https://res.cloudinary.com/dzb9ldnvl/raw/upload/v1679662056/Ghost/prism_i9a8up.js"></script>
<link rel="stylesheet" href="https://res.cloudinary.com/dzb9ldnvl/raw/upload/v1679662068/Ghost/prism_mdfwkg.css"/>
<!-- Patch: additional supported languages -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-vim.min.js" integrity="sha512-P1MRK1H11qw68MAfAYVyjumLuurOQKO4wwcx4S2Nbbae9CndG92dkIXq34lsOeMFlWZoT7nVPgsOy3gepk93Bg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<!-- Activate Line Numbers in PrismJS -->
<script>
	window.addEventListener('DOMContentLoaded', (event) => {      
		document.querySelectorAll('pre[class*=language-]').forEach(function(node) {
			node.classList.add('line-numbers');
            node.style.border = 'solid #FFFFFF 1px'
		});
		Prism.highlightAll();
	});
</script>
<!-- Resize Pre Area in PrismJS -->
<style>
    pre[class*="language-"].line-numbers{
		font-size: 0.8em;
        background-color: #202324;
    }
    code[class*="language-"] {
        background-color: transparent !important;
    }
</style>

<!-- TOC -->
<style>
    .toc > .toc-list li:first-child {
      margin-top: 8px;
    }
    .toc-list a {
      color: #000000 !important;
      text-decoration: none;
      word-break: break-word;
    }
    .toc > ol, .toc > li{
      font-size: 1.4rem;
    }
    
    .toc.active > .toc-list li:first-child {
      margin-top: 8px;
    }
    .toc.active .toc-list a {
      color: #FFFFFF !important;
      text-decoration: none;
      word-break: break-word;
    }
    .toc.active > ol, .toc.active > li{
      font-size: 1.4rem;
    }
</style>

<!-- ghost style by wkzs -->
<style>
.gh-content > [id] + * {
  margin-top: 2.5rem !important;
}
.gh-content > [id]:not(:first-child) {
  margin: 1.5em 0 0;
}
.gh-content > hr + *, .gh-content > blockquote + * {
  margin-top: max(1.1rem, 16px) !important;
}
.gh-content > [id]:not(:first-child) {
  margin: 1em 0 0;
}
.gh-content > * + * {
  margin-top: max(1.6vmin, 16px);
  margin-bottom: 0;
}
.gh-content > blockquote:not([class]), .gh-content > ol, .gh-content > ul, .gh-content > dl, .gh-content > p {
    font-family: var(--font-serif);
    font-weight: 400;
    font-size: 1.6rem;
    line-height: 1.6em;
    margin-top: 1.6rem;
}
</style>

<!-- Theme Change -->
<style>
@keyframes slideUp {
  from {
    bottom: 100px;
    opacity: 0;
  }
  to {
    bottom: 0;
    opacity: 1;
  }
}
.theme-switcher-wrap {
  width: 42px;
  height: 24px;
  text-align: right;
}
@media (max-width: 767px) {
  .gh-head-open .theme-switcher-wrap {
    width: 42px;
    height: 24px;
    text-align: right;
    animation: slideUp 1s ease-in-out forwards;
  }
}
.theme-switcher {
  display: inline-block;
  cursor: pointer;
}
.switch-path {
  width: 42px;
  height: 24px;
  border-radius: 10px;
  background-color: #f2f2f2;
  border: #dddfe6 1px solid;
}
.switch-path > .switch-handle {
  background-color: #ffffff;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  transition: all 0.3s ease-in-out;
}
.switch-handle .dark-icon {
  visibility: hidden;
  display: none;
}
.theme-switcher.active .switch-path {
  background-color: #555;
}
.theme-switcher.active .switch-handle {
  transform: translateX(20px);
  background-color: #101115;
}
.theme-switcher.active .switch-handle .light-icon {
  visibility: hidden;
}
.theme-switcher.active .switch-handle .dark-icon {
  visibility: visible;
  display: block;
}
</style>

<!-- Arrow up -->
<style>
    .arrowup {
    	position: fixed;
        width: 50px;
        height: 50px;
        left: 35px;
        bottom: 3.1rem;
        z-index: 99;
        background-color: #15171A;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 10px;
        cursor: pointer;
        opacity: 1;
  		transition: opacity 0.3s ease-in-out;
    }
    .arrowup svg {
    	fill: #FFFFFF;
    }
    .arrowup:hover {
      opacity: 0.8;
    }
</style><style>:root {--ghost-accent-color: #15171A;}</style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/></pre></li>
</head>
<body class="post-template tag-technology-growth is-head-left-logo has-cover">
<div class="viewport">
    <header id="gh-head" class="gh-head outer">
        <div class="gh-head-inner inner">
            <div class="gh-head-brand">
                <a class="gh-head-logo" href="../index.html">
                        <img src="../content/images/2021/07/zs-1.JPG" alt="zairesinatra">
                </a>
                <button class="gh-search gh-icon-btn" onclick="docSearchFuncMobile()"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button>
                <button class="gh-burger"></button>
            </div>

            <nav class="gh-head-menu">
                <ul class="nav">
    <li class="nav-home"><a href="../index.html">Home</a></li>
    <li class="nav-welcome"><a href="../welcome/index.html">Welcome</a></li>
    <li class="nav-author"><a href="../selfintro/index.html">Author</a></li>
    <li class="nav-tags"><a href="../tags/index.html">Tags</a></li>
</ul>

            </nav>

            <div class="gh-head-actions">
                <div class="theme-switcher-wrap">
                    <div class="theme-switcher" onclick="switchTheme()">
                    <div class="switch-path">
                        <div class="switch-handle">
                        <svg viewBox="0 0 24 24" class="dark-icon">
                            <path
                            d="M11.01 3.05C6.51 3.54 3 7.36 3 12a9 9 0 0 0 9 9c4.63 0 8.45-3.5 8.95-8c.09-.79-.78-1.42-1.54-.95A5.403 5.403 0 0 1 11.1 7.5c0-1.06.31-2.06.84-2.89c.45-.67-.04-1.63-.93-1.56z"
                            fill="#CFD3DC"
                            ></path>
                        </svg>
                        <svg viewBox="0 0 24 24" class="light-icon">
                            <path
                            d="M6.05 4.14l-.39-.39a.993.993 0 0 0-1.4 0l-.01.01a.984.984 0 0 0 0 1.4l.39.39c.39.39 1.01.39 1.4 0l.01-.01a.984.984 0 0 0 0-1.4zM3.01 10.5H1.99c-.55 0-.99.44-.99.99v.01c0 .55.44.99.99.99H3c.56.01 1-.43 1-.98v-.01c0-.56-.44-1-.99-1zm9-9.95H12c-.56 0-1 .44-1 .99v.96c0 .55.44.99.99.99H12c.56.01 1-.43 1-.98v-.97c0-.55-.44-.99-.99-.99zm7.74 3.21c-.39-.39-1.02-.39-1.41-.01l-.39.39a.984.984 0 0 0 0 1.4l.01.01c.39.39 1.02.39 1.4 0l.39-.39a.984.984 0 0 0 0-1.4zm-1.81 15.1l.39.39a.996.996 0 1 0 1.41-1.41l-.39-.39a.993.993 0 0 0-1.4 0c-.4.4-.4 1.02-.01 1.41zM20 11.49v.01c0 .55.44.99.99.99H22c.55 0 .99-.44.99-.99v-.01c0-.55-.44-.99-.99-.99h-1.01c-.55 0-.99.44-.99.99zM12 5.5c-3.31 0-6 2.69-6 6s2.69 6 6 6s6-2.69 6-6s-2.69-6-6-6zm-.01 16.95H12c.55 0 .99-.44.99-.99v-.96c0-.55-.44-.99-.99-.99h-.01c-.55 0-.99.44-.99.99v.96c0 .55.44.99.99.99zm-7.74-3.21c.39.39 1.02.39 1.41 0l.39-.39a.993.993 0 0 0 0-1.4l-.01-.01a.996.996 0 0 0-1.41 0l-.39.39c-.38.4-.38 1.02.01 1.41z"
                            fill="#606266"
                            ></path>
                        </svg>
                        </div>
                    </div>
                    </div>
                </div>
                    <button class="gh-search gh-icon-btn" onclick="docSearchFuncMobile()"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button>
                    <div class="gh-head-members">
                                <a class="gh-head-link" href="index.html#/portal/signin" data-portal="signin">Sign in</a>
                                <a class="gh-head-button" href="index.html#/portal/signup" data-portal="signup">Subscribe</a>
                    </div>
            </div>
        </div>
    </header>

    <div class="site-content">
      <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
        



<main id="site-main" class="site-main">
<article class="article post tag-technology-growth featured ">

    <header class="article-header gh-canvas">

        <div class="article-tag post-card-tags">
                <span class="post-card-primary-tag">
                    <a href="../tag/technology-growth/index.html">Technology growth</a>
                </span>
                <span class="post-card-featured"><svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M4.49365 4.58752C3.53115 6.03752 2.74365 7.70002 2.74365 9.25002C2.74365 10.6424 3.29678 11.9778 4.28134 12.9623C5.26591 13.9469 6.60127 14.5 7.99365 14.5C9.38604 14.5 10.7214 13.9469 11.706 12.9623C12.6905 11.9778 13.2437 10.6424 13.2437 9.25002C13.2437 6.00002 10.9937 3.50002 9.16865 1.68127L6.99365 6.25002L4.49365 4.58752Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
</svg> Featured</span>
        </div>

        <h1 class="article-title">非同源策略请求</h1>

            <p class="article-excerpt">跨域 &#x3D;&gt; JSONP—CORS—Proxy</p>

        <div class="article-byline">
        <section class="article-byline-content">

            <ul class="author-list">
                <li class="author-list-item">
                    <a href="../author/ziyi/index.html" class="author-avatar">
                        <img class="author-profile-image" src="../content/images/size/w100/2021/07/zs-2.JPG" alt="Ziyi Xie" />
                    </a>
                </li>
            </ul>

            <div class="article-byline-meta">
                <h4 class="author-name"><a href="../author/ziyi/index.html">Ziyi Xie</a></h4>
                <div class="byline-meta-content">
                    <time class="byline-meta-date" datetime="2021-02-14">Feb 14, 2021</time>
                        <span class="byline-reading-time"><span class="bull">&bull;</span> 6 min read</span>
                </div>
            </div>

        </section>
        </div>

            <figure class="article-image">
                <img
                    srcset="../content/images/size/w1000/2023/02/familyguy.jpg 1000w"
                    sizes="(min-width: 1400px) 1400px, 92vw"
                    src="../content/images/size/w2000/2023/02/familyguy.jpg"
                    alt="Family Guy"
                />
                    <figcaption>Family Guy</figcaption>
            </figure>

    </header>

    <section class="gh-content gh-canvas">
    <aside class="toc-container">
        <div class="toc"></div>
    </aside>
    <!--kg-card-begin: markdown--><h2 id="%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5">同源策略</h2>
<blockquote>
<p>浏览器安全的基石是 &quot;同源政策&quot;（same-origin policy）。 Netscape 公司引入浏览器。目前，所有浏览器都实行这个政策。</p>
<p>所谓同源是指 &quot;协议+域名+端口&quot; 三者相同，即便两个不同的域名指向同一个 IP 地址，也非同源。<br>
它是浏览器最核心也最基本的安全功能，如果缺少了同源策略，浏览器很容易受到 XSS、CSFR 等攻击。</p>
<p>同源策略限制以下几种行为：（1） Cookie、LocalStorage 和 IndexDB 无法读取。（2） DOM 无法获得。（3） AJAX 请求不能发送。</p>
</blockquote>
<p>在服务器端（项目上线部署完成）不存在跨域问题，跨域是针对浏览器的协议、域名、端口而言的。</p>
<!--kg-card-end: markdown--><!--kg-card-begin: markdown--><h2 id="jsonp-json-with-padding">JSONP JSON with padding</h2>
<p>浏览器同源策略导致网页中无法通过 Ajax 请求进行跨域访问，JSONP 的原理是部分标签的 src 属性不存在跨域请求的限制，可以访问到跨域的脚本。</p>
<p>服务端不返回字符串格式的数据，而是返回注入数据函数调用的脚本。客户端定义服务端返回调用的同名函数。</p>
<p>src 属性不仅用作将函数名带入请求的参数，而且会执行服务端返回的函数调用。</p>
<pre><code class="language-javascript">const script = document.createElement(&quot;script&quot;), handle = function (data) { console.log(data.code, data.msg); }
script.src = &quot;http://localhost:3000/jsonp-server?callback=handle&quot;;
document.body.appendChild(script)
</code></pre>
<pre><code class="language-javascript">const express = require('express');
const app = express(), port = 3000;
app.get('/jsonp-server', (req,res)=&gt;{
  const { callback } = req.query, data = { code: 200, msg: 'jsonp request success!' }
  res.send(`${callback}(${JSON.stringify(data)})`) // 也可以使用 end =&gt; 不加特殊响应头
});
app.listen(port, () =&gt; { console.log(`app listen is running at http://localhost:${port}`); });
</code></pre>
<p>类似的在 React 中，组件通讯的属性传递一般只能父传子，要是想实现子传父，可以通过父组件提供回调函数来接收数据，将该函数作为属性的值传递给子组件，子组件以 props 调用回调函数。</p>
<p>由于所有的 src 都是资源文件请求，导致 JSONP 只能使用 GET 方法；在路径传参将函数传递给服务器时，会存在 url 劫持的问题。</p>
<p>jQuery 发起 JSONP 请求时必须指定 <code>dataType: 'jsonp'</code>，callback=jQueryxxx 参数会被自动携带，jQueryxxx 是随机生成的回调函数名。其实现过程是动态的在 &lt;header&gt; 中创建和移除 &lt;script&gt;，并发起 JSONP 数据请求。</p>
<!--kg-card-end: markdown--><!--kg-card-begin: markdown--><h2 id="cors-%E8%B7%A8%E5%9F%9F%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%AB"><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS">CORS</a> 跨域资源共享</h2>
<p>跨域资源共享是一系列决定浏览器是否阻止前端跨域获取资源的响应头组。通过配置接口服务器相关 HTTP 响应头可解除浏览器端跨域访问限制。</p>
<p>根据请求方式与请求头不同，可以分为<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS#%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82">简单请求</a>和<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Preflight_request">预检请求</a>。</p>
<ul>
<li>请求方式是 GET、POST、HEAD 且 HTTP 头部信息不超过上述代码几种字段（无自定义头部字段）则为简单请求。</li>
<li>请求方式为 GET、POST、HEAD 以外的 METHOD 类型、请求头包含自定义头部字段、向服务器发送了 application\json 格式的数据，满足其中任何一种条件都是预检请求。</li>
</ul>
<pre><code class="language-javascript">const express = require(&quot;express&quot;);
// const cors = require('cors') + app.use(cors()) =&gt; 粗暴型
const app = express();
const port = 3001;
// 使用 express + node 时使用如下配置中间件配置头即可
app.use((req, res, next) =&gt; {
  // Access-Control-Allow-Origin - 允许访问该资源的外域URL
  res.header(&quot;Access-Control-Allow-Origin&quot;, &quot;http://127.0.0.1:5500&quot;); // 使用 * 避免只有单个源可以访问, 但是不可以携带 cookie =&gt; 保证安全
  res.header( &quot;Access-Control-Allow-Methods&quot;, &quot;GET, POST, DELETE, OPTIONS, HEAD&quot; );
  res.header( // 支持客户端向服务器发送如下的 9 个请求头
    &quot;Access-Control-Allow-Headers&quot;,
    &quot;Accept,Accept-Language, Content-Language,DPR,Downlink,Save-Data,Viewport-Width,Width,Content-Type&quot;
  );
  res.header(&quot;Access-Control-Allow-Credentials&quot;, true); // 是否允许携带资源凭证-cookie
  // 所有 cors 预先发送 OPTIONS 试探性请求 =&gt; 用完注释即可
//   req.method === 'OPTIONS' ? res.send('SURPPORT CROSS DOMAIN REQUEST') : res.send(&quot;SORRY, you can't cross, somewhere happens error&quot;)
  next();
});
app.get(&quot;/getcors&quot;, function (req, res) { res.send(&quot;finished the request!&quot;); });
app.listen(port, () =&gt; { console.log(`app listen is running at http://localhost:${port}`); });
</code></pre>
<pre><code class="language-html">&lt;script src=&quot;./node_modules/jquery/dist/jquery.min.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
  $.ajax({
    method: &quot;OPTIONS&quot;,
    url: &quot;http://localhost:3001&quot;,
    success: (res) =&gt; {
      console.log(res); // SURPPORT CROSS DOMAIN REQUEST
    },
  });
  $.ajax({
    method: &quot;get&quot;,
    url: &quot;http://localhost:3001/getcors&quot;,
    success: (res) =&gt; {
      console.log(res); // finished the request!
    },
  });
&lt;/script&gt;
</code></pre>
<!--kg-card-end: markdown--><!--kg-card-begin: markdown--><h2 id="%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8">代理服务器</h2>
<p>Vue 项目可以在需要跨域时直接请求本地服务器 8080 端口，通过配置代理转发给远程服务器（资源服务器、数据服务器...）获取资源。注意当请求的内容存在同名于 public 目录中的文件，那么不会转发给服务器，而是直接从 public 目录读取。</p>
<pre><code class="language-javascript">// App.vue
created () {
  axios.get('/devserver').then(res =&gt; console.log(res.data))
  this.testtt()
},
methods: {
  testtt () {
    var xhr = new XMLHttpRequest()
    xhr.open('GET', 'http://localhost:8080/getcors', true)
    xhr.send()
    xhr.onreadystatechange = function () {
    if (xhr.readyState === 4 &amp;&amp; xhr.status === 200) {
      console.log(xhr.responseText);
    }}
  }
}
</code></pre>
<pre><code class="language-javascript">// vue.config.js
// vue.config.js 打包后就不起作用. 可选项 vue.config.js 文件就等同于 webpack 的 webpack.config.js . vue-cli3 之后并不会自动创建 vue.config.js , 因为都是需要修改 webpack 的时候才会创建 vue.config.js 进行配置.
module.exports = {
  devServer: {
    host: &quot;localhost&quot;,
    // 项目开启端口
    port: 8080,
    proxy: {
      // /getcors 表示拦截以 getcors 开头的地址
      &quot;/getcors&quot;: {
        target: &quot;http://localhost:3001&quot;,
        changeOrigin: true, // 是否如实禀报服务器 - 后端通过request.get('Host')查看
      },
      &quot;/devserver&quot;: {
        target: &quot;http://localhost:3001&quot;,
        changeOrigin: true,
      },
      &quot;/needrewrite&quot;: {
        target: &quot;http://localhost:3002&quot;,
        changeOrigin: true,
        // 匹配以 needrewrite 开头的路径转为空字符串.
        // 避免携带控制服务器作用的 needrewrite,被携带到请求路径中
        pathRewrite: { &quot;^/needrewrite&quot;: &quot;&quot; },
        ws: true, // 用于支持 websockect
      },
    },
  },
};
</code></pre>
<pre><code class="language-javascript">// node.js 后端服务
const express = require('express');
const app = express();
const port = 3001;
app.get('/getcors',function (req, res) {
  res.send('finished the request!')
});
app.get('/devserver',function (req, res) {
  res.send('finished the request by devserver!')
});
app.listen(port, () =&gt; {
  console.log(`app listen is running at http://localhost:${port}`);
})
</code></pre>
<pre><code class="language-javascript">// 核心原理 =&gt; webpack 的 devServer.proxy 使用的 http-proxy-middleware 包
const express = require('express');
const { createProxyMiddleware } = require('http-proxy-middleware')
const app = express();
const port = 8080;
app.use(
  &quot;/&quot;,
  createProxyMiddleware({
    target: &quot;http://localhost:3001&quot;,
    changeOrigin: true
  })
)

app.listen(port, () =&gt; { console.log(`app listen is running at http://localhost:${port}`); })
</code></pre>
<!--kg-card-end: markdown--><!--kg-card-begin: markdown--><h2 id="%E7%BB%93%E6%9D%9F">结束</h2>
<p>本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh"> CC BY-SA 4.0 </a>协议 ，转载请注明出处！</p>
<!--kg-card-end: markdown-->
    </section>

    <section class="article-comments gh-canvas">
        
        <script src="https://utteranc.es/client.js"
        repo="Zairesinatra/comments-by-utterances"
        issue-term="pathname"
        theme="photon-dark"
        crossorigin="anonymous"
        async>
        </script>
    </section>

</article>
</main>

    <section class="footer-cta outer">
        <div class="inner">
            <h2 class="footer-cta-title">Sign up for more like this.</h2>
            <a class="footer-cta-button" href="index.html#/portal" data-portal>
                <div class="footer-cta-input">Enter your email</div>
                <span>Subscribe</span>
            </a>
        </div>
    </section>



            <aside class="read-more-wrap outer">
                <div class="read-more inner">
                        
<article class="post-card post">

    <a class="post-card-image-link" href="../vim-neovim/index.html">

        <img class="post-card-image"
            srcset="../content/images/size/w1000/2023/03/ScenicViewOfBeachDuringDaytime.jpg 1000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="../content/images/size/w600/2023/03/ScenicViewOfBeachDuringDaytime.jpg"
            alt="Scenic View Of Beach During Daytime"
            loading="lazy"
        />


    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../vim-neovim/index.html">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    Vim &amp; Neovim
                </h2>
            </header>
                <div class="post-card-excerpt">Vim ninjas count every keystroke!</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2022-12-12">Dec 12, 2022</time>
                <span class="post-card-meta-length">19 min read</span>
        </footer>

    </div>

</article>
                        
<article class="post-card post">

    <a class="post-card-image-link" href="../design-patterns/index.html">

        <img class="post-card-image"
            srcset="../content/images/size/w1000/2023/03/SixHalogenBulbs.jpg 1000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="../content/images/size/w600/2023/03/SixHalogenBulbs.jpg"
            alt="Six Halogen Bulbs"
            loading="lazy"
        />


    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../design-patterns/index.html">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    Design Patterns And ...
                </h2>
            </header>
                <div class="post-card-excerpt">"A good programmer is someone who always looks both ways before crossing a one-way street." - Doug Linder</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2022-08-08">Aug 8, 2022</time>
                <span class="post-card-meta-length">35 min read</span>
        </footer>

    </div>

</article>
                        
<article class="post-card post">

    <a class="post-card-image-link" href="../g-toc-css/index.html">

        <img class="post-card-image"
            srcset="../content/images/size/w1000/2023/03/GlassBottleFilledWithBlackStrawonBrownWoodenTable.jpg 1000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="../content/images/size/w600/2023/03/GlassBottleFilledWithBlackStrawonBrownWoodenTable.jpg"
            alt="Glass Bottle Filled With Black Straw on Brown Wooden Table"
            loading="lazy"
        />


    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../g-toc-css/index.html">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    G&amp;TOC&amp;CSS
                </h2>
            </header>
                <div class="post-card-excerpt">TOC 的需求实现以及相关的思考总结。</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2022-05-01">May 1, 2022</time>
                <span class="post-card-meta-length">6 min read</span>
        </footer>

    </div>

</article>
                </div>
            </aside>



    </div>
    <div class="docsearchwrapper"><div id="docsearch"></div></div>
    <div class="arrowup">
      <svg
        version="1.1"
        id="Layer_1"
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        x="0px"
        y="0px"
        width="20px"
        height="20px"
        viewBox="0 0 122.883 122.882"
        enable-background="new 0 0 20 20"
        xml:space="preserve"
      >
        <g>
          <path
            d="M0,61.441L0,61.441h0.018c0,16.976,6.872,32.335,17.98,43.443c11.108,11.107,26.467,17.979,43.441,17.979v0.018h0.001 h0.001v-0.018c16.974,0,32.335-6.872,43.443-17.98s17.98-26.467,17.98-43.441h0.018v-0.001V61.44h-0.018 c0-16.975-6.873-32.334-17.98-43.443C93.775,6.89,78.418,0.018,61.443,0.018V0h-0.002l0,0v0.018 c-16.975,0-32.335,6.872-43.443,17.98C6.89,29.106,0.018,44.465,0.018,61.439H0V61.441L0,61.441z M42.48,71.7 c-1.962,1.908-5.101,1.865-7.009-0.098c-1.909-1.962-1.865-5.101,0.097-7.009l22.521-21.839l3.456,3.553l-3.46-3.569 c1.971-1.911,5.117-1.862,7.029,0.108c0.055,0.058,0.109,0.115,0.16,0.175L87.33,64.594c1.963,1.908,2.006,5.047,0.098,7.009 c-1.908,1.963-5.047,2.006-7.01,0.098L61.53,53.227L42.48,71.7L42.48,71.7z"
          />
        </g>
      </svg>
    </div>
    <footer class="site-footer outer">
        <div class="inner">
            <section class="copyright"><a href="../index.html">zairesinatra</a> &copy; 2023</section>
            <nav class="site-footer-nav">
                
            </nav>
            <div><a href="https://ghost.org/" target="_blank" rel="noopener">Powered by Ghost</a></div>
        </div>
    </footer>
</div>


<script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>
<script src="../assets/built/casper.js%3Fv=7d64696598"></script>
<script>
$(document).ready(function () {
    // Mobile Menu Trigger
    $('.gh-burger').click(function () {
        $('body').toggleClass('gh-head-open');
    });
    // FitVids - Makes video embeds responsive
    $(".gh-content").fitVids();
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.18.2/tocbot.min.js"></script>
<script>
  tocbot.init({
    tocSelector: '.toc',
    contentSelector: '.gh-content',
    hasInnerContainers: true
  });
  var tc = document.querySelector(".toc-container");
  if(tc){
    var tch = tc.clientHeight;
    var ah = document.querySelector(".article-header");
    var ahh = ah.clientHeight;
    window.addEventListener("scroll", function () {
    if(document.body.clientWidth > 1170){
      var scrollY = document.documentElement.scrollTop || document.body.scrollTop;
      var ihh = window.innerHeight;
      if(scrollY >= ihh + tch + ahh){
        var ctc = document.querySelector(".toc-container");
        ctc.style.position="sticky";
        ctc.style.position="-webkit-sticky";
        ctc.style.top = "120px";
        ctc.style.marginLeft = "800px";
        ctc.style.minWidth= "260px";
      }
      if(scrollY < tch + ahh -10){
        var ctc = document.querySelector(".toc-container");
        ctc.style.position="";
        ctc.style.top = "";
        ctc.style.marginLeft = "";
      }
    }})
  }
</script>
<script>
  function searchFunc(){
    let autocomplete = document.querySelector("#autocomplete");
    let algoliaouterwrapper = document.querySelector(".algoliaouterwrapper");
    // console.log(algoliaouterwrapper,autocomplete);
    autocomplete.parentNode.removeChild(autocomplete);
    algoliaouterwrapper.appendChild(autocomplete);
    autocomplete.style.marginTop = "50px";
    algoliaouterwrapper.style.background = '#F5F5FA';
    algoliaouterwrapper.style.display = "block";
    algoliaouterwrapper.style.zIndex = 99999;
    autocomplete.addEventListener('click', function(event) {
      event.stopPropagation();
    });
  }
  function outerwrapperFunc(event){
    event.stopPropagation();
    let autocomplete = document.querySelector("#autocomplete");
    let algoliawrapper = document.querySelector(".algoliawrapper");
    let algoliaouterwrapper = document.querySelector(".algoliaouterwrapper");
    autocomplete.parentNode.removeChild(autocomplete);
    algoliawrapper.appendChild(autocomplete);
    algoliaouterwrapper.style.background = '';
    algoliaouterwrapper.style.display = "none";
    algoliaouterwrapper.style.zIndex = 0;
    autocomplete.removeEventListener('click', function(event) {
      event.stopPropagation();
    });
  }
  function searchFuncMobile (){
    let mobileTrigger = document.querySelector(".aa-DetachedSearchButton");
    mobileTrigger.click();
  }
</script>

<script>
  function docSearchFuncMobile(){
    const DocSearchElement = document.querySelector(".DocSearch");
    DocSearchElement.click();
  }
</script>


<!-- searchinghost-easy -->
<!--
<script src="https://cdn.jsdelivr.net/gh/gmfmi/searchinghost-easy@latest/dist/searchinghost-easy-basic.js"></script>
<script>
    new SearchinGhostEasy({
        contentApiKey: 'e93d8b3520ae46be52c9a4b140'
    });
</script>
-->

<!-- Theme Mode -->
<script>
    let currentTheme = localStorage.getItem("theme-color");
    const switchTheme = function () {
        const storedTheme = localStorage.getItem("theme-color") || "theme-light";
        if (
            storedTheme === "theme-dark" &&
            document.getElementsByTagName("html")[0].className !== ""
        ) {
            localStorage.setItem("theme-color", "theme-light");
            currentTheme = localStorage.getItem("theme-color");
            if (currentTheme === "theme-light") {
            document.getElementsByTagName("html")[0].classList.remove("dark-mode");
            document
                .getElementsByClassName("theme-switcher")[0]
                ?.classList.remove("active");
            document
                .getElementsByClassName("toc")[0]
                ?.classList.remove("active");
            }
        } else {
            localStorage.setItem("theme-color", "theme-dark");
            currentTheme = localStorage.getItem("theme-color");
            if (currentTheme === "theme-dark") {
            // console.log(document.getElementById("app"));
            document.getElementsByTagName("html")[0].classList.add("dark-mode");
            document
                .getElementsByClassName("theme-switcher")[0]
                ?.classList.add("active");
            document
                .getElementsByClassName("toc")[0]
                ?.classList.add("active");
            }
        }
    };
    const initTheme = function () {
    const storedTheme = localStorage.getItem("theme-color") || "theme-light";
    if (storedTheme === "theme-dark") {
        document
        .getElementsByClassName("theme-switcher")[0]
        ?.classList.add("active");
        document
        .getElementsByClassName("toc")[0]
        ?.classList.add("active");
        document.getElementsByTagName("html")[0].classList.add("dark-mode");
    }
    };
    initTheme()
</script>

<!-- Arrow up -->
<script>
const arrowup = document.querySelector(".arrowup");
arrowup.addEventListener("click", function() {
  const scrollDuration = 1500; // 滚动持续时间，单位毫秒
    const start = window.pageYOffset; // 当前滚动位置
    const end = 0; // 滚动结束位置
    const distance = end - start; // 滚动距离
    const startTime = performance.now(); // 动画开始时间

    function easeInOutCubic(t) {
      return t < 0.5
        ? 4 * t ** 3
        : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;
    }

    function scrollToTopSmooth(timestamp) {
      const currentTime = timestamp - startTime; // 已经经过的时间
      const progress = currentTime / scrollDuration; // 滚动进度
      const position =
        start + distance * easeInOutCubic(Math.min(progress, 1)); // 当前滚动位置
      window.scrollTo(0, position); // 滚动到新位置

      if (currentTime < scrollDuration) {
        // 如果滚动还未结束，则继续执行动画
        requestAnimationFrame(scrollToTopSmooth);
      }
    }

    requestAnimationFrame(scrollToTopSmooth);
});
</script>

<!-- Algolia DocSearch -->
<style>
.docsearchwrapper{
  display: none;
}
.DocSearch-Container{
  z-index: 9999999;
}
</style>

<script type="text/javascript">
  docsearch({
    appId: "722DYFSYDR",
    apiKey: "5b7d4a36b43ac3d135ca6b83ac715f7e",
    indexName: "zairesinatraio",
    container: document.querySelector("#docsearch"),
    debug: false // Set debug to true if you want to inspect the modal
  });
</script>

</body>
</html>
