<!DOCTYPE html>
<html âš¡>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

    <title>Spring5</title>

    <meta name="description" content="Java Spring5 æ¡†æ¶" />
    <link rel="icon" href="../../content/images/size/w256h256/2021/07/ghost-orb.png" type="image/png" />
    <link rel="canonical" href="../index.html" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    
    <meta property="og:site_name" content="zairesinatra" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Spring5" />
    <meta property="og:description" content="Java Spring5 æ¡†æ¶" />
    <meta property="og:url" content="yourdomain.com/spring5/" />
    <meta property="og:image" content="yourdomain.com/content/images/2022/05/GreyWhiteClouds.JPG" />
    <meta property="article:published_time" content="2020-05-25T12:20:00.000Z" />
    <meta property="article:modified_time" content="2022-12-28T10:05:10.000Z" />
    <meta property="article:tag" content="Technology growth" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Spring5" />
    <meta name="twitter:description" content="Java Spring5 æ¡†æ¶" />
    <meta name="twitter:url" content="yourdomain.com/spring5/" />
    <meta name="twitter:image" content="yourdomain.com/content/images/2022/05/GreyWhiteClouds.JPG" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Ziyi Xie" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Technology growth" />
    <meta name="twitter:site" content="@xieziyi0422" />
    <meta property="og:image:width" content="2000" />
    <meta property="og:image:height" content="1125" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "zairesinatra",
        "url": "yourdomain.com/",
        "logo": {
            "@type": "ImageObject",
            "url": "yourdomain.com/content/images/2021/07/zs-1.JPG",
            "width": 60,
            "height": 60
        }
    },
    "author": {
        "@type": "Person",
        "name": "Ziyi Xie",
        "image": {
            "@type": "ImageObject",
            "url": "yourdomain.com/content/images/2021/07/zs-2.JPG",
            "width": 1079,
            "height": 1079
        },
        "url": "yourdomain.com/author/ziyi/",
        "sameAs": []
    },
    "headline": "Spring5",
    "url": "yourdomain.com/spring5/",
    "datePublished": "2020-05-25T12:20:00.000Z",
    "dateModified": "2022-12-28T10:05:10.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "yourdomain.com/content/images/2022/05/GreyWhiteClouds.JPG",
        "width": 2000,
        "height": 1125
    },
    "keywords": "Technology growth",
    "description": "Java Spring5 æ¡†æ¶",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "yourdomain.com/"
    }
}
    </script>

    <meta name="generator" content="Ghost 5.25" />
    <link rel="alternate" type="application/rss+xml" title="zairesinatra" href="../../rss/index.html" />

    <style amp-custom>
    *,
    *::before,
    *::after {
        box-sizing: border-box;
    }

    html {
        overflow-x: hidden;
        overflow-y: scroll;
        font-size: 62.5%;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    }

    body {
        min-height: 100vh;
        margin: 0;
        padding: 0;
        color: #3a4145;
        font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;
        font-size: 1.7rem;
        line-height: 1.55em;
        font-weight: 400;
        font-style: normal;
        background: #fff;
        scroll-behavior: smooth;
        overflow-x: hidden;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    p,
    ul,
    ol,
    li,
    dl,
    dd,
    hr,
    pre,
    form,
    table,
    video,
    figure,
    figcaption,
    blockquote {
        margin: 0;
        padding: 0;
    }

    ul[class],
    ol[class] {
        padding: 0;
        list-style: none;
    }

    img {
        display: block;
        max-width: 100%;
    }

    input,
    button,
    select,
    textarea {
        font: inherit;
        -webkit-appearance: none;
    }

    fieldset {
        margin: 0;
        padding: 0;
        border: 0;
    }

    label {
        display: block;
        font-size: 0.9em;
        font-weight: 700;
    }

    hr {
        position: relative;
        display: block;
        width: 100%;
        height: 1px;
        border: 0;
        border-top: 1px solid currentcolor;
        opacity: 0.1;
    }

    ::selection {
        text-shadow: none;
        background: #cbeafb;
    }

    mark {
        background-color: #fdffb6;
    }

    small {
        font-size: 80%;
    }

    sub,
    sup {
        position: relative;
        font-size: 75%;
        line-height: 0;
        vertical-align: baseline;
    }
    sup {
        top: -0.5em;
    }
    sub {
        bottom: -0.25em;
    }

    ul li + li {
        margin-top: 0.6em;
    }

    a {
        color: var(--ghost-accent-color, #1292EE);
        text-decoration-skip-ink: auto;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        margin: 0;
        font-weight: 700;
        color: #121212;
        line-height: 1.4em;
    }

    h1 {
        font-size: 3.4rem;
        line-height: 1.1em;
    }

    h2 {
        font-size: 2.4rem;
        line-height: 1.2em;
    }

    h3 {
        font-size: 1.8rem;
    }

    h4 {
        font-size: 1.7rem;
    }

    h5 {
        font-size: 1.6rem;
    }

    h6 {
        font-size: 1.6rem;
    }

    amp-img {
        height: 100%;
        width: 100%;
        max-width: 100%;
        max-height: 100%;
    }

    amp-img img {
        object-fit: cover;
    }
    
    amp-youtube {
        height: calc(100vw / 1.78);
        width: 100vw;
        position: relative;
    }

    amp-youtube img {
        position: absolute;
    }

    .page-header {
        padding: 50px 5vmin 30px;
        text-align: center;
        font-size: 2rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .page-header a {
        color: #121212;
        font-weight: 700;
        text-decoration: none;
        font-size: 1.6rem;
        letter-spacing: -0.1px;
    }

    .post {
        max-width: 680px;
        margin: 0 auto;
    }

    .post-header {
        margin: 0 5vmin 5vmin;
        text-align: center;
    }

    .post-meta {
        margin: 1rem 0 0 0;
        text-transform: uppercase;
        color: #738a94;
        font-weight: 500;
        font-size: 1.3rem;
    }

    .post-image {
        margin: 0 0 5vmin;
    }

    .post-image img {
        display: block;
        width: 100%;
        height: auto;
    }

    .post-content {
        padding: 0 5vmin;
    }

    .post-content > * + * {
        margin-top: 1.5em;
    }

    .post-content [id]:not(:first-child) {
        margin: 2em 0 0;
    }

    .post-content > [id] + * {
        margin-top: 1rem;
    }

    .post-content [id] + .kg-card,
    .post-content blockquote + .kg-card {
        margin-top: 40px;
    }

    .post-content > ul,
    .post-content > ol,
    .post-content > dl {
        padding-left: 1.9em;
    }

    .post-content hr {
        margin-top: 40px;
    }

    .post .post-content hr + * {
        margin-top: 40px;
    }

    .post-content amp-img {
        background-color: #f8f8f8;
    }

    .post-content blockquote {
        position: relative;
        font-style: italic;
    }

    .post-content blockquote::before {
        content: "";
        position: absolute;
        left: -1.5em;
        top: 0;
        bottom: 0;
        width: 0.3rem;
        background: var(--ghost-accent-color, #1292EE);
    }

    .post-content blockquote.kg-blockquote-alt {
        font-size: 1.2em;
        font-style: italic;
        line-height: 1.6em;
        text-align: center;
        color: #738a94;
        padding: 0.75em 3em 1.25em;
    }

    .post-content blockquote.kg-blockquote-alt::before {
        display: none;
    }

    .post-content :not(.kg-card):not([id]) + .kg-card {
        margin-top: 40px;
    }

    .post-content .kg-card + :not(.kg-card) {
        margin-top: 40px;
    }

    .kg-card figcaption {
        padding: 1.5rem 1.5rem 0;
        text-align: center;
        font-weight: 500;
        font-size: 1.3rem;
        line-height: 1.4em;
        opacity: 0.6;
    }

    .kg-card figcaption strong {
        color: rgba(0,0,0,0.8);
    }

    .post-content :not(pre) code {
        vertical-align: middle;
        padding: 0.15em 0.4em 0.15em;
        border: #e1eaef 1px solid;
        font-weight: 400;
        font-size: 0.9em;
        line-height: 1em;
        color: #15171a;
        background: #f0f6f9;
        border-radius: 0.25em;
    }

    .post-content > pre {
        overflow: scroll;
        padding: 16px 20px;
        color: #fff;
        background: #1F2428;
        border-radius: 5px;
        box-shadow: 0 2px 6px -2px rgba(0,0,0,.1), 0 0 1px rgba(0,0,0,.4);
    }

    .kg-embed-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
    }

    .kg-image-card img {
        margin: auto;
    }

    .kg-gallery-card + .kg-gallery-card {
        margin-top: 0.75em;
    }

    .kg-gallery-container {
        position: relative;
    }

    .kg-gallery-row {
        display: flex;
        flex-direction: row;
        justify-content: center;
    }

    .kg-gallery-image {
        width: 100%;
        height: 100%;
    }

    .kg-gallery-row:not(:first-of-type) {
        margin: 0.75em 0 0 0;
    }

    .kg-gallery-image:not(:first-of-type) {
        margin: 0 0 0 0.75em;
    }

    .kg-bookmark-card,
    .kg-bookmark-publisher {
        position: relative;
    }

    .kg-bookmark-container,
    .kg-bookmark-container:hover {
        display: flex;
        flex-wrap: wrap;
        flex-direction: row-reverse;
        color: currentColor;
        background: rgba(255,255,255,0.6);
        font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;
        text-decoration: none;
        border-radius: 3px;
        box-shadow: 0 2px 6px -2px rgba(0, 0, 0, 0.1), 0 0 1px rgba(0, 0, 0, 0.4);
        overflow: hidden;
    }

    .kg-bookmark-content {
        flex-basis: 0;
        flex-grow: 999;
        padding: 20px;
        order: 1;
    }

    .kg-bookmark-title {
        font-weight: 600;
        font-size: 1.5rem;
        line-height: 1.3em;
    }

    .kg-bookmark-description {
        display: -webkit-box;
        max-height: 45px;
        margin: 0.5em 0 0 0;
        font-size: 1.4rem;
        line-height: 1.55em;
        overflow: hidden;
        opacity: 0.8;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }

    .kg-bookmark-metadata {
        margin-top: 20px;
    }

    .kg-bookmark-metadata {
        display: flex;
        align-items: center;
        font-weight: 500;
        font-size: 1.3rem;
        line-height: 1.3em;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .kg-bookmark-description {
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
        overflow: hidden;
    }

    .kg-bookmark-metadata amp-img {
        width: 18px;
        height: 18px;
        max-width: 18px;
        max-height: 18px;
        margin-right: 10px;
    }

    .kg-bookmark-thumbnail {
        display: flex;
        flex-basis: 20rem;
        flex-grow: 1;
        justify-content: flex-end;
    }

    .kg-bookmark-thumbnail amp-img {
        max-height: 200px;
    }

    .kg-bookmark-author {
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
    }

    .kg-bookmark-publisher::before {
        content: "â€¢";
        margin: 0 .5em;
    }

    .kg-toggle-card-icon {
        display: none;
    }

    .kg-toggle-content {
        margin-top: 0.8rem;
    }

    .kg-product-card-container {
        background: transparent;
        padding: 20px;
        width: 100%;
        border-radius: 5px;
        box-shadow: inset 0 0 0 1px rgb(124 139 154 / 25%);
    }

    .kg-product-card-description p {
        margin-top: 1.5em;
    }

    .kg-product-card-description ul {
        margin-left: 24px;
    }

    .kg-product-card-title {
        font-size: 1.9rem;
        font-weight: 700;
    }

    .kg-product-card-rating-star {
        height: 28px;
        width: 20px;
        margin-right: 2px;
    }

    .kg-product-card-rating-star svg {
    width: 16px;
    height: 16px;
    fill: currentColor;
    opacity: 0.15;
    }

    .kg-product-card-rating-active.kg-product-card-rating-star svg {
    opacity: 1;
    }

    .kg-nft-card-container {
        position: relative;
        display: flex;
        flex: auto;
        flex-direction: column;
        text-decoration: none;
        font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;
        font-size: 1.4rem;
        font-weight: 400;
        box-shadow: 0 2px 6px -2px rgb(0 0 0 / 10%), 0 0 1px rgb(0 0 0 / 40%);
        width: 100%;
        max-width: 512px;
        color: #15212A;
        background: #fff;
        border-radius: 5px;
        transition: none;
        margin: 0 auto;
    }

    .kg-nft-metadata {
        padding: 2.0rem;
    }

    .kg-nft-image-container {
        position: relative;
    }

    .kg-nft-image {
        display: flex;
        border-radius: 5px 5px 0 0;
    }

    .kg-nft-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 20px;
    }

    .kg-nft-header h4.kg-nft-title {
        font-size: 1.9rem;
        font-weight: 700;
        margin: 0;
        color: #15212A;
    }

    .kg-nft-header amp-img {
        max-width: 114px;
        max-height: 26px;
    }

    .kg-nft-opensea-logo {
        margin-top: 2px;
        width: 100px;
    }

    .kg-nft-creator {
        font-family: inherit;
        color: #95A1AD;
    }

    .kg-nft-creator span {
        font-weight: 500;
        color: #15212A;
    }

    .kg-nft-card p.kg-nft-description {
        font-size: 1.4rem;
        line-height: 1.4em;
        margin: 2.0rem 0 0;
        color: #222;
    }

    .kg-button-card {
        display: flex;
        position: static;
        align-items: center;
        width: 100%;
        justify-content: center;
    }

    .kg-btn {
        display: flex;
        position: static;
        align-items: center;
        padding: 0 2.0rem;
        height: 4.0rem;
        line-height: 4.0rem;
        font-size: 1.65rem;
        font-weight: 600;
        text-decoration: none;
        border-radius: 5px;
        transition: opacity 0.2s ease-in-out;
    }

    .kg-btn:hover {
        opacity: 0.85;
    }

    .kg-btn-accent {
        background-color: var(--ghost-accent-color, #1292EE);
        color: #fff;
    }

    .kg-callout-card {
        display: flex;
        padding: 20px 28px;
        border-radius: 3px;
    }

    .kg-callout-card-grey {
        background: rgba(124, 139, 154, 0.13);
    }

    .kg-callout-card-white {
        background: transparent;
        box-shadow: inset 0 0 0 1px rgba(124, 139, 154, 0.25);
    }

    .kg-callout-card-blue {
        background: rgba(33, 172, 232, 0.12);
    }

    .kg-callout-card-green {
        background: rgba(52, 183, 67, 0.12);
    }

    .kg-callout-card-yellow {
        background: rgba(240, 165, 15, 0.13);
    }

    .kg-callout-card-red {
        background: rgba(209, 46, 46, 0.11);
    }

    .kg-callout-card-pink {
        background: rgba(225, 71, 174, 0.11);
    }

    .kg-callout-card-purple {
        background: rgba(135, 85, 236, 0.12);
    }

    .kg-callout-card-accent {
        background: var(--ghost-accent-color);
        color: #fff;
    }

    .kg-callout-card-accent a {
        color: #fff;
    }

    .kg-callout-emoji {
        padding-right: 16px;
        line-height: 1.3;
        font-size: 1.25em;
    }

    .kg-header-card {
        padding: 6em 3em;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
    }

    .kg-header-card.kg-size-small {
        padding-top: 4em;
        padding-bottom: 4em;
    }

    .kg-header-card.kg-size-large {
        padding-top: 12em;
        padding-bottom: 12em;
    }

    .kg-header-card.kg-width-full {
        padding-left: 4em;
        padding-right: 4em;
    }

    .kg-header-card.kg-align-left {
        text-align: left;
        align-items: flex-start;
    }

    .kg-header-card.kg-style-dark {
        background: #15171a;
        color: #ffffff;
    }

    .kg-header-card.kg-style-light {
        color: #15171a;
        border: 1px solid rgba(124, 139, 154, 0.25);
        border-width: 1px 0;
    }

    .kg-header-card.kg-style-accent {
        background-color: var(--ghost-accent-color);
    }

    .kg-header-card.kg-style-image {
        background-color: #e7e7eb;
        background-size: cover;
        background-position: center center;
    }

    .kg-header-card h2 {
        font-size: 4em;
        font-weight: 700;
        line-height: 1.1em;
        margin: 0;
    }

    .kg-header-card h2 strong {
        font-weight: 800;
    }

    .kg-header-card.kg-size-small h2 {
        font-size: 3em;
    }

    .kg-header-card.kg-size-large h2 {
        font-size: 5em;
    }

    .kg-header-card h3 {
        font-size: 1.25em;
        font-weight: 500;
        line-height: 1.3em;
        margin: 0;
    }

    .kg-header-card h3 strong {
        font-weight: 600;
    }

    .kg-header-card.kg-size-small h3 {
        font-size: 1em;
    }

    .kg-header-card.kg-size-large h3 {
        font-size: 1.5em;
    }

    .kg-header-card:not(.kg-style-light) h2,
    .kg-header-card:not(.kg-style-light) h3 {
        color: #ffffff;
    }

    .kg-header-card a.kg-header-card-button {
        display: flex;
        position: static;
        align-items: center;
        padding: 0 1.2em;
        height: 2.4em;
        line-height: 1em;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
        font-size: 0.95em;
        font-weight: 600;
        text-decoration: none;
        border-radius: 5px;
        transition: opacity 0.2s ease-in-out;
        background-color: var(--ghost-accent-color);
        color: #ffffff;
        margin: 1.75em 0 0;
    }

    .kg-header-card a.kg-header-card-button:hover {
        opacity: 0.85;
    }

    .kg-header-card.kg-size-large a.kg-header-card-button {
        margin-top: 2em;
    }

    .kg-header-card.kg-size-small a.kg-header-card-button {
        margin-top: 1.5em;
    }

    .kg-header-card.kg-style-image a.kg-header-card-button,
    .kg-header-card.kg-style-dark a.kg-header-card-button {
        background: #ffffff;
        color: #15171a;
    }

    .kg-header-card.kg-style-accent a.kg-header-card-button {
        background: #ffffff;
        color: var(--ghost-accent-color);
    }

    .kg-audio-card {
        display: flex;
        width: 100%;
        box-shadow: inset 0 0 0 1px rgba(124, 139, 154, 0.25);
    }

    .kg-audio-thumbnail {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 80px;
        min-width: 80px;
        height: 80px;
        background: transparent;
        object-fit: cover;
        aspect-ratio: 1/1;
        border-radius: 3px 0 0 3px;
    }

    .kg-audio-thumbnail.placeholder {
        background: var(--ghost-accent-color);
    }

    .kg-audio-thumbnail.placeholder svg {
        width: 24px;
        height: 24px;
        fill: white;
    }

    .kg-audio-player-container {
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        width: 100%;
        --seek-before-width: 0%;
        --volume-before-width: 100%;
        --buffered-width: 0%;
    }

    .kg-audio-title {
        width: 100%;
        padding: 8px 12px 0;
        border: none;
        font-family: inherit;
        font-size: 1.1em;
        font-weight: 700;
        background: transparent;
    }

    .kg-audio-player {
        display: none;
    }

    .kg-width-full.kg-card-hascaption {
        display: grid;
        grid-template-columns: inherit;
    }

    .post-content table {
        border-collapse: collapse;
        width: 100%;
    }

    .post-content th {
        padding: 0.5em 0.8em;
        text-align: left;
        font-size: .75em;
        text-transform: uppercase;
    }

    .post-content td {
        padding: 0.4em 0.7em;
    }

    .post-content tbody tr:nth-child(2n + 1) {
        background-color: rgba(0,0,0,0.1);
        padding: 1px;
    }

    .post-content tbody tr:nth-child(2n + 2) td:last-child {
        box-shadow:
            inset 1px 0 rgba(0,0,0,0.1),
            inset -1px 0 rgba(0,0,0,0.1);
    }

    .post-content tbody tr:nth-child(2n + 2) td {
        box-shadow: inset 1px 0 rgba(0,0,0,0.1);
    }

    .post-content tbody tr:last-child {
        border-bottom: 1px solid rgba(0,0,0,.1);
    }

    .page-footer {
        padding: 60px 5vmin;
        margin: 60px auto 0;
        text-align: center;
        background-color: #f8f8f8;
    }

    .page-footer h3 {
        margin: 0.5rem 0 0 0;
    }

    .page-footer p {
        max-width: 500px;
        margin: 1rem auto 1.5rem;
        font-size: 1.7rem;
        line-height: 1.5em;
        color: rgba(0,0,0,0.6)
    }

    .powered {
        display: inline-flex;
        align-items: center;
        margin: 30px 0 0;
        padding: 6px 9px 6px 6px;
        border: rgba(0,0,0,0.1) 1px solid;
        font-size: 12px;
        line-height: 12px;
        letter-spacing: -0.2px;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
        font-weight: 500;
        color: #222;
        text-decoration: none;
        background: #fff;
        border-radius: 6px;
    }

    .powered svg {
        height: 16px;
        width: 16px;
        margin: 0 6px 0 0;
    }

    @media (max-width: 600px) {
        body {
            font-size: 1.6rem;
        }
        h1 {
            font-size: 3rem;
        }

        h2 {
            font-size: 2.2rem;
        }
    }

    @media (max-width: 400px) {
        h1 {
            font-size: 2.6rem;
            line-height: 1.15em;
        }
        h2 {
            font-size: 2rem;
            line-height: 1.2em;
        }
        h3 {
            font-size: 1.7rem;
        }
    }

    :root {--ghost-accent-color: #15171A;}
    </style>

    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>

    

</head>

<body class="amp-template">
    <header class="page-header">
        <a href="../../index.html">
                <amp-img class="site-icon" src="yourdomain.com/content/images/2021/07/ghost-orb.png" width="50" height="50" layout="fixed" alt="zairesinatra"></amp-img>
        </a>
    </header>

    <main class="content" role="main">
        <article class="post">

            <header class="post-header">
                <h1 class="post-title">Spring5</h1>
                <section class="post-meta">
                    Ziyi Xie -
                    <time class="post-date" datetime="2020-05-25">25 May 2020</time>
                </section>
            </header>
            <figure class="post-image">
                <amp-img src="yourdomain.com/content/images/2022/05/GreyWhiteClouds.JPG" width="600" height="340" layout="responsive" 
                alt="GreyWhiteClouds"
                ></amp-img>
            </figure>
            <section class="post-content">

                <h2 id="%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B">å¿«é€Ÿä¸Šæ‰‹</h2>
<h3 id="core-concepts">Core Concepts</h3>
<p><amp-img src="https://res.cloudinary.com/dzb9ldnvl/image/upload/v1671815139/BackendDev/Spring/SpringFrameworkRuntime.png" alt width="720" height="540" layout="responsive"></amp-img></p>
<p>(IOC) Inversion of Control æ§åˆ¶åè½¬çš„æ€æƒ³æ˜¯å°†å¯¹è±¡çš„åˆ›å»ºæƒç§»äº¤å¤–éƒ¨ï¼Œé¿å…å‡ºç°ä¸šåŠ¡å±‚ service ä¸æ•°æ®å±‚ dao æœ‰å¼ºè€¦åˆçš„æƒ…å†µã€‚</p>
<pre><code class="language-java">// å¼ºè€¦åˆ
public class XxxServiceImpl implements XxxService {
    private XxxDao xxxDao = new XxxDaoImpl();
    public void yyy(){
        xxxDao.yyy();
    }
}
// è§£è€¦
public class XxxServiceImpl implements XxxService {
    private XxxDao xxxDao; // å¯¹è±¡åˆ›å»ºæ§åˆ¶æƒç§»äº¤å¤–éƒ¨
    public void yyy(){
        xxxDao.yyy();
    }
}
</code></pre>
<pre><code class="language-java">public class XxxDaoImpl implements XxxDao {
    public void yyy() {
        System.out.println("xxx dao yyy");
    }
}
</code></pre>
<p>Spring æŠ€æœ¯å¯¹ IoC æ€æƒ³çš„å®ç°ï¼š</p>
<ol>
<li>Spring æä¾›ä¸€ä¸ªç”¨äºå……å½“â€œå¤–éƒ¨â€çš„ IoC å®¹å™¨</li>
<li>ä»ä¸»åŠ¨ new å‡ºå¯¹è±¡è½¬æ¢è‡³ç”±â€œå¤–éƒ¨â€æä¾›å¯¹è±¡</li>
<li>è¢« IoC å®¹å™¨æ¥ç®¡åˆ›å»ºä¸åˆå§‹åŒ–è¿‡ç¨‹çš„å¯¹è±¡å«åš Bean</li>
</ol>
<blockquote>
<p>Beans're special type of Pojos. There're some restrictions on POJO to be a bean.</p>
</blockquote>
<ul>
<li>POJO:
<ul>
<li>ä¸ç»§æ‰¿ä»»ä½•ç±»</li>
<li>ä¸å®ç°ä»»ä½•æ¥å£</li>
<li>ä¸åŒ…å«æ³¨è§£</li>
</ul>
</li>
<li>Beans:
<ul>
<li>ä¸å¯ä»¥é€šè¿‡åç§°è®¿é—®å­—æ®µï¼Œä»…èƒ½ä½¿ç”¨ getters å’Œ setters</li>
<li>ä¸€å®šå®ç° serializable æ¥å£ï¼Œæ˜¯å¯åºåˆ—åŒ–çš„ç±»</li>
<li>æ‰€æœ‰å­—æ®µéƒ½æ˜¯ç§æœ‰è®¿é—®ç±»å‹ private</li>
<li>ä¸€å®šå­˜åœ¨æ— å‚æ„é€ å‡½æ•°</li>
</ul>
</li>
</ul>
<p>åœ¨ IoC å®¹å™¨ä¸­å»ºç«‹ä¸åŒ Bean ä¹‹é—´ä¾èµ–å…³ç³»çš„è¿‡ç¨‹ç§°ä¸º (DI) Dependency Injection ä¾èµ–æ³¨å…¥ã€‚</p>
<p>ç”±äº service ä¸ dao éƒ½åŒåœ¨ IoCï¼Œé‚£ä¹ˆä¾èµ–æ³¨å…¥ç†æ‰€å½“ç„¶çš„å¯ä»¥è§£å†³ service è¿è¡Œæ—¶éœ€è¦ä¾èµ– dao çš„é—®é¢˜ã€‚</p>
<p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans">Spring</a> ä¸­ IoC å®¹å™¨çš„ä¸¤ç§è·å–æ–¹å¼ï¼šBeanFactory å’Œ ApplicationContext æ¥å£ã€‚</p>
<blockquote>
<p>The org.springframework.beans and org.springframework.context packages are the basis for Spring Frameworkâ€™s IoC container. The BeanFactory interface provides an advanced configuration mechanism capable of managing any type of object. ApplicationContext is a sub-interface of BeanFactory.</p>
</blockquote>
<blockquote>
<p>The org.springframework.context.ApplicationContext interface represents the Spring IoC container and is responsible for instantiating, configuring, and assembling the beans.</p>
</blockquote>
<blockquote>
<p>Several implementations of the ApplicationContext interface are supplied with Spring. In stand-alone applications, it is common to create an instance of ClassPathXmlApplicationContext or FileSystemXmlApplicationContext.</p>
</blockquote>
<h3 id="ioc-container-beans">IoC Container &amp; Beans</h3>
<p>åœ¨å¯¼å…¥ Spring åæ ‡å¹¶å®šä¹‰ Spring ç®¡ç†çš„ç±»åï¼Œåœ¨ resources ç›®å½•åˆ›å»º Spring é…ç½®æ–‡ä»¶ï¼Œé…ç½®å¯¹åº”ç±»ä½œä¸º Spring ç®¡ç†çš„ beanã€‚</p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
    &lt;version&gt;5.2.10.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<pre><code class="language-java">// ç»„ä»¶ç±»
public class HelloComponent { public void HelloMethod() { System.out.println("hello component..."); } }
</code></pre>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd"&gt;
    &lt;bean id="helloComponent" class="com.xxx.HelloComponent"&gt;&lt;/bean&gt;
    &lt;bean id="..." class="..."&gt;
        &lt;!-- collaborators and configuration for this bean go here --&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre>
<p>id attribute æŒ‡å®š bean çš„å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºç²¾ç¡®è·å–åˆ°ç»„ä»¶å¯¹è±¡ã€‚</p>
<p>class attribute é€šè¿‡å…¨ç±»åçš„å½¢å¼å®šä¹‰ bean çš„ç±»å‹ã€‚</p>
<pre><code class="language-java">// æµ‹è¯•ç±»
public class IOCTest {
    // åˆ›å»º IOC å®¹å™¨å¯¹è±¡
    private ApplicationContext iocContainer = new ClassPathXmlApplicationContext("helloComponent.xml");
    @Test
    public void testExperiment01() {
        // æ ¹æ® id ä» IoC å®¹å™¨å¯¹è±¡é‡Œè·å– bean =&gt; ç»„ä»¶å¯¹è±¡
        HelloComponent helloComponent = (helloComponent) iocContainer.getBean("helloComponent");
        helloComponent.HelloMethod();
    }
}
</code></pre>
<h3 id="bean-%E4%BD%9C%E7%94%A8%E5%9F%9F">Bean ä½œç”¨åŸŸ</h3>
<p>SF å…±æ”¯æŒå…­ä¸ªä½œç”¨åŸŸï¼Œå…¶ä¸­å››ä¸ªä»…åœ¨ web-aware ApplicationContext æ—¶å¯ä½¿ç”¨ã€‚</p>
<p>Bean ä½œç”¨åŸŸå°±æ˜¯é…ç½®åˆ›å»º Bean å®ä¾‹æ˜¯ prototype è¿˜æ˜¯ singletonã€‚é»˜è®¤å•ä¾‹ã€‚</p>
<p>&lt;bean /&gt; çš„ scope å±æ€§è®¾ç½®ä¸º singleton æˆ– prototype åˆ†åˆ«è¡¨ç¤ºå•å®ä¾‹æˆ–å¤šå®ä¾‹ã€‚</p>
<p>å•å®ä¾‹å¯¹è±¡åœ¨åŠ è½½é…ç½®æ–‡ä»¶çš„è¿‡ç¨‹ä¸­åˆ›å»ºï¼Œå¤šå®ä¾‹å¯¹è±¡åˆ›å»ºåœ¨è°ƒç”¨ getBean åã€‚</p>
<p>ä»é»˜è®¤åˆ›å»ºå•ä¾‹ bean å¯ä»¥çœ‹å‡º Spring æ›´å¤šçš„æ˜¯ç®¡ç†å¯å¤ç”¨çš„å¯¹è±¡ï¼Œå¦‚ï¼šservletã€serviceã€dao layer objects å’Œå·¥å…·å¯¹è±¡ã€‚å°è£…å®ä½“çš„åŸŸå¯¹è±¡ä¸é€‚åˆï¼ˆæœ‰çŠ¶æ€ï¼‰ã€‚</p>
<pre><code class="language-xml">&lt;!--&lt;bean id="myBean" class="com.&lt;secret&gt;.spring5.factorybean.MyBean"&gt;&lt;/bean&gt;--&gt;
&lt;bean id="myBean" class="com.&lt;secret&gt;.spring5.factorybean.MyBean" scope="singleton"&gt;&lt;/bean&gt;
</code></pre>
<pre><code class="language-java">@Test
public void testFBean(){
    ApplicationContext context = new ClassPathXmlApplicationContext("bean7.xml");
    MyBean myBean = context.getBean("myBean", MyBean.class);
    MyBean myBean1 = context.getBean("myBean", MyBean.class);
    System.out.println(myBean); // com.&lt;secret&gt;.spring5.factorybean.MyBean@42d8062c
    System.out.println(myBean1); // com.&lt;secret&gt;.spring5.factorybean.MyBean@42d8062c 
}
</code></pre>
<h3 id="instantiating-beans">Instantiating Beans</h3>
<p><strong>å®ä¾‹åŒ– Beanï¼š</strong></p>
<ul>
<li>é€šå¸¸ Spring æ˜¯åœ¨å®¹å™¨æœ¬èº«é€šè¿‡åå°„è°ƒç”¨æ— å‚æ„é€ å‡½æ•°ç›´æ¥åˆ›å»º bean</li>
<li>å®¹å™¨è°ƒç”¨ static factory method é™æ€å·¥å‚æ–¹æ³•æ¥åˆ›å»º bean</li>
<li>å®¹å™¨è°ƒç”¨å®ä¾‹å·¥å‚åˆ›å»º beanï¼ˆéé™æ€ =&gt; éœ€è¦å…ˆ new å‡ºå·¥å‚å¯¹è±¡ï¼‰</li>
</ul>
<p>(Instantiation with a Constructor) æ„é€ å‡½æ•°æ–¹æ³•åˆ›å»º beanï¼š</p>
<ul>
<li>åº”æä¾›ä¸€ä¸ªæ— å‚æ„é€ å‡½æ•°ï¼ˆä¸å†™ä¹Ÿå¯ä»¥ï¼‰</li>
<li>å¦‚æœæ— å‚æ„é€ æ–¹æ³•ä¸æä¾›ï¼Œå®ä¾‹åŒ– Bean ä¼šæŠ›å‡º beanCreationException</li>
</ul>
<pre><code class="language-java">public class XxxDaoImpl implements XxxDao {
    public void yyy() { ... }
}
</code></pre>
<pre><code class="language-xml">&lt;bean id="xxxDao" class="com.???.dao.impl.XxxDaoImpl" /&gt;
</code></pre>
<p>(Instantiation with a Static Factory Method) é™æ€å·¥å‚æ–¹æ³•åˆ›å»º beanï¼š</p>
<ul>
<li>class attribute æŒ‡å®šåŒ…å«é™æ€å·¥å‚æ–¹æ³•çš„å…¨ç±»å</li>
<li>factory-method attribute æŒ‡å®šå·¥å‚æ–¹æ³•çš„åç§°</li>
</ul>
<pre><code class="language-java">public class XxxDaoFactory{ // é™æ€å·¥å‚
    public static XxxDao getXxxDao(){
        return new XxxDaoImpl(); 
    }
}
</code></pre>
<pre><code class="language-xml">&lt;bean id="xxxDao" class="com.???.factory.XxxDaoFactory" factory-method="getXxxDao"/&gt;
</code></pre>
<p>(Instantiation by Using an Instance Factory Method) å®ä¾‹å·¥å‚æ–¹æ³•åˆ›å»º beanï¼š</p>
<ul>
<li>è¯¥æ–¹å¼å¯çœ‹ä½œä»å®¹å™¨ä¸­è°ƒç”¨ç°æœ‰ bean çš„éé™æ€æ–¹æ³•æ¥åˆ›å»ºæ–° bean</li>
<li>class attribute ç•™ç©º</li>
<li>factory-bean attribute æŒ‡å‘å·¥å‚ bean</li>
<li>factory-method attribute æŒ‡å‘å·¥å‚æ–¹æ³•å</li>
</ul>
<pre><code class="language-java">public class XxxDaoFactory{ // å®ä¾‹å·¥å‚
    public XxxDao getXxxDao(){
        return new XxxDaoImpl(); 
    }
}
</code></pre>
<pre><code class="language-xml">&lt;!-- é¢å¤–é…ç½®å·¥å‚ bean --&gt;
&lt;bean id="xxxDaoFactory" class="com.???.factory.XxxDaoFactory" /&gt;
&lt;bean id="xxxDao" factory-method="getXxxDao" factory-bean="xxxDaoFactory"/&gt;
</code></pre>
<p>é€šè¿‡å®ä¾‹å·¥å‚æ–¹æ³•åˆ›å»º bean çš„ç¼ºé™·ï¼š</p>
<ul>
<li>é¢å¤–çš„å·¥å‚ bean æ ‡ç­¾é™¤äº†é…åˆå®ä¾‹åŒ– bean ä¹‹å¤–æ²¡æœ‰å®é™…çš„æ„ä¹‰</li>
<li>å› æ–¹æ³•åçš„ä¸ç¡®å®šï¼Œæ¯æ¬¡å®ä¾‹åŒ– bean éƒ½éœ€è¦å¯¹ factory-method è¿›è¡Œé…ç½®</li>
</ul>
<p>è§£å†³ä¸Šè¿°ç¼ºé™·ï¼šFactoryBean å¯ä»¥å‘å®¹å™¨ä¸­æ³¨å†Œä¸¤ä¸ª beanï¼šç» getObject æ–¹æ³•çš„è¿”å›å€¼æ‰€ä»£è¡¨çš„ bean å’Œå…¶è‡ªèº«ã€‚</p>
<p>â¤ï¸â€ğŸ”¥ ä½¿ç”¨ FactoryBean å®ä¾‹åŒ– beanï¼š</p>
<ul>
<li>å®ç° FactoryBean æ¥å£å¹¶é‡å†™æ¥å£ä¸­çš„ getObject å’Œ getObjectType æ–¹æ³•</li>
<li>getObject è¿”å›å·¥å‚ç”Ÿäº§çš„å¯¹è±¡ï¼ˆè¿™æ˜¯ Spring å®¹å™¨å°†ä½¿ç”¨çš„å¯¹è±¡ï¼‰</li>
<li>getObjectType è¿”å›æ­¤ FactoryBean ç”Ÿæˆçš„å¯¹è±¡ç±»å‹</li>
<li>class attribute è®¾ç½®ä¸ºç° FactoryBean çš„å…¨ç±»å</li>
</ul>
<blockquote>
<p>factory bean æ˜¯æŒ‡é…ç½®åœ¨å®¹å™¨ä¸­å¹¶é€šè¿‡å®ä¾‹æˆ–é™æ€å·¥å‚æ–¹æ³•è€Œåˆ›å»ºçš„ beanã€‚<br />
FactoryBean æ˜¯æŒ‡ç‰¹å®šäº Spring ä¸­ FactoryBean çš„å®ç°ç±»ã€‚<br />
FactoryBean åˆ›å»ºå®Œæˆåï¼Œæ‰€æœ‰çš„ bean å‡ä¸ºå»¶è¿ŸåŠ è½½</p>
</blockquote>
<pre><code class="language-java">public class XxxDaoFactoryBean implements FactoryBean&lt;XxxDao&gt;{
    // ä»£æ›¿åŸå§‹å®ä¾‹å·¥å‚ä¸­åˆ›å»ºå¯¹è±¡çš„æ–¹æ³•
    @Override
    public XxxDao getObject() throws Exception {
        return new XxxDaoImpl();
    }
    @Override
    public Class&lt;?&gt; getObjectType() {
        return XxxDao.class;
    }
}
</code></pre>
<pre><code class="language-xml">&lt;bean id="xxxDao" class="com.???.factory.XxxDaoFactoryBean"/&gt;
</code></pre>
<pre><code class="language-java">public class TestFactoryBean {
    @Test
    public void testFBean(){
        ApplicationContext ctx = new ClassPathXmlApplicationContext("fbBeam.xml");
        XxxDao xxxDao = (XxxDao) ctx.getBean("xxxDao");
        xxxDao.yyy();
    }
}
</code></pre>
<h3 id="lifecycle-callbacks">Lifecycle Callbacks</h3>
<p>åˆå§‹åŒ–å›è°ƒï¼š</p>
<ol>
<li>ä½¿ç”¨ @PostConstruct æ³¨è§£</li>
<li>å¯¹é…ç½®å…ƒæ•°æ®ä½¿ç”¨ init-method æ¥æŒ‡å®š void no-argument çš„æ–¹æ³•å</li>
<li>å®ç°æ¥å£ InitializingBean çš„ afterPropertiesSet æ–¹æ³•</li>
</ol>
<p>é”€æ¯å›è°ƒï¼š</p>
<ol>
<li>ä½¿ç”¨ @PreDestroy æ³¨è§£</li>
<li>å¯¹é…ç½®å…ƒæ•°æ®ä½¿ç”¨ destroy-method æ¥æŒ‡å®š void no-argument çš„æ–¹æ³•å</li>
<li>å®ç°æ¥å£ DisposableBean çš„ destroy æ–¹æ³•</li>
</ol>
<pre><code class="language-java">public class XxxDaoImpl implements XxxDao {
    public void yyy(){ ... }
    public void initFunc(){ ... }
    public void destroyFunc(){ ... }
}
</code></pre>
<pre><code class="language-xml">&lt;bean id="orders" class="com.???.dao.impl.XxxDaoImpl" init-method="initFunc" destroy-method="destroyFunc"/&gt;
</code></pre>
<pre><code class="language-java">public class TestLifeCycle {
    @Test
    public void testLifeCycle(){
        ClassPathXmlApplicationContext ctx = new ClassPathXmlApplicationContext("lifeCyclebean.xml");
        XxxDao xxxDao = (XxxDao) ctx.getBean("xxxDao");
        xxxDao.yyy();
        ctx.registerShutdownHook();  // å…³é—­å®¹å™¨ =&gt; æ•ˆæœåŒ close
//      ctx.close();
    }
}
</code></pre>
<p>ç”Ÿå‘½å‘¨æœŸï¼š</p>
<ol>
<li>åˆå§‹åŒ–å®¹å™¨ï¼šæ–°å»ºå®ä¾‹ã€æ‰§è¡Œæ„é€ ã€å±æ€§æ³¨å…¥ï¼ˆset æ“ä½œï¼‰ã€bean åˆå§‹åŒ–</li>
<li>ä½¿ç”¨ beanï¼šæ‰§è¡Œä¸šåŠ¡</li>
<li>å…³é—­/é”€æ¯å®¹å™¨ï¼šæ‰§è¡Œ bean é”€æ¯æ–¹æ³•</li>
</ol>
<p>Spring IOC å®¹å™¨æä¾›çš„æ‰©å±•æ¥å£ BeanPostProcessor å®šä¹‰äº†ä¸¤ä¸ªå›è°ƒæ–¹æ³•ï¼š</p>
<ul>
<li>postProcessBeforeInitialization åœ¨ bean å®ä¾‹åˆå§‹åŒ–å‰è°ƒç”¨</li>
<li>postProcessAfterInitialization åœ¨ bean å®ä¾‹åˆå§‹åŒ–åè°ƒç”¨</li>
</ul>
<p>åç½®å¤„ç†å™¨ä¼šå¯¹å½“å‰é…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰ bean éƒ½ç”Ÿæ•ˆã€‚</p>
<pre><code class="language-xml">&lt;bean id="myBeanPost" class="com.&lt;secret&gt;.spring5.lifeCycle.MyBeanPost"/&gt;
</code></pre>
<pre><code class="language-java">public class MyBeanPost implements BeanPostProcessor {
    @Nullable
    public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {
        System.out.println("åœ¨åˆå§‹åŒ–ä¹‹å‰æ‰§è¡Œçš„æ–¹æ³•");
        return bean;
    }
    @Nullable
    public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
        System.out.println("åœ¨åˆå§‹åŒ–ä¹‹åæ‰§è¡Œçš„æ–¹æ³•");
        return bean;
    }
}
</code></pre>
<h2 id="%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5-di">ä¾èµ–æ³¨å…¥ DI</h2>
<p>å‘ç±»ä¸­ä¼ é€’æ•°æ®çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼šæ™®é€šæ–¹æ³•ï¼ˆset æ–¹æ³•ï¼‰å’Œæ„é€ æ–¹æ³•ã€‚</p>
<p>åˆ›å»º bean ä¸ä»…ä¼šä¾èµ–å¼•ç”¨æ•°æ®ç±»å‹ï¼Œä¹Ÿä¼šä¾èµ–åŸºæœ¬æ•°æ®ç±»å‹ã€‚</p>
<p>ä»¥ä¸Šï¼Œä¾èµ–æ³¨å…¥ä¼šåˆ†åˆ«å­˜åœ¨é€šè¿‡ setter æˆ–æ„é€ å™¨æ³¨å…¥ç®€å•æˆ–å¼•ç”¨ç±»å‹çš„å››ç§æ–¹å¼ã€‚</p>
<h3 id="setter-%E6%B3%A8%E5%85%A5">setter æ³¨å…¥</h3>
<p>Setter-based DIï¼Œå³ setter æ³¨å…¥æ˜¯é€šè¿‡å®¹å™¨åœ¨è°ƒç”¨æ— å‚æ„é€ å‡½æ•°æˆ–æ— å‚é™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ– bean åè°ƒç”¨å…¶ setter æ–¹æ³•æ¥å®ç°çš„ã€‚</p>
<p><strong>setter æ³¨å…¥å¼•ç”¨ç±»å‹ï¼š</strong></p>
<ul>
<li>bean ä¸­å®šä¹‰å¼•ç”¨ç±»å‹å±æ€§å¹¶æä¾›å¯è®¿é—®çš„ set æ–¹æ³•</li>
<li>é…ç½®ä¸­ä½¿ç”¨ property æ ‡ç­¾çš„ ref å±æ€§æ³¨å…¥å¼•ç”¨ç±»å‹å¯¹è±¡</li>
</ul>
<pre><code class="language-java">public class XxxServiceImpl implements XxxService {
    private XxxDao xxxDao;
    public void setXxxDao(XxxDao xxxDao) {
      this.xxxDao = xxxDao;
    }
}
</code></pre>
<pre><code class="language-xml">&lt;bean id="xxxDao" class="com.xxx.dao.impl.XxxDaoImpl"&gt;
&lt;bean id="xxxService" class="com.xxx.service.impl.XxxServiceImpl"&gt;
    &lt;property name="xxxDao" ref="xxxDao" /&gt;
&lt;/bean&gt;
</code></pre>
<p><strong>setter æ³¨å…¥ç®€å•ç±»å‹ï¼š</strong></p>
<ul>
<li>bean ä¸­å®šä¹‰ç®€å•ç±»å‹å±æ€§å¹¶æä¾›å¯è®¿é—®çš„ set æ–¹æ³•</li>
<li>é…ç½®ä¸­ä½¿ç”¨ property æ ‡ç­¾çš„ value å±æ€§æ³¨å…¥ç®€å•ç±»å‹å¯¹è±¡</li>
</ul>
<pre><code class="language-java">public class XxxServiceImpl implements XxxService {
    private int connectionNumber;
    public void setConnectionNumber(int connectionNumber) {
      this.connectionNumber = connectionNumber;
    }
}
</code></pre>
<pre><code class="language-xml">&lt;bean id="xxxService" class="com.xxx.service.impl.XxxServiceImpl"&gt;
    &lt;property name="connectionNumber" value="6" /&gt;
&lt;/bean&gt;
</code></pre>
<h3 id="%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5">æ„é€ å™¨æ³¨å…¥</h3>
<p>åœ¨åˆ›å»ºå¯¹è±¡æ—¶é»˜è®¤æ‰§è¡Œæ— å‚æ•°çš„æ„é€ ï¼Œè‹¥åœ¨ç±»ä¸­å®šä¹‰æœ‰å‚æ„é€ å™¨å´ä¸å®šä¹‰æ— å‚æ„é€ å™¨åˆ™ä¼šæŠ¥é”™ã€‚</p>
<p><strong>æ„é€ å™¨æ³¨å…¥å¼•ç”¨ç±»å‹ï¼š</strong></p>
<ul>
<li>bean ä¸­å®šä¹‰å¼•ç”¨ç±»å‹å±æ€§å¹¶æä¾›å¯è®¿é—®çš„æ„é€ æ–¹æ³•</li>
<li>é…ç½®ä¸­ä½¿ç”¨ constructor-arg æ ‡ç­¾çš„ ref å±æ€§æ³¨å…¥å¼•ç”¨ç±»å‹å¯¹è±¡</li>
</ul>
<pre><code class="language-java">public class XxxServiceImpl implements XxxService {
    private XxxDao xxxDao;
    public void setXxxDao(XxxDao xxxDao) {
      this.xxxDao = xxxDao;
    }
}
</code></pre>
<pre><code class="language-xml">&lt;bean id="xxxDao" class="com.xxx.dao.impl.XxxDaoImpl"&gt;
&lt;bean id="xxxService" class="com.xxx.service.impl.XxxServiceImpl"&gt;
    &lt;constructor-arg name="xxxDao" ref="xxxDao" /&gt;
&lt;/bean&gt;
</code></pre>
<p><strong>æ„é€ å™¨æ³¨å…¥ç®€å•ç±»å‹ï¼š</strong></p>
<ul>
<li>bean ä¸­å®šä¹‰ç®€å•ç±»å‹å±æ€§å¹¶æä¾›å¯è®¿é—®çš„æ„é€ æ–¹æ³•</li>
<li>é…ç½®ä¸­ä½¿ç”¨ constructor-arg æ ‡ç­¾çš„ value å±æ€§æ³¨å…¥ç®€å•ç±»å‹å¯¹è±¡</li>
</ul>
<pre><code class="language-java">public class XxxServiceImpl implements XxxService {
    private int connectionNumber;
    public void setConnectionNumber(int connectionNumber) {
      this.connectionNumber = connectionNumber;
    }
}
</code></pre>
<pre><code class="language-xml">&lt;bean id="xxxService" class="com.xxx.service.impl.XxxServiceImpl"&gt;
    &lt;constructor-arg name="xxxDao" value="6" /&gt;
&lt;/bean&gt;
</code></pre>
<p><strong>æ„é€ å™¨æ³¨å…¥çš„å‚æ•°é€‚é…ï¼š</strong></p>
<ul>
<li>é…ç½®ä¸­ä½¿ç”¨ constructor-arg æ ‡ç­¾çš„ type å±æ€§è®¾ç½®æŒ‰å½¢å‚ç±»å‹æ³¨å…¥</li>
<li>é…ç½®ä¸­ä½¿ç”¨ constructor-arg æ ‡ç­¾çš„ index å±æ€§è®¾ç½®æŒ‰å½¢å‚ä½ç½®æ³¨å…¥</li>
</ul>
<h3 id="%E4%BE%9D%E8%B5%96%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D">ä¾èµ–è‡ªåŠ¨è£…é…</h3>
<p>è‡ªåŠ¨è£…é…å³ IoC å®¹å™¨æ® bean ä¾èµ–çš„èµ„æºåœ¨å®¹å™¨é‡Œè‡ªåŠ¨æŸ¥æ‰¾å¹¶æ³¨å…¥ bean çš„è¿‡ç¨‹ã€‚</p>
<ul>
<li>é…ç½®ä¸­ä½¿ç”¨ bean æ ‡ç­¾çš„ autowire å±æ€§</li>
<li>è‡ªåŠ¨è£…é…ç”¨äºå¼•ç”¨ç±»å‹ä¾èµ–æ³¨å…¥ï¼Œä¸èƒ½å¯¹ç®€å•ç±»å‹è¿›è¡Œæ“ä½œ</li>
<li>ä½¿ç”¨ byType æŒ‰ç±»å‹è£…é…æ—¶å¿…é¡»ä¿è¯å®¹å™¨ä¸­ç›¸åŒç±»å‹çš„ bean å”¯ä¸€</li>
<li>ä½¿ç”¨ byName æŒ‰åç§°è£…é…æ—¶å¿…é¡»ä¿è¯å®¹å™¨ä¸­å…·æœ‰æŒ‡å®šåç§°çš„ bean</li>
<li>è‡ªåŠ¨è£…é…ä¼˜å…ˆçº§ä½äº setter æ³¨å…¥å’Œç‹—åœ¨å™¨æ³¨å…¥ï¼ŒåŒæ—¶å‡ºç°æ—¶è‡ªåŠ¨è£…é…å¤±æ•ˆ</li>
</ul>
<pre><code class="language-java">// è‡ªåŠ¨è£…é…ç±»
public class Emp {
    private Dept dept;
    @Override
    public String toString() { return "Emp{" + "dept=" + dept + '}'; }
    public void setDept(Dept dept) { this.dept = dept; }
    public void test(){ System.out.println(dept); }
}
</code></pre>
<pre><code class="language-java">// å¾…è£…é…ç±»
public class Dept {
    @Override
    public String toString() { return "Dept{}"; }
}
</code></pre>
<pre><code class="language-xml">&lt;!-- å®ç°è‡ªåŠ¨è£…é… =&gt; autowireå±æ€§ =&gt; ç”¨çš„è¾ƒå°‘ --&gt;
    &lt;!-- byName æ ¹æ®åç§°æ³¨å…¥ =&gt; æ³¨å…¥å€¼ bean çš„ id å€¼å’Œç±»å±æ€§åç§°ä¸€æ · --&gt;
    &lt;!-- byType æ ¹æ®ç±»å‹æ³¨å…¥ =&gt; å¤šä¸ª bean ä¸èƒ½è¿›è¡Œé€‰æ‹© --&gt;
&lt;bean id="emp" class="com.&lt;secret&gt;.spring5.autowire.Emp" autowire="byName"/&gt;
&lt;bean id="dept" class="com.&lt;secret&gt;.spring5.autowire.Dept"&gt;&lt;/bean&gt;
</code></pre>
<pre><code class="language-java">public class TestAutoWire {
    // æµ‹è¯•è‡ªåŠ¨æ³¨å…¥
    @Test
    public void testAutoWire(){
        ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext("bean9.xml");
        Emp emp = context.getBean("emp", Emp.class);
        System.out.println(emp);
        emp.test();
    }
}
</code></pre>
<p>Spring ä¼šå°†å±æ€§çš„ empty arguments è§†ä½œä¸ºç©ºå­—ç¬¦ä¸²ã€‚</p>
<pre><code class="language-xml">&lt;bean class="..."&gt;&lt;property name="email" value=""/&gt;&lt;/bean&gt;
&lt;bean class="..."&gt;&lt;property name="email"&gt;&lt;null/&gt;&lt;/property&gt;&lt;/bean&gt;
</code></pre>
<p>ç‰¹æ®Šç¬¦å·çš„å¤„ç†ï¼š</p>
<ul>
<li>ä½¿ç”¨è½¬ä¹‰å­—ç¬¦è¿›è¡Œä»£æ›¿</li>
<li>property æ ‡ç­¾ä¸­çš„ value å±æ€§åº”æŠ½ç¦»æˆç‹¬ç«‹æ ‡ç­¾</li>
<li>value æ ‡ç­¾é€šè¿‡ <code>&lt;![CDATA[?]]&gt;</code> æ ‡ç­¾å†…å®¹åŒ…è£¹ç‰¹æ®Šç¬¦å·</li>
</ul>
<blockquote>
<p>CData section âˆ’ Characters between these two enclosures are interpreted as characters, and not as markup. This section may contain markup characters (&lt;, &gt;, and &amp;), but they are ignored by the XML processor.</p>
</blockquote>
<pre><code class="language-xml">&lt;bean id="user" class="com.???.spring5.User"&gt;
    &lt;property name="name"&gt;
        &lt;value&gt;
            &lt;!-- CDATA[] å†…ä¸­å¡«å†™è¦è¾“å‡ºçš„å€¼ --&gt;
            &lt;![CDATA[&lt;&lt;okk&gt;&gt;]]&gt;
        &lt;/value&gt;
    &lt;/property&gt;
&lt;/bean&gt;
</code></pre>
<blockquote>
<p>The p-namespace lets you use the bean elementâ€™s attributes (instead of nested <code>&lt;property/&gt;</code> elements) to describe your property values collaborating beans, or both.</p>
</blockquote>
<p>ç®€åŒ– XML é…ç½®æ–‡ä»¶çš„ p-namespaceï¼š</p>
<ul>
<li>å¼•å…¥ nsï¼š<code>xmlns:p="http://www.springframework.org/schema/p"</code></li>
<li>åœ¨å¯¹åº”çš„ bean ä¸­ä½¿ç”¨ <code>p:å±æ€§</code> æ›¿ä»£ <code>&lt;property&gt;</code> æ ‡ç­¾</li>
<li>æ³¨æ„æ­¤æ–¹å¼ä¸éœ€è¦ä¿®æ”¹ xsi:schemaLocation</li>
</ul>
<pre><code class="language-xml">&lt;bean name="my_classicBean" class="com.example.ExampleBean"&gt;
    &lt;property name="email" value="ok@gmail.com"/&gt;
&lt;/bean&gt;
&lt;!-- ä¸Šä¸‹ä¸¤ç§æ–¹å¼ç­‰ä»· --&gt;
&lt;bean name="my_p-namespaceBean" class="com.example.ExampleBean" p:email="ok@gmail.com"/&gt;
</code></pre>
<blockquote>
<p>The c-namespace, introduced in Spring 3.1, allows inlined attributes for configuring the constructor arguments rather then nested constructor-arg elements.</p>
</blockquote>
<p>ç®€åŒ– XML é…ç½®æ–‡ä»¶çš„ c-namespaceï¼š</p>
<ul>
<li>å¼•å…¥ nsï¼š<code>xmlns:c="http://www.springframework.org/schema/c"</code></li>
<li>åœ¨å¯¹åº”çš„ bean ä¸­ä½¿ç”¨ <code>c:å±æ€§</code> æ›¿ä»£ <code>&lt;constructor-arg&gt;</code> æ ‡ç­¾</li>
<li>æ³¨æ„æ­¤æ–¹å¼ä¸éœ€è¦ä¿®æ”¹ xsi:schemaLocation</li>
</ul>
<pre><code class="language-xml">&lt;!-- traditional declaration --&gt;
&lt;bean id="foo" class="x.y.Foo"&gt;
    &lt;constructor-arg ref="bar"/&gt;
    &lt;constructor-arg ref="baz"/&gt;
    &lt;constructor-arg value="foo@bar.com"/&gt;
&lt;/bean&gt;
&lt;!-- c-namespace declaration --&gt;
&lt;bean id="foo" class="x.y.Foo" c:bar-ref="bar" c:baz-ref="baz" c:email="foo@bar.com"/&gt;
</code></pre>
<h3 id="%E9%9B%86%E5%90%88%E6%B3%A8%E5%85%A5">é›†åˆæ³¨å…¥</h3>
<p>æ³¨å…¥é›†åˆç±»å‹çš„å±æ€§ï¼Œå³æ³¨å…¥æ•°ç»„ã€Listã€Map ä»¥åŠ Setã€‚</p>
<pre><code class="language-java">public class XxxDaoImpl implements XxxDao {
    private int[] array;
    private List&lt;String&gt; list;
    private Map&lt;String, String&gt; map;
    private Set&lt;String&gt; set;
    private Properties properties;
    public void setArray(int[] array) { this.array = array; }
    public void setList(List&lt;String&gt; list) { this.list = list; }
    public void setMap(Map&lt;String, String&gt; maps) { this.maps = maps; }
    public void setSet(Set&lt;String&gt; sets) { this.sets = sets; }
    public void setProperties(Properties properties) { this.properties = properties; }
    public void test(){
        System.out.println(Arrays.toString(array));
        System.out.println(list);
        System.out.println(map);
        System.out.println(set);
        System.out.println(properties);
    }
}
</code></pre>
<pre><code class="language-xml">&lt;bean id="xxxDao" class="com.???.dao.impl.XxxDaoImpl"&gt;
    &lt;property name="array"&gt;
        &lt;array&gt;
            &lt;value&gt;1&lt;/value&gt;
            &lt;value&gt;2&lt;/value&gt;
            &lt;value&gt;3&lt;/value&gt;
        &lt;/array&gt;
    &lt;/property&gt;
    &lt;property name="list"&gt;
        &lt;list&gt;
            &lt;value&gt;yes&lt;/value&gt;
            &lt;value&gt;ok&lt;/value&gt;
        &lt;/list&gt;
    &lt;/property&gt;
    &lt;property name="map"&gt;
        &lt;map&gt;
            &lt;entry key="JAVA" value="java"/&gt;
            &lt;entry key="JAVASCRIPT" value="javascript"/&gt;
        &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="set"&gt;
        &lt;set&gt;
            &lt;value&gt;MySQL&lt;/value&gt;
            &lt;value&gt;Redis&lt;/value&gt;
        &lt;/set&gt;
    &lt;/property&gt;
    &lt;property name="properties"&gt;
        &lt;props&gt;
            &lt;prop key="msg"&gt;msgcontext&lt;/prop&gt;
        &lt;/props&gt;
    &lt;/property&gt;
&lt;/bean&gt;
</code></pre>
<pre><code class="language-java">public class TestL {
    @Test
    public void testCollection1(){
        ApplicationContext ctx = new ClassPathXmlApplicationContext("beanDI.xml");
        XxxDao xxxDao = (XxxDao) ctx.getBean("xxxDao");
        xxxDao.test();
    }
}
</code></pre>
<p>åœ¨æ³¨å…¥ bean é›†åˆç±»å‹å±æ€§æ—¶ï¼Œå¯¹äºå­˜åœ¨å¯å¤ç”¨çš„é›†åˆï¼Œåº”æŠ½å–å•ç‹¬å°è£…ã€‚</p>
<pre><code class="language-java">/* é›†åˆæ³¨å…¥æå– */
public class BookExtract {
    private List&lt;String&gt; list;
    public void setList(List&lt;String&gt; list) { this.list = list; }
    public void test(){ System.out.println(list); }
}
</code></pre>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans ...
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="...
                           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd"&gt;
    &lt;!-- é›†åˆæ³¨å…¥éƒ¨åˆ†æå– --&gt;
    &lt;util:list id="bookList"&gt;
        &lt;value&gt;js&lt;/value&gt;
        &lt;value&gt;java&lt;/value&gt;
        &lt;value&gt;nodejs&lt;/value&gt;
    &lt;/util:list&gt;
    &lt;bean id="bookExtract" class="com.&lt;secret&gt;.spring5.bean.BookExtract"&gt;
        &lt;property name="list" ref="bookList"&gt;&lt;/property&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre>
<pre><code class="language-java">public class TestL {
    // é›†åˆæ³¨å…¥éƒ¨åˆ†æŠ½å–æµ‹è¯•
    @Test
    public void testCollection2(){
        ApplicationContext context = new ClassPathXmlApplicationContext("bean6.xml");
        BookExtract be = context.getBean("bookExtract", BookExtract.class);
        be.test();
    }
}
</code></pre>
<h3 id="%E5%BC%95%E7%94%A8%E5%A4%96%E9%83%A8%E6%96%87%E4%BB%B6">å¼•ç”¨å¤–éƒ¨æ–‡ä»¶</h3>
<p>æ•°æ®æºå¯¹è±¡ç®¡ç†ï¼šå¯¼å…¥åæ ‡åé…ç½®æ•°æ®æºå¯¹è±¡ä½œä¸º Spring ç®¡ç†çš„ beanã€‚</p>
<pre><code class="language-xml">&lt;bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource"&gt;
    &lt;property name="driverClassName" value="com.mysql.jdbc.Driver"/&gt;
    &lt;property name="url" value="jdbc:mysql://localhost:3306/spring_db"/&gt;
    &lt;property name="username" value="root"/&gt;
    &lt;property name="password" value="yesok"/&gt;
&lt;/bean&gt;
</code></pre>
<pre><code class="language-xml">&lt;bean id="dataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource"&gt;
    &lt;property name="driverClass" value="com.mysql.jdbc.Driver"/&gt;
    &lt;property name="jdbcUrl" value="jdbc:mysql://localhost:3306/spring_db"/&gt;
    &lt;property name="user" value="root"/&gt;
    &lt;property name="password" value="yesok"/&gt;
&lt;/bean&gt;
</code></pre>
<p>åŠ è½½ properties æ–‡ä»¶ï¼š</p>
<ul>
<li>å¼€å¯ context å‘½åç©ºé—´</li>
<li>ä½¿ç”¨ context ç©ºé—´åŠ è½½ properties æ–‡ä»¶</li>
<li>ä½¿ç”¨å ä½ç¬¦ <code>${}</code> è¯»å– properties æ–‡ä»¶ä¸­çš„å±æ€§</li>
</ul>
<pre><code class="language-xml">&lt;beans ...
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="...
       http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"&gt;
    &lt;context:property-placeholder location="classpath*:*.properties"/&gt;
    &lt;bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource"&gt;
        &lt;property name="driverClassName" value="${jdbc.driverClass}"/&gt;
        &lt;property name="url" value="${jdbc.url}"/&gt;
        &lt;property name="username" value="${jdbc.userName}"/&gt;
        &lt;property name="password" value="${jdbc.password}"/&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre>
<pre><code class="language-yaml">jdbc.driverClass=com.mysql.cj.jdbc.Driver
jdbc.url=jdbc:mysql://localhost:3306/???
jdbc.userName=root
jdbc.password=yesok
</code></pre>
<h2 id="%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91">æ³¨è§£å¼€å‘</h2>
<p>å’Œé…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œæ³¨è§£æœ¬èº«å¹¶ä¸æ‰§è¡Œï¼Œä»…åšä¸ºæ ‡è®°ã€‚å…·ä½“çš„åŠŸèƒ½æ˜¯æ¡†æ¶æ£€æµ‹åˆ°æ³¨è§£æ ‡è®°çš„ä½ç½®ï¼Œç„¶åé’ˆå¯¹è¿™ä¸ªä½ç½®æŒ‰ç…§æ³¨è§£æ ‡è®°çš„åŠŸèƒ½æ¥æ‰§è¡Œæ“ä½œã€‚</p>
<h3 id="%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91%E5%AE%9A%E4%B9%89-bean">æ³¨è§£å¼€å‘å®šä¹‰ bean</h3>
<p>åˆ›å»º bean å®ä¾‹ï¼ˆä¸‹åˆ—æ³¨è§£æ— æœ¬è´¨åŒºåˆ«ï¼‰ï¼š</p>
<ul>
<li><code>@Component</code> æ ‡è®°æ™®é€šç»„ä»¶</li>
<li><code>@Controller</code> æ ‡è®°è¡¨è¿°å±‚ç»„ä»¶</li>
<li><code>@Service</code> æ ‡è®°ä¸šåŠ¡å±‚ç»„ä»¶</li>
<li><code>@Repository</code> æ ‡è®°æ•°æ®å±‚ç»„ä»¶ï¼ˆDAO å’Œ Mapper æ¥å£ï¼‰</li>
</ul>
<p>ç»„ä»¶æ‰«æé…ç½®ï¼š</p>
<ul>
<li>é€šè¿‡ <code>@Component</code> æ³¨è§£å°†ç»„ä»¶ç±»è§†ä½œ bean</li>
<li>é€šè¿‡ <code>context:component-scan</code> æ ‡ç­¾çš„ <code>base-package</code> å±æ€§è¿›è¡Œæ‰«æ</li>
</ul>
<p>å­˜åœ¨å¤šä¸ªåŒ…éœ€è¦æ‰«æçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨é€—å·åˆ†éš”æˆ–è€…ç›´æ¥æ‰«æä¸Šå±‚ç›®å½•ã€‚</p>
<pre><code class="language-java">@Component(value = "userAnnot")
public class UserAnnot {
    public void add(){ System.out.println("Annot add..."); }
}
</code></pre>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"&gt;
    &lt;context:component-scan base-package="com.&lt;secret&gt;.spring5.wkAnnot"/&gt;
&lt;/beans&gt;
</code></pre>
<pre><code class="language-java">/* æ³¨è§£æµ‹è¯•ç±» */
public class TestAnno {
    @Test
    public void testAnno1(){
        ApplicationContext ctx = new ClassPathXmlApplicationContext("bbean1.xml");
        UserAnnot ua = ctx.getBean("userAnnot", UserAnnot.class);
        System.out.println(ua);
        ua.add();
    }
}
</code></pre>
<p>ä½œç”¨èŒƒå›´ç”¨ @Scope å®šä¹‰ï¼Œç”Ÿå‘½å‘¨æœŸç”¨ @PostConstruct å’Œ @PreDestroy å®šä¹‰ã€‚</p>
<h3 id="%E7%BA%AF%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91">çº¯æ³¨è§£å¼€å‘</h3>
<p>Spring3 å¼€å¯çš„çº¯æ³¨è§£å¼€å‘å¯ä»¥é€šè¿‡é…ç½®ç±»æ›¿ä»£é…ç½®æ–‡ä»¶ã€‚</p>
<ul>
<li>@Configuration æ³¨è§£æ ‡è®°å½“å‰ç±»ä½œä¸ºé…ç½®ç±»ï¼Œä»£æ›¿é…ç½®æ–‡ä»¶ç»“æ„</li>
<li>@ComponentScan æ›¿ä»£ context:component-scan æ ‡ç­¾</li>
<li>@PropertySource å¯åŠ è½½ properties æ–‡ä»¶</li>
</ul>
<pre><code class="language-java">public class TestPureAnnot {
    @Test
    public void TestPureAnnot(){
        ApplicationContext ctx = new AnnotationConfigApplicationContext(SpringConfig.class);
        UserService userservice = ctx.getBean("userService", UserService.class);
        userservice.usMethod();
    }
}
</code></pre>
<pre><code class="language-java">@Configuration
@ComponentScan(basePackages = {"com.&lt;secret&gt;.spring5.annoDev"})
@PropertySource("classpath:jdbc.properties")
public class SpringConfig {}
</code></pre>
<h3 id="%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5">ä¾èµ–æ³¨å…¥</h3>
<p>è‡ªåŠ¨è£…é…ï¼š</p>
<ul>
<li><code>@Autowired</code> æ ¹æ® bean ç±»å‹è¿›è¡Œè£…é…</li>
<li><code>@Qualifier</code> æ ¹æ® bean åç§°è¿›è¡Œè£…é…</li>
<li><code>@Resource</code> æ—¢å¯æ ¹æ®ç±»å‹è£…é…ï¼Œä¹Ÿå¯æ ¹æ®åç§°è£…é…</li>
<li><code>@Value</code> è¿›è¡Œç®€å•ç±»å‹æ³¨å…¥</li>
</ul>
<p><code>@Qualifier</code> å¿…é¡»ä¾èµ– <code>@Autowired</code>ï¼Œç”¨äºè§£å†³ç›¸åŒç±»å‹ bean æ³¨å…¥çš„å†²çªã€‚</p>
<p>è‡ªåŠ¨è£…é…åŸºäºåå°„è®¾è®¡åˆ›å»ºå¯¹è±¡å¹¶æš´åŠ›åå°„å¯¹åº”å±æ€§ä¸ºç§æœ‰å±æ€§åˆå§‹åŒ–æ•°æ®ï¼Œå› æ­¤æ— éœ€æä¾› setter æ–¹æ³•ã€‚</p>
<p>è‡ªåŠ¨è£…é…å»ºè®®ä½¿ç”¨æ— å‚æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼ˆé»˜è®¤ï¼‰ï¼Œè‹¥ä¸æä¾›å¯¹åº”æ„é€ æ–¹æ³•ï¼Œåˆ™æä¾›å”¯ä¸€æ„é€ æ–¹æ³•ã€‚</p>
<pre><code class="language-java">@Service
public class UserService {
//    @Autowired // æ ¹æ®ç±»å‹è¿›è¡Œæ³¨å…¥
//    @Qualifier(value="userDaoImpl1")
//    private UserService userDao;
//    @Resource // æ ¹æ®ç±»å‹è¿›è¡Œæ³¨å…¥
    @Resource(name = "userDaoImpl1") // æ ¹æ®åç§°è¿›è¡Œæ³¨å…¥
    private UserDao userDao;
    @Value(value="hz") // æ³¨å…¥æ™®é€šç±»å‹å±æ€§
    private String name;
    public void usMethod(){
        System.out.println("service usMethod");
        userDao.udiMethod();
        System.out.println(name);
    }
}
</code></pre>
<pre><code class="language-java">@Repository(value="userDaoImpl1")
public class UserDaoImpl implements UserDao{
    @Override
    public void udiMethod() { System.out.println("impl ado udiMethod"); }
}
</code></pre>
<h3 id="%E7%AE%A1%E7%90%86%E7%AC%AC%E4%B8%89%E6%96%B9-bean">ç®¡ç†ç¬¬ä¸‰æ–¹ bean</h3>
<p>ç¬¬ä¸‰æ–¹ bean ç®¡ç†ï¼š</p>
<ul>
<li>ä½¿ç”¨ç‹¬ç«‹çš„é…ç½®ç±»ç®¡ç†ç¬¬ä¸‰æ–¹ bean</li>
<li>@Bean æ ‡è®°è¿”å›å€¼æ˜¯ bean çš„æ–¹æ³•</li>
<li>æ‰‹åŠ¨åŠ å…¥é…ç½®ç±»åˆ°æ ¸å¿ƒé…ç½®
<ul>
<li>å¯¼å…¥å¼ @Import æ³¨è§£</li>
<li>æ‰«æå¼ @ComponentScan æ³¨è§£ï¼ˆéœ€é¢å¤– @Configuration æ³¨è§£ï¼‰</li>
</ul>
</li>
</ul>
<pre><code class="language-java">// @Configuration
public class JdbcConfig {
    @Bean
    public DataSource dataSource(){
        DruidDataSource ds = new DruidDataSource();
        ds.setDriverClassName("com.mysql.jdbc.Driver");
        ds.setUrl("jdbc:mysql://localhost:3306/???");
        ds.setUsername("root");
        ds.setPassword("yesok");
        return ds;
    }
}
</code></pre>
<pre><code class="language-java">@Configuration
@Import({JdbcConfig.class}) // @ComponentScan({"com.xxx.config"})
public class SpringConfig {}
</code></pre>
<p>ç¬¬ä¸‰æ–¹ bean çš„ä¾èµ–æ³¨å…¥ï¼š</p>
<ul>
<li>ç®€å•ç±»å‹é€šè¿‡ @Value æ³¨è§£è¿›è¡Œæ³¨å…¥</li>
<li>å¼•ç”¨ç±»å‹æ³¨å…¥éœ€ä¸ºè¿”å› bean çš„æ–¹æ³•è®¾ç½®ç›¸åº”çš„å½¢å‚</li>
</ul>
<pre><code class="language-java">public class JdbcConfig {
    @Value("com.mysql.jdbc.Driver");
    private String driver;
    @Value("jdbc:mysql://localhost:3306/???");
    private String url;
    @Value("root");
    private String userName;
    @Value("password")
    private String password;
    @Bean
    public DataSource dataSource(XxxService xxxService){
        System.out.println(xxxService);
        DruidDataSource ds = new DruidDataSource();
        ds.setDriverClassName(driver);
        ds.setUrl(url);
        ds.setUsername(userName);
        ds.setPassword(password);
        return ds;
    }
}
</code></pre>
<pre><code class="language-java">@Configuration
@ComponentScan({"com..???..config","com.???.service"})
@Import({JdbcConfig.class})
public class SpringConfig {}
</code></pre>
<h2 id="aspect-oriented-programming">Aspect Oriented Programming</h2>
<blockquote>
<p>AOP <strong>é¢å‘åˆ‡é¢ç¼–ç¨‹</strong>ï¼šåœ¨ä¸æƒŠåŠ¨åŸå§‹è®¾è®¡çš„åŸºç¡€ä¸Šè¿›è¡ŒåŠŸèƒ½çš„å¢å¼ºã€‚</p>
</blockquote>
<blockquote>
<p>In Spring AOP, aspects are implemented by using regular classes (the schema-based approach) or regular classes annotated with the @Aspect annotation (the @AspectJ style).</p>
</blockquote>
<h3 id="aop-basis">AOP Basis</h3>
<p>AOP æœ¯è¯­å¹¶ä¸æ˜¯ç‰¹å®šäº Springã€‚å› å…¶æŠ½è±¡æ€§ï¼ŒSpring ä¸ä¼šå¢åŠ é¢å¤–çš„æ¦‚å¿µã€‚</p>
<ul>
<li>è¿æ¥ç‚¹ JoinPointï¼šå·²å­˜åœ¨çš„åŠŸèƒ½ï¼Œå¯¹åº”å„ç±»çš„æ–¹æ³•ï¼Œæ‰§è¡Œä½ç½®ä¸é™</li>
<li>åˆ‡å…¥ç‚¹ Pointcutï¼šéœ€è¦è¿½åŠ åŠŸèƒ½çš„æ–¹æ³•ï¼Œå¯é€šè¿‡è¡¨è¾¾å¼åŒ¹é…å¯¹åº”çš„è¿æ¥ç‚¹</li>
<li>é€šçŸ¥ Adviceï¼šå·²æŠ½å–å‡ºçš„å…±æ€§åŠŸèƒ½ä¸å¢å¼ºé€»è¾‘ï¼Œä¾æ‰˜é€šçŸ¥ç±»ï¼ˆå®šä¹‰é€šçŸ¥ï¼‰</li>
<li>åˆ‡é¢ Aspectï¼šæè¿°é€šçŸ¥çš„å…±æ€§åŠŸèƒ½ä¸å¯¹åº”åˆ‡å…¥ç‚¹çš„å…³ç³»</li>
</ul>
<p>ä½¿ç”¨ pointcut designator ç¡®å®šå¯¹å…·ä½“ç±»é‡Œçš„å…·ä½“æ–¹æ³•è¿›è¡Œå¢å¼ºï¼š</p>
<pre><code class="language-java">// The format of an execution expression follows:
execution(modifiers-pattern? ret-type-pattern declaring-type-pattern?name-pattern(param-pattern) throws-pattern?)
</code></pre>
<p>AOP æ“ä½œçš„å®ç° AspectJ å¹¶éæ˜¯ Spring çš„ç»„æˆéƒ¨åˆ†ï¼Œè€Œæ˜¯ç‹¬ç«‹çš„ AOP æ¡†æ¶ï¼š</p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.aspectj&lt;/groupId&gt;
    &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;
    &lt;version&gt;1.9.19&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>æ³¨è§£æ“ä½œ AspectJ è¿›è¡Œ AOP å¼€å‘ï¼š</p>
<ul>
<li>å¯¼å…¥ AspectJ ç›¸å…³åæ ‡ï¼›spring-context åæ ‡é»˜è®¤ä¾èµ– spring-aop åæ ‡</li>
<li>å®šä¹‰ AOP æ¥å£ä¸å®ç°ç±»</li>
<li>å®šä¹‰é€šçŸ¥ç±»æŠ½å–é€šçŸ¥ï¼Œå¹¶é€šè¿‡ @Pointcut å®šä¹‰åˆ‡å…¥ç‚¹</li>
<li>ç»‘å®šåˆ‡å…¥ç‚¹ä¸é€šçŸ¥å…³ç³»ï¼Œå¹¶æŒ‡å®šé€šçŸ¥æ·»åŠ åˆ°åŸå§‹è¿æ¥ç‚¹çš„å…·ä½“æ‰§è¡Œä½ç½®</li>
<li>å®šä¹‰é€šçŸ¥ç±»æ¥å— Spring å®¹å™¨ç®¡ç†ï¼Œä¸”å®šä¹‰å½“å‰ç±»ä¸ºåˆ‡é¢ç±»</li>
<li>åœ¨ Spring æ ¸å¿ƒé…ç½®ä¸­å¼€å¯ Spring å¯¹ AOP æ³¨è§£çš„é©±åŠ¨æ”¯æŒ</li>
</ul>
<pre><code class="language-java">// è¢«å¢å¼ºç±»
@Component
public class User {
    public void uMethod(){ System.out.println("user method"); }
}
</code></pre>
<p>åˆ‡å…¥ç‚¹çš„å®šä¹‰ä¾æ‰˜ä¸€ä¸ªä¸å…·æœ‰å®é™…æ„ä¹‰çš„æ–¹æ³•è¿›è¡Œï¼Œå³æ— å‚æ•°ï¼Œæ— è¿”å›å€¼ï¼Œæ— å®é™…é€»è¾‘ã€‚AOP é€šçŸ¥ç±»å‹æŸ¥çœ‹ã€€=&gt; <a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-advice">Declaring Advice</a></p>
<pre><code class="language-java">// å¢å¼ºç±» or é€šçŸ¥ç±» =&gt; ä¸åŒæ–¹æ³•ä»£è¡¨ä¸åŒé€šçŸ¥å†…å®¹
@Component // ç”Ÿæˆ bean
@Aspect // ç”Ÿæˆä»£ç†å¯¹è±¡ &amp; ä½œä¸º AOP å¤„ç†
@Order(3) // å¤šä¸ªå¢å¼ºç±»è®¾ç½®ä¼˜å…ˆçº§
public class UserProxy {
    // ç›¸åŒåˆ‡å…¥ç‚¹æŠ½å–
    @Pointcut(value="execution(* com.&lt;secret&gt;.spring5.aopanno.User.uMethod())")
    public void pointExtraction(){

    }
    // å‰ç½®é€šçŸ¥
    @Before(value="execution(* com.&lt;secret&gt;.spring5.aopanno.User.uMethod())")
    public void before(){
        // å‰ç½®é€šçŸ¥
        System.out.println("before...");
    }
    // åç½®é€šçŸ¥ =&gt; æ–¹æ³•ä¹‹å =&gt; å¼‚å¸¸ä¹Ÿæ‰§è¡Œ
    @After(value="pointExtraction()") // é‡ç”¨åˆ‡å…¥ç‚¹å®šä¹‰
    public void after(){
        System.out.println("after...");
    }
    // è¿”å›é€šçŸ¥ =&gt; è¿”å›å€¼ä¹‹åæ‰§è¡Œ
    @AfterReturning(value="pointExtraction()")
    public void afterReturning(){
        System.out.println("afterReturning...");
    }
    @AfterThrowing(value="execution(* com.&lt;secret&gt;.spring5.aopanno.User.uMethod())")
    public void afterThrowing(){
        System.out.println("afterThrowing...");
    }
    // ç¯ç»•é€šçŸ¥
    @Around(value="execution(* com.&lt;secret&gt;.spring5.aopanno.User.uMethod())")
    public Object around(ProceedingJoinPoint proceedingJoinPoint) throws Throwable{
        System.out.println("around before...");
        Object ret = proceedingJoinPoint.proceed();
        System.out.println("around after...");
        return ret;
    }
}
</code></pre>
<p>ä»¥ä¸‹å¼€å¯ Spring å¯¹ AOP æ³¨è§£é©±åŠ¨çš„æ”¯æŒæ–¹å¼ä»»é€‰å…¶ä¸€å³å¯ã€‚</p>
<pre><code class="language-java">@Configuration
@ComponentScan(basePackages = {"com.???"})
@EnableAspectJAutoProxy(proxyTargetClass = true)
public class ConfigAop {}
</code></pre>
<pre><code class="language-xml">&lt;beans ...
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="...
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
                           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;
    &lt;!-- å¼€å¯æ³¨è§£æ‰«æ --&gt;
    &lt;context:component-scan base-package="com.&lt;secret&gt;.spring5.aopanno"&gt;&lt;/context:component-scan&gt;
    &lt;!-- å¼€å¯ Aspect ç”Ÿæˆä»£ç†å¯¹è±¡ --&gt;
    &lt;aop:aspectj-autoproxy&gt;&lt;/aop:aspectj-autoproxy&gt;
&lt;/beans&gt;
</code></pre>
<p>xml æ“ä½œ AspectJ è¿›è¡Œ AOP å¼€å‘ï¼š</p>
<pre><code class="language-java">// è¢«å¢å¼ºç±»
public class Coffee { public void drink(){ System.out.println("drinking coffee..."); } }
// ä»£ç†å¢å¼ºç±»
public class CoffeeProxy { public void before(){ System.out.println("coffee with ice"); } }
</code></pre>
<pre><code class="language-xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
                           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;
    &lt;!-- åˆ›å»ºå¯¹è±¡ --&gt;
    &lt;bean id="coffee" class="com.&lt;secret&gt;.spring5.aopxml.Coffee"&gt;&lt;/bean&gt;
    &lt;bean id="coffeeProxy" class="com.&lt;secret&gt;.spring5.aopxml.CoffeeProxy"&gt;&lt;/bean&gt;
    &lt;!-- é…ç½®aopå¢å¼º --&gt;
    &lt;aop:config&gt;
        &lt;!-- åˆ‡å…¥ç‚¹ --&gt;
        &lt;aop:pointcut id="p" expression="execution(* com.???.spring5.aopxml.Coffee.drink(..))"/&gt;
        &lt;!-- é…ç½®åˆ‡é¢ --&gt;
        &lt;aop:aspect ref="coffeeProxy"&gt;
            &lt;!-- å¢å¼ºä½œç”¨åœ¨å…·ä½“çš„æ–¹æ³•ä¸Š --&gt;
            &lt;aop:before method="before" pointcut-ref="p"/&gt;
        &lt;/aop:aspect&gt;
    &lt;/aop:config&gt;
&lt;/beans&gt;
</code></pre>
<h3 id="underlying-principle">Underlying Principle</h3>
<p>AOP å·¥ä½œæµç¨‹ï¼š</p>
<ol>
<li>Spring å®¹å™¨å¯åŠ¨å¹¶è¯»å–æ‰€æœ‰åˆ‡é¢é…ç½® @Aspect ä¸­çš„åˆ‡å…¥ç‚¹ @Pointcut</li>
<li>åˆå§‹åŒ– bean å¹¶åˆ¤æ–­ bean å¯¹åº”çš„ç±»ä¸­æ–¹æ³•æ˜¯å¦åŒ¹é…åˆ°ä»»æ„åˆ‡å…¥ç‚¹
<ul>
<li>åŒ¹é…å¤±è´¥æ—¶ï¼Œè·å– bean å¹¶è°ƒç”¨æ–¹æ³•æ‰§è¡Œ</li>
<li>åŒ¹é…æˆåŠŸæ—¶ï¼Œåˆ›å»ºç›®æ ‡å¯¹è±¡çš„ä»£ç†å¯¹è±¡ï¼Œæ ¹æ®ä»£ç†å¯¹è±¡çš„è¿è¡Œæ¨¡å¼è¿è¡ŒåŸå§‹æ–¹æ³•ä¸å¢å¼ºçš„å†…å®¹</li>
</ul>
</li>
</ol>
<p>é€šè¿‡åŠ¨æ€ä»£ç†å¢å¼ºç±»çš„æ–¹æ³•ï¼š</p>
<ul>
<li>åœ¨æœ‰æ¥å£æƒ…å†µä¸‹ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ï¼šåˆ›å»ºæ¥å£å®ç°ç±»ä»£ç†å¯¹è±¡</li>
<li>åœ¨æ²¡æœ‰æ¥å£æƒ…å†µä¸‹ä½¿ç”¨ CGLIB åŠ¨æ€ä»£ç†ï¼šåˆ›å»ºå­ç±»çš„ä»£ç†å¯¹è±¡</li>
</ul>
<pre><code class="language-java">public interface UserDao {
    public int add(int a,int b);
    public String update(String str);
}
</code></pre>
<pre><code class="language-java">public class UserDaoImpl implements UserDao{
    @Override
    public int add(int a, int b) {
        System.out.println("addæ–¹æ³•æ‰§è¡Œäº†");
        return a+b;
    }

    @Override
    public String update(String str) {
        System.out.println("updateæ–¹æ³•æ‰§è¡Œäº†");
        return str;
    }
}
</code></pre>
<pre><code class="language-java">public class JDKProxy {
    public static void main(String[] args){
        Class[] interfaces = {UserDao.class};
        // åˆ›å»ºæ¥å£å®ç°ç±»çš„ä»£ç†å¯¹è±¡
        // ç¬¬ä¸‰å‚æ•°ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»
//        Proxy.newProxyInstance(JDKProxy.class.getClassLoader(), interfaces, new InvocationHandler() {
//            @Override
//            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
//                return null;
//            }
//        })
        UserDaoImpl userDao = new UserDaoImpl();
        // æ¥å£ç­‰äºå®ç°ç±»çš„ä»£ç†å¯¹è±¡
        UserDao dao = (UserDao)Proxy.newProxyInstance(JDKProxy.class.getClassLoader(),interfaces, new UserDaoProxy(userDao));
        int result = dao.add(1, 2);
        System.out.println(result);
    }
}

// åˆ›å»ºä»£ç†å¯¹è±¡ä»£ç 
class UserDaoProxy implements InvocationHandler{
    // åˆ›å»ºçš„æ˜¯è°çš„ä»£ç†å¯¹è±¡,å°±å°†è°ä¼ é€’è¿‡æ¥
    // æœ‰å‚æ„é€ ä¼ é€’
    private Object obj;
    public UserDaoProxy(Object obj){
        this.obj = obj;
    }
    // å¯¹è±¡ä¸€åˆ›å»º,æ–¹æ³•å°±è°ƒç”¨
    // å¢å¼ºçš„é€»è¾‘
    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        // æ–¹æ³•ä¹‹å‰
        System.out.println("æ–¹æ³•å‰æ‰§è¡Œ =&gt; "+method.getName()+" =&gt; ä¼ é€’å‚æ•° =&gt; "+ Arrays.toString(args));
        // è¢«å¢å¼ºçš„æ–¹æ³•æ‰§è¡Œ
        Object res = method.invoke(obj, args);
        // æ–¹æ³•ä¹‹å
        System.out.println("æ–¹æ³•åæ‰§è¡Œ =&gt; "+obj);
        return res;
    }
}
</code></pre>
<h3 id="aop-%E9%80%9A%E7%9F%A5%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE">AOP é€šçŸ¥è·å–æ•°æ®</h3>
<p>è·å–åˆ‡å…¥ç‚¹æ–¹æ³•çš„å‚æ•°ï¼š</p>
<ul>
<li>JointPontï¼šé€‚ç”¨äºå‰ç½®ã€åç½®ã€è¿”å›ã€æŠ›å‡ºå¼‚å¸¸åé€šçŸ¥</li>
<li>ProceedJointPointï¼šé€‚ç”¨äºç¯ç»•é€šçŸ¥</li>
</ul>
<p>è·å–åˆ‡å…¥ç‚¹æ–¹æ³•è¿”å›å€¼ï¼š</p>
<ul>
<li>@AfterReturning ä¸­ä½¿ç”¨ returningï¼ˆè¡¥å…… value å±æ€§ï¼‰</li>
<li>@Around æ ‡è®°çš„ç¯ç»•é€šçŸ¥ä¸­å¯ä»¥ç›´æ¥å¯¹åŸå§‹æ–¹æ³•è°ƒç”¨è·å–è¿”å›å€¼ç»“æœ</li>
</ul>
<p>è·å–åˆ‡å…¥ç‚¹å¼‚å¸¸ä¿¡æ¯ï¼š</p>
<ul>
<li>@AfterThrowing ä¸­ä½¿ç”¨ throwing å½¢å‚æ¥æ”¶å¼‚å¸¸å¯¹è±¡</li>
<li>@Around æ ‡è®°çš„ç¯ç»•é€šçŸ¥ä¸­ä½¿ç”¨ <code>try...catch</code> å¯¹ proceed å—è¿›è¡ŒåŒ…è£¹</li>
</ul>
<h2 id="spring-%E4%BA%8B%E5%8A%A1%E6%93%8D%E4%BD%9C">Spring äº‹åŠ¡æ“ä½œ</h2>
<p>äº‹åŠ¡æœ¬èº«å¸¸ä½œç”¨ä¿éšœæ•°æ®åº“æ“ä½œçš„ä¸€è‡´æ€§ï¼ŒSpring äº‹åŠ¡å¯åœ¨ service å±‚æˆ– dao å±‚ä¸Šè¿›è¡Œå¼€å±•ã€‚</p>
<p>æ³¨è§£å¼äº‹åŠ¡å¯ä»¥æ·»åŠ åˆ°å…·ä½“çš„ä¸šåŠ¡æ–¹æ³•ä¸Šï¼Œä¹Ÿå¯ä»¥æ·»åŠ åˆ°æ¥å£ä¸Šæ¥è¡¨ç¤ºå½“å‰æ¥å£çš„æ‰€æœ‰æ–¹æ³•éƒ½å¼€å¯äº‹åŠ¡ã€‚</p>
<p>ä½¿ç”¨ Spring äº‹åŠ¡ç®¡ç†æ³¨è§£ @Transactional æ·»åŠ åœ¨ä¸šåŠ¡å±‚æ¥å£ä¸Šè€Œéä¸šåŠ¡å±‚å®ç°ç±»ä¸­ï¼ˆè§£è€¦ï¼‰ã€‚</p>
<pre><code class="language-java">public interface XxxService{
    @Transactional
    public void transfer(...)
}
</code></pre>
<p>è®¾ç½®äº‹åŠ¡ç®¡ç†å™¨ï¼šä½¿ç”¨ Spring æä¾›çš„æ ‡å‡†æ¥å£ PlatformTransactionManagerã€‚</p>
<pre><code class="language-java">// åˆ›å»ºäº‹åŠ¡ç®¡ç†å™¨å¯¹è±¡
@Bean
public PlatformTransactionManager transactionManager(DataSource dataSource){
    DataSourceTransactionManager dstm = new DataSourceTransactionManager();
    dstm.setDataSource(dataSource);
    return dstm;
}
</code></pre>
<h3 id="%E6%B3%A8%E8%A7%A3%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86">æ³¨è§£å£°æ˜å¼äº‹åŠ¡ç®¡ç†</h3>
<p>å£°æ˜å¼äº‹åŠ¡ç®¡ç†åº•å±‚ä½¿ç”¨ AOP åŸç†ï¼Œå…¶ API æ˜¯æ ¹æ®ä»£è¡¨äº‹åŠ¡ç®¡ç†å™¨çš„æ¥å£ï¼Œé’ˆå¯¹ä¸åŒæ¡†æ¶æä¾›çš„ä¸åŒå®ç°ç±» =&gt; PlatformTransactionManagerã€‚</p>
<pre><code class="language-java">@Configuration // @Configuration =&gt; ä»£è¡¨é…ç½®ç±»
@ComponentScan(basePackages = "com.&lt;secret&gt;.spring5.txdemo") // @ComponentScan =&gt; ç»„ä»¶æ‰«æ
@EnableTransactionManagement // @EnableTransactionManagement =&gt; å¼€å¯äº‹åŠ¡
public class TxConfig {
    // åˆ›å»ºæ•°æ®åº“è¿æ¥æ± 
    @Bean
    public DruidDataSource getDuridDataSource(){
        DruidDataSource dataSource = new DruidDataSource();
        dataSource.setDriverClassName("com.mysql.cj.jdbc.Driver");
        dataSource.setUrl("jdbc:mysql://localhost:3306/user_db");
        dataSource.setUsername("&lt;username&gt;");
        dataSource.setPassword("&lt;password&gt;");
        return dataSource;
    }
    // åˆ›å»ºjdbcæ¨¡æ¿å¯¹è±¡
    @Bean
    public JdbcTemplate getJdbcTemplate(DataSource dataSource){
        JdbcTemplate jdbcTemplate = new JdbcTemplate();
        // æ³¨å…¥ dataSource
        // IOC å®¹å™¨å·²å­˜åœ¨ dataSource å¯¹è±¡,æ ¹æ®ç±»å‹æ‰¾åˆ° dataSource å¯¹è±¡æ¯”åˆ›å»ºå¯¹è±¡æ›´å¥½
        // jdbcTemplate.setDataSource(getDuridDataSource());
        jdbcTemplate.setDataSource(dataSource);
        return jdbcTemplate;
    }
    // åˆ›å»ºäº‹åŠ¡ç®¡ç†å™¨å¯¹è±¡
    @Bean
    public DataSourceTransactionManager getDataSourceTransactionManager(DataSource dataSource){
        DataSourceTransactionManager transactionManager = new DataSourceTransactionManager();
        transactionManager.setDataSource(dataSource);
        return transactionManager;
    }
}
</code></pre>
<pre><code class="language-html">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
                           http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd
"&gt;
    &lt;!-- å¼€å¯ç»„ä»¶æ‰«æ --&gt;
    &lt;context:component-scan base-package="com.&lt;secret&gt;.spring5.txdemo"&gt;&lt;/context:component-scan&gt;
    &lt;!-- æ•°æ®åº“è¿æ¥æ±  --&gt;
    &lt;bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource" destroy-method="close"&gt;
        &lt;property name="url" value="jdbc:mysql://localhost:3306/{yourdb}" /&gt;
        &lt;property name="username" value={yourusername} /&gt;
        &lt;property name="password" value={yourpassword} /&gt;
        &lt;property name="driverClassName" value="com.mysql.cj.jdbc.Driver" /&gt;
    &lt;/bean&gt;
    &lt;!-- jdbctemplateå¯¹è±¡ --&gt;
    &lt;bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate"&gt;
        &lt;!-- æ³¨å…¥datasource --&gt;
        &lt;property name="dataSource" ref="dataSource"&gt;&lt;/property&gt;
    &lt;/bean&gt;
    &lt;!-- åˆ›å»ºäº‹åŠ¡ç®¡ç†å™¨ --&gt;
    &lt;bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;
        &lt;!-- æ³¨å…¥æ•°æ®æº =&gt; æŒ‡å®šå¯¹å“ªä¸ªæ•°æ®åº“è¿›è¡Œäº‹åŠ¡ç®¡ç† --&gt;
        &lt;property name="dataSource" ref="dataSource"&gt;&lt;/property&gt;
    &lt;/bean&gt;
    &lt;!-- å¼€å¯äº‹åŠ¡æ³¨è§£ =&gt; æŒ‡å®šå“ªä¸ªäº‹åŠ¡ç®¡ç†å™¨å¼€å¯ --&gt;
    &lt;tx:annotation-driven transaction-manager="transactionManager"&gt;&lt;/tx:annotation-driven&gt;
&lt;/beans&gt;
</code></pre>
<p>äº‹åŠ¡æ–¹æ³•å³å¯¹æ•°æ®åº“è¡¨æ•°æ®è¿›è¡Œå˜åŒ–çš„æ“ä½œã€‚æœ‰æˆ–æ— äº‹åŠ¡çš„æ–¹æ³•äº’ç›¸è°ƒç”¨çš„æ“ä½œè¿‡ç¨‹ç§°ä¸ºäº‹åŠ¡ä¼ æ’­è¡Œä¸ºã€‚<a href="https://www.baeldung.com/spring-transactional-propagation-isolation">äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º</a>å¯ä»¥ç”±ä¼ æ’­å±æ€§æŒ‡å®šã€‚</p>
<p>å¸¸è§çš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼š</p>
<ul>
<li>REQUIRED
<ul>
<li>æœ‰äº‹åŠ¡çš„ A æ–¹æ³•è°ƒç”¨æ— äº‹åŠ¡æ–¹æ³• B åï¼ŒB æ–¹æ³•ä½¿ç”¨ A æ–¹æ³•ä¸­äº‹åŠ¡</li>
<li>æ— äº‹åŠ¡ A æ–¹æ³•è°ƒç”¨æ— äº‹åŠ¡çš„ B æ–¹æ³•åï¼Œåˆ›å»ºæ–°äº‹åŠ¡</li>
</ul>
</li>
<li>REQUIRED_NEW
<ul>
<li>A æ–¹æ³•è°ƒç”¨æ— äº‹åŠ¡çš„æ–¹æ³• Bï¼Œä¸è®ºæ–¹æ³• A æ˜¯å¦æœ‰äº‹åŠ¡éƒ½åˆ›å»ºæ–°äº‹åŠ¡</li>
</ul>
</li>
</ul>
<pre><code class="language-java">@Service
// å¯ä»¥åŠ åœ¨ç±»ä¸Šæˆ–æ–¹æ³•ä¸Š =&gt; å‰è€…è¡¨ç¤ºæ‰€æœ‰æ–¹æ³•éƒ½æ·»åŠ ä¸Šäº†äº‹åŠ¡,åè€…åªæ˜¯æ­¤æ–¹æ³•æ·»åŠ äº‹åŠ¡.
// é»˜è®¤ä¼ æ’­è¡Œä¸ºå°±æ˜¯propagation.REQUIRED
// mysql é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯ REPEATABLE_READ
@Transactional(propagation = Propagation.REQUIRED,isolation = Isolation.REPEATABLE_READ,timeout = -1)
public class UserService {}
</code></pre>
<p>å¸¸è§çš„äº‹åŠ¡ç›¸å…³é…ç½®ï¼š</p>
<ul>
<li>rollbackFor è®¾ç½®äº‹åŠ¡å›æ»šå¼‚å¸¸ï¼Œè§£å†³éƒ¨åˆ†å¼‚å¸¸ä¸å›æ»šçš„æƒ…å†µ</li>
</ul>
<p>Spring åœ¨é‡è§ Error å’Œ Runtime å¼‚å¸¸æ—¶æ‰ä¼šå›æ»šï¼ŒIO å¼‚å¸¸ä¸ä¼šè¿›è¡Œå›æ»šã€‚</p>
<pre><code class="language-java">if(true) {throw new IOException();} // äº‹åŠ¡ä¸ç”Ÿæ•ˆ
</code></pre>
<p>åœ¨ @Transactional ä¸­è®¾ç½® <code>rollbackFor = {IOException.class}</code> è¿›è¡Œå›æ»šã€‚</p>
<pre><code class="language-java">@Transactional(rollbackFor = {IOException.class})
</code></pre>
<p>äº‹åŠ¡çš„éš”ç¦»æ€§æ˜¯ä¸ºè§£å†³åœ¨å¹¶å‘æ“ä½œä¸­äº§ç”Ÿçš„è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ç­‰é—®é¢˜ã€‚è„è¯»æ˜¯ä¸€ä¸ªæœªæäº¤çš„äº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡çš„æ•°æ®ï¼›ä¸å¯é‡å¤è¯»è¡¨ç¤ºä¸€ä¸ªæœªæäº¤çš„äº‹åŠ¡è¯»å–åˆ°äº†å¦ä¸€ä¸ªæäº¤äº†äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®ï¼ˆæ•°æ®ä¸å‡†ç¡®ï¼‰ï¼›å¹»è¯»æ˜¯ä¸€ä¸ªæœªæäº¤äº‹åŠ¡è¯»å–åˆ°äº†å¦ä¸€ä¸ªæäº¤äº‹åŠ¡æ·»åŠ çš„æ•°æ®ã€‚</p>
<p>äº‹åŠ¡éœ€åœ¨è¶…æ—¶æ—¶é—´ timeout å†…è¿›è¡Œæäº¤ï¼Œå¦åˆ™å›æ»šï¼Œé»˜è®¤å€¼ -1ã€‚</p>
<p>æ˜¯å¦åªè¯» readOnly æŒ‡æ˜¯å¦å¯åœ¨æŸ¥è¯¢çš„åŸºç¡€ä¸Šè¿›è¡Œæ·»åŠ ä¿®æ”¹ï¼Œé»˜è®¤ä¸º falseã€‚</p>
<p>å›æ»š rollbackFor è®¾ç½®å‡ºç°å“ªäº›å¼‚å¸¸è¿›è¡Œäº‹åŠ¡å›æ»šï¼›ä¸å›æ»š noRollBackFor è®¾ç½®å‡ºç°å“ªäº›å¼‚å¸¸ä¸è¿›è¡Œäº‹åŠ¡å›æ»šã€‚</p>
<h3 id="xml-%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86">XML å£°æ˜å¼äº‹åŠ¡ç®¡ç†</h3>
<p>é…ç½®äº‹åŠ¡ç®¡ç†å™¨ï¼Œé…ç½®é€šçŸ¥ï¼Œé…ç½®åˆ‡å…¥ç‚¹ä¸åˆ‡é¢ã€‚</p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
                           http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd
                           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd
"&gt;
    &lt;!-- å¼€å¯ç»„ä»¶æ‰«æ --&gt;
    &lt;context:component-scan base-package="com.&lt;secret&gt;.spring5.txdemo"&gt;&lt;/context:component-scan&gt;
    &lt;!-- æ•°æ®åº“è¿æ¥æ±  --&gt;
    &lt;bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource" destroy-method="close"&gt;
        &lt;property name="url" value="jdbc:mysql://localhost:3306/user_db" /&gt;
        &lt;property name="username" value="&lt;username&gt;" /&gt;
        &lt;property name="password" value="&lt;password&gt;"/&gt;
        &lt;property name="driverClassName" value="com.mysql.cj.jdbc.Driver"/&gt;
    &lt;/bean&gt;
    &lt;!-- jdbctemplateå¯¹è±¡ --&gt;
    &lt;bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate"&gt;
        &lt;!-- æ³¨å…¥datasource --&gt;
        &lt;property name="dataSource" ref="dataSource"&gt;&lt;/property&gt;
    &lt;/bean&gt;
    &lt;!-- åˆ›å»ºäº‹åŠ¡ç®¡ç†å™¨ --&gt;
    &lt;bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;
        &lt;!-- æ³¨å…¥æ•°æ®æº =&gt; æŒ‡å®šå¯¹å“ªä¸ªæ•°æ®åº“è¿›è¡Œäº‹åŠ¡ç®¡ç† --&gt;
        &lt;property name="dataSource" ref="dataSource"&gt;&lt;/property&gt;
    &lt;/bean&gt;
    &lt;!-- é…ç½®é€šçŸ¥ --&gt;
    &lt;tx:advice id="txadvice"&gt;
        &lt;!-- é…ç½®äº‹åŠ¡ç›¸å…³å‚æ•° --&gt;
        &lt;tx:attributes&gt;
            &lt;!-- æŒ‡å®šå“ªç§è§„åˆ™çš„æ–¹æ³•ä¸Šæ·»åŠ äº‹åŠ¡ --&gt;
            &lt;!-- &lt;tx:method name="account*"/&gt; --&gt;
            &lt;tx:method name="accountMoney" propagation="REQUIRED"&gt;&lt;/tx:method&gt;
        &lt;/tx:attributes&gt;
    &lt;/tx:advice&gt;
    &lt;!-- é…ç½®åˆ‡å…¥ç‚¹å’Œåˆ‡é¢ --&gt;
    &lt;aop:config&gt;
        &lt;!-- é…ç½®åˆ‡å…¥ç‚¹ --&gt;
        &lt;aop:pointcut id="pt" expression="execution(* com.&lt;secret&gt;.spring5.txdemo.service.UserService.*(..))"/&gt;
        &lt;!-- é…ç½®åˆ‡é¢ =&gt; äº‹åŠ¡åŠ åˆ°å…·ä½“æ–¹æ³•ä¸Š --&gt;
        &lt;aop:advisor advice-ref="txadvice" pointcut-ref="pt"&gt;&lt;/aop:advisor&gt;
    &lt;/aop:config&gt;
&lt;/beans&gt;
</code></pre>
<h2 id="spring5-%E6%96%B0%E7%89%B9%E6%80%A7-%E5%85%B6%E4%BB%96">Spring5 æ–°ç‰¹æ€§ &amp; å…¶ä»–</h2>
<p>Spring5 æ¡†æ¶åŸºäº Java8 å®ç°ï¼Œè¿è¡Œæ—¶å…¼å®¹ JDK9ã€‚å…¶è‡ªå¸¦é€šç”¨æ—¥å¿—çš„å°è£…ï¼Œå·²ç§»é™¤ Log4jConfigListenerï¼Œå»ºè®®ä½¿ç”¨ Log4j2ã€‚</p>
<h3 id="log4j2">Log4j2</h3>
<ul>
<li>å¼•å…¥ jar åŒ…</li>
</ul>
<pre><code>log4j-api-2.11.2.jar
log4j-core-2.11.2.jar
log4j-slf4j-impl-2.11.2.jar
slf4j-api-1.7.30.jar
</code></pre>
<ul>
<li>åˆ›å»º Log4j2.xml é…ç½®æ–‡ä»¶</li>
</ul>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!--æ—¥å¿—çº§åˆ«ä»¥åŠä¼˜å…ˆçº§æ’åº: OFF &gt; FATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE &gt; ALL --&gt;
&lt;!--Configurationåé¢çš„statusç”¨äºè®¾ç½®log4j2è‡ªèº«å†…éƒ¨çš„ä¿¡æ¯è¾“å‡ºï¼Œå¯ä»¥ä¸è®¾ç½®ï¼Œå½“è®¾ç½®æˆtraceæ—¶ï¼Œå¯ä»¥çœ‹åˆ°log4j2å†…éƒ¨å„ç§è¯¦ç»†è¾“å‡º--&gt;
&lt;configuration status="DEBUG"&gt;
    &lt;!--å…ˆå®šä¹‰æ‰€æœ‰çš„appender--&gt;
    &lt;appenders&gt;
        &lt;!--è¾“å‡ºæ—¥å¿—ä¿¡æ¯åˆ°æ§åˆ¶å°--&gt;
        &lt;console name="Console" target="SYSTEM_OUT"&gt;
            &lt;!--æ§åˆ¶æ—¥å¿—è¾“å‡ºçš„æ ¼å¼--&gt;
            &lt;PatternLayout pattern="%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n"/&gt;
        &lt;/console&gt;
    &lt;/appenders&gt;
    &lt;!--ç„¶åå®šä¹‰loggerï¼Œåªæœ‰å®šä¹‰äº†loggerå¹¶å¼•å…¥çš„appenderï¼Œappenderæ‰ä¼šç”Ÿæ•ˆ--&gt;
    &lt;!--rootï¼šç”¨äºæŒ‡å®šé¡¹ç›®çš„æ ¹æ—¥å¿—ï¼Œå¦‚æœæ²¡æœ‰å•ç‹¬æŒ‡å®šLoggerï¼Œåˆ™ä¼šä½¿ç”¨rootä½œä¸ºé»˜è®¤çš„æ—¥å¿—è¾“å‡º--&gt;
    &lt;loggers&gt;
        &lt;root level="info"&gt;
            &lt;appender-ref ref="Console"/&gt;
        &lt;/root&gt;
    &lt;/loggers&gt;
&lt;/configuration&gt;
</code></pre>
<ul>
<li>æ‰‹åŠ¨è¾“å‡ºæ—¥å¿—</li>
</ul>
<pre><code class="language-java">public class UserLog {
    private static final Logger log = LoggerFactory.getLogger(UserLog.class);
    public static void main(String[] args) {
        log.info("hello log4j2");
        log.warn("hello log4j2");
    }
}
</code></pre>
<h3 id="nullable-%E6%B3%A8%E8%A7%A3">@Nullable æ³¨è§£</h3>
<p>@Nullable æ³¨è§£å¯ä»¥ä½¿ç”¨åœ¨æ–¹æ³•ã€å±æ€§ã€å‚æ•°ä¸Šï¼Œåˆ†åˆ«è¡¨ç¤ºæ–¹æ³•è¿”å›å¯ä»¥ä¸ºç©ºã€å±æ€§å€¼å¯ä»¥ä¸ºç©ºã€å‚æ•°å€¼å¯ä»¥ä¸ºç©ºï¼Œå¸¸ç”¨æ¥é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</p>
<h3 id="%E5%87%BD%E6%95%B0%E5%BC%8F%E9%A3%8E%E6%A0%BC">å‡½æ•°å¼é£æ ¼</h3>
<p>Spring5 åˆ›å»ºä¸€ä¸ªç±»çš„å¯¹è±¡å¯ä»¥ä½¿ç”¨æ³¨è§£æˆ–è€…é…ç½®æ–‡ä»¶ï¼Œè‹¥æ˜¯æ‰‹åŠ¨ new å¯¹è±¡è¿˜éœ€è¦åœ¨ Spring ä¸­è¿›è¡Œæ³¨å†Œã€‚æ–°ç‰¹æ€§æ”¯æŒå‡½æ•°å¼é£æ ¼åˆ›å»ºå¯¹è±¡ï¼Œäº¤ç»™ Spring ç®¡ç†ã€‚</p>
<pre><code class="language-java">public class GACACAC {
    @Test
    public void testGACAC(){
        // åˆ›å»º GenericApplicationContext
        GenericApplicationContext ctx = new GenericApplicationContext();
        // è°ƒç”¨contextæ–¹æ³•å¯¹è±¡æ³¨å†Œ
        ctx.refresh();
        // new å‡ºæ¥çš„å¯¹è±¡ä¼šåœ¨ spring5 å®Œæˆæ³¨å†Œ
        ctx.registerBean("personName",Person.class,()-&gt;new Person());
        // è·å–æ³¨å†Œçš„å¯¹è±¡
        // Person p = (Person)ctx.getBean("com.&lt;secret&gt;.spring5.txdemo.test.Person");
        Person p = (Person)ctx.getBean("personName");
        System.out.println(p);
    }
}
</code></pre>
<h3 id="%E6%95%B4%E5%90%88-junit45">æ•´åˆ JUnit4|5</h3>
<ul>
<li>å¼•å…¥ Spring é’ˆå¯¹æµ‹è¯•ä¾èµ–</li>
</ul>
<pre><code>spring-test-5.2.6.RELEASE.jar
</code></pre>
<ul>
<li>åˆ›å»ºæµ‹è¯•ç±»ï¼Œä½¿ç”¨æ³¨è§£æ–¹å¼å®Œæˆ</li>
</ul>
<pre><code class="language-java">// JUnit4
@RunWith(SpringJUnit4ClassRunner.class) // æŒ‡å®šå•å…ƒæµ‹è¯•æ¡†æ¶ç‰ˆæœ¬
@ContextConfiguration("classpath:xmlDeclarativeTxManager.xml") // åŠ è½½é…ç½®æ–‡ä»¶
public class JTest4 {
    @Autowired
    private UserService userService;
    @Test
    public void test1(){
        userService.accountMoney();
    }
}
// ---
// JUnit5
// éœ€å¼•å…¥ JUnit5 çš„ jar åŒ… =&gt; import org.junit.jupiter.api.Test;
// @ExtendWith(SpringExtension.class) // æ³¨è§£å¼•ç”¨
// @ContextConfiguration("classpath:xmlDeclarativeTxManager.xml")
@SpringJUnitConfig(locations = "classpath:xmlDeclarativeTxManager.xml") // å¤åˆæ³¨è§£
public class JTest5 {
    @Autowired
    private UserService userService;
    @Test
    public void test1(){
        userService.accountMoney();
    }
}
</code></pre>
<h3 id="jdbctemplate">JdbcTemplate</h3>
<p>Spring å°è£… Template å½¢å¼çš„æ¨¡æ¿ç±»ï¼Œä¾¿äºæ“ä½œ Redisã€Mysql ç­‰æ•°æ®åº“ã€‚Service é€šå¸¸å­˜æ”¾ä¸šåŠ¡æ“ä½œï¼Œdao åˆ™å­˜æ”¾æ•°æ®åº“æ“ä½œï¼Œä¸å†™ä¸šåŠ¡ã€‚service æ³¨å…¥ daoï¼Œdao æ³¨å…¥ jdbctemplateï¼Œjdbctemplate æ³¨å…¥ DataSourceã€‚</p>
<pre><code class="language-java">druid-1.1.9.jar
mysql-connector-java-8.0.29.jar
spring-jdbc-5.2.6.RELEASE-sources.jar
spring-tx-5.2.6.RELEASE-sources.jar
spring-orm-5.2.6.RELEASE.jar // æ•´åˆå…¶ä»–æ¡†æ¶ mybatis hibernate
</code></pre>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"&gt;
    &lt;!-- å¼€å¯ç»„ä»¶æ‰«æ --&gt;
    &lt;context:component-scan base-package="com.&lt;secret&gt;.spring5"&gt;&lt;/context:component-scan&gt;
    &lt;!-- æ•°æ®åº“è¿æ¥æ±  --&gt;
    &lt;bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource" destroy-method="close"&gt;
        &lt;property name="url" value="jdbc:mysql://localhost:3306/user_db" /&gt;
        &lt;property name="username" value="&lt;username&gt;" /&gt;
        &lt;property name="password" value="&lt;password&gt;"/&gt;
        &lt;property name="driverClassName" value="com.mysql.cj.jdbc.Driver"/&gt;
    &lt;/bean&gt;
    &lt;!-- jdbctemplateå¯¹è±¡ --&gt;
    &lt;bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate"&gt;
        &lt;!-- æ³¨å…¥datasource =&gt; set æ–¹æ³•æ³¨å…¥ --&gt;
        &lt;property name="dataSource" ref="dataSource"&gt;&lt;/property&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre>
<pre><code class="language-java">public class Book {
    private String userId;
    private String username;
    private String ustatus;
    @Override
    public String toString() {...}
    &lt;GETTER...&gt;
    &lt;SETTER...&gt;
}
</code></pre>
<pre><code class="language-java">@Service
public class BookService {
    // æ³¨å…¥DAO
    @Autowired
    private BookDao bookDao;
    // æ·»åŠ æ–¹æ³•
    public void addBook(Book book){ bookDao.add(book); }
    // ä¿®æ”¹æ–¹æ³•
    public void updateBook(Book book){bookDao.updateBook(book); }
    // åˆ é™¤æ–¹æ³•
    public void deleteBook(String id){ bookDao.deleteBook(id); }
    // æŸ¥è¯¢è¡¨è®°å½•æ•°
    public int findCount(){ return bookDao.selectCount(); }
    // æŸ¥è¯¢è¡¨è®°å½•
    public Book findOne(String id){ return bookDao.findBookInfo(id); }
    // æŸ¥è¯¢è¿”å›é›†åˆ
    public List&lt;Book&gt; findAll(){ return bookDao.findAllBook(); }
    // æ‰¹é‡æ·»åŠ 
    public void batchAdd(List&lt;Object[]&gt; batchArgs){ bookDao.batchAddBook(batchArgs); }
    // æ‰¹é‡ä¿®æ”¹
    public void batchUpdate(List&lt;Object[]&gt; batchArgs){ bookDao.batchUpdateBook(batchArgs); }
    // æ‰¹é‡åˆ é™¤
    public void batchDelete(List&lt;Object[]&gt; batchArgs){ bookDao.batchDeleteBook(batchArgs); }
}
</code></pre>
<pre><code class="language-java">public interface BookDao {
    // æ·»åŠ çš„æ–¹æ³•
    void add(Book book);
    void updateBook(Book book);
    void deleteBook(String id);
    int selectCount();
    Book findBookInfo(String id);
    List&lt;Book&gt; findAllBook();
    void batchAddBook(List&lt;Object[]&gt; batchArgs);
    void batchUpdateBook(List&lt;Object[]&gt; batchArgs);
    void batchDeleteBook(List&lt;Object[]&gt; batchArgs);
}
</code></pre>
<pre><code class="language-java">@Repository
public class BookDaoImpl implements BookDao{
    // æ³¨å…¥JDBC
    @Autowired
    private JdbcTemplate jdbcTemplate;

    @Override
    public void add(Book book) {
        // è°ƒç”¨jdbc templateä¸­çš„updateæ–¹æ³•å®ç°æ·»åŠ æ“ä½œ
        String sql = "INSERT INTO t_book VALUES(?,?,?)";
        Object[] args = {book.getUserId(), book.getUsername(), book.getUstatus()};
        int update = jdbcTemplate.update(sql,args);
        System.out.println(update);
    }

    @Override
    public void updateBook(Book book) {
        String sql = "UPDATE t_book SET username=?,ustatus=? WHERE user_id=?";
        Object[] args = {book.getUsername(), book.getUstatus(),book.getUserId()};
        int update = jdbcTemplate.update(sql,args);
        System.out.println(update);
    }

    @Override
    public void deleteBook(String id) {
        String sql = "DELETE FROM t_book WHERE user_id = ?";
        int update = jdbcTemplate.update(sql, id);
        System.out.println(update);
    }

    // æŸ¥è¯¢è¡¨ä¸­çš„è®°å½•æ•°
    @Override
    public int selectCount() {
        String sql = "SELECT COUNT(*) FROM t_book";
        Integer count = jdbcTemplate.queryForObject(sql, Integer.class);
        return count;
    }

    @Override
    public Book findBookInfo(String id) {
        String sql = "SELECT * FROM t_book WHERE user_id=?";
        // RowMapperæ˜¯ä¸åŒç±»å‹çš„æ¥å£,ä½¿ç”¨æ­¤æ¥å£å®ç°ç±»å®Œæˆæ•°æ®çš„å°è£…
        Book book = jdbcTemplate.queryForObject(sql, new BeanPropertyRowMapper&lt;Book&gt;(Book.class), id);
        return book;
    }

    @Override
    public List&lt;Book&gt; findAllBook() {
        String sql = "SELECT * FROM t_book";
        List&lt;Book&gt; list = jdbcTemplate.query(sql, new BeanPropertyRowMapper&lt;Book&gt;(Book.class));
        return list;
    }

    @Override
    public void batchAddBook(List&lt;Object[]&gt; batchArgs) {
        String sql = "INSERT INTO t_book VALUES(?,?,?)";
        int[] ints = jdbcTemplate.batchUpdate(sql,batchArgs);
        System.out.println(Arrays.toString(ints));
    }

    @Override
    public void batchUpdateBook(List&lt;Object[]&gt; batchArgs) {
        String sql = "UPDATE t_book SET username=?,ustatus=? WHERE user_id=?";
        int[] ints = jdbcTemplate.batchUpdate(sql, batchArgs);
        System.out.println(ints);
    }

    @Override
    public void batchDeleteBook(List&lt;Object[]&gt; batchArgs) {
        String sql = "DELETE FROM t_book WHERE user_id = ?";
        int[] ints = jdbcTemplate.batchUpdate(sql, batchArgs);
        System.out.println(Arrays.toString(ints));
    }
}
</code></pre>
<pre><code class="language-java">public class TestBook {
    @Test
    public void testAdd(){
        ApplicationContext context = new ClassPathXmlApplicationContext("jdbcTemp1.xml");
        BookService bookService = context.getBean("bookService", BookService.class);
        // æ·»åŠ 
        Book book = new Book();
        book.setUserId("1");
        book.setUsername("java");
        book.setUstatus("a");
        bookService.addBook(book);
    }
    @Test
    public void testUpdate(){
        ApplicationContext context = new ClassPathXmlApplicationContext("jdbcTemp1.xml");
        BookService bookService = context.getBean("bookService", BookService.class);
        // ä¿®æ”¹
        Book book = new Book();
        book.setUserId("1");
        book.setUsername("java");
        book.setUstatus("zs");
        bookService.updateBook(book);
    }
    @Test
    public void testDel(){
        ApplicationContext context = new ClassPathXmlApplicationContext("jdbcTemp1.xml");
        BookService bookService = context.getBean("bookService", BookService.class);
        // åˆ é™¤
        bookService.deleteBook("1");
    }
    @Test
    public void testFindCount(){
        ApplicationContext context = new ClassPathXmlApplicationContext("jdbcTemp1.xml");
        BookService bookService = context.getBean("bookService", BookService.class);
        // åˆ é™¤
        int count = bookService.findCount();
        System.out.println(count);
        System.out.println(count);
    }
    // æµ‹è¯•æŸ¥è¯¢è¿”å›å¯¹è±¡
    @Test
    public void testFindOne(){
        ApplicationContext context = new ClassPathXmlApplicationContext("jdbcTemp1.xml");
        BookService bookService = context.getBean("bookService", BookService.class);
        Book one = bookService.findOne("1");
        System.out.println(one);
    }

    @Test
    public void testfindAllBook(){
        ApplicationContext context = new ClassPathXmlApplicationContext("jdbcTemp1.xml");
        BookService bookService = context.getBean("bookService", BookService.class);
        List&lt;Book&gt; all = bookService.findAll();
        System.out.println(all);
    }
    @Test
    public void testAddBatchBooks(){
        ApplicationContext context = new ClassPathXmlApplicationContext("jdbcTemp1.xml");
        BookService bookService = context.getBean("bookService", BookService.class);
        List&lt;Object[]&gt; batchArgs = new ArrayList&lt;&gt;();
        Object[] o1 = {"2","javascript","ok"};
        Object[] o2 = {"3","nodejs","okk"};
        Object[] o3 = {"4","C++","okkk"};
        batchArgs.add(o1);
        batchArgs.add(o2);
        batchArgs.add(o3);
        bookService.batchAdd(batchArgs);
    }
    @Test
    public void testUpdateBatchBooks(){
        ApplicationContext context = new ClassPathXmlApplicationContext("jdbcTemp1.xml");
        BookService bookService = context.getBean("bookService", BookService.class);
        List&lt;Object[]&gt; batchArgs = new ArrayList&lt;&gt;();
        Object[] o1 = {"javascript","yes","2"};
        Object[] o2 = {"nodejs","ok","3"};
        Object[] o3 = {"C++","okk","4"};
        batchArgs.add(o1);
        batchArgs.add(o2);
        batchArgs.add(o3);
        bookService.batchUpdate(batchArgs);
    }
    @Test
    public void testDeleteBatchBooks(){
        ApplicationContext context = new ClassPathXmlApplicationContext("jdbcTemp1.xml");
        BookService bookService = context.getBean("bookService", BookService.class);
        List&lt;Object[]&gt; batchArgs = new ArrayList&lt;&gt;();
        Object[] o1 = {"4"};
        batchArgs.add(o1);
        bookService.batchDelete(batchArgs);
    }
}
</code></pre>
<h2 id="bugs-%E8%A7%A3%E5%86%B3">Bugs è§£å†³</h2>
<ul>
<li>BeanDefinitionStoreException</li>
</ul>
<pre><code class="language-java">// æŠ¥é”™åŸæ–‡
org.springframework.beans.factory.BeanDefinitionStoreException: Unexpected exception parsing XML document from class path resource.
</code></pre>
<p>åœ¨å¼€å¯ç»„ä»¶æ‰«æçš„ base-package ä¸‹ï¼Œæ˜¯å¦å­˜åœ¨å¤šä¸ªéœ€è¦æ‰«æçš„æ–‡ä»¶ã€‚è‹¥å­˜åœ¨åˆ™éœ€è¦è¿›ä¸€æ­¥ç¼©å°æ‰«æèŒƒå›´ã€‚</p>
<ul>
<li>Exception encountered during context initialization</li>
</ul>
<pre><code class="language-java">// æŠ¥é”™åŸæ–‡
WARNING: Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'xxxService': Unsatisfied dependency expressed through field 'xxxDao';
</code></pre>
<p>åœ¨æµ‹è¯•ç±»ä¸­è¿›è¡Œè¿›ä¸€æ­¥éªŒè¯ï¼›æ¦‚ç‡æ€§åŠ è½½ xml æ–‡ä»¶é”™è¯¯ã€‚</p>
<ul>
<li>UnsatisfiedDependencyException</li>
</ul>
<pre><code class="language-java">org.springframework.context.support.AbstractApplicationContext refresh
WARNING: Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userDaoImpl': Unsatisfied dependency expressed through field 'jdbcTemplate'; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'getJdbcTemplate' defined in com.&lt;secret&gt;.spring5.txdemo.config.TxConfig: Unsatisfied dependency expressed through method 'getJdbcTemplate' parameter 0; nested exception is org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'javax.sql.DataSource' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
</code></pre>
<h2 id="%E7%BB%93%E6%9D%9F">ç»“æŸ</h2>
<p>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨<a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh"> CC BY-SA 4.0 </a>åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>


            </section>

        </article>
    </main>
    <footer class="page-footer">
            <amp-img class="site-icon" src="yourdomain.com/content/images/2021/07/ghost-orb.png" width="50" height="50" layout="fixed" alt="zairesinatra"></amp-img>
        <h3>zairesinatra</h3>
            <p>The best time to recognize yourself is ten years ago, followed by now.</p>
        <p><a href="../../index.html">Read more posts â†’</a></p>
        <a class="powered" href="https://ghost.org" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 156 156"><g fill="none" fill-rule="evenodd"><rect fill="#15212B" width="156" height="156" rx="27"/><g transform="translate(36 36)" fill="#F6F8FA"><path d="M0 71.007A4.004 4.004 0 014 67h26a4 4 0 014 4.007v8.986A4.004 4.004 0 0130 84H4a4 4 0 01-4-4.007v-8.986zM50 71.007A4.004 4.004 0 0154 67h26a4 4 0 014 4.007v8.986A4.004 4.004 0 0180 84H54a4 4 0 01-4-4.007v-8.986z"/><rect y="34" width="84" height="17" rx="4"/><path d="M0 4.007A4.007 4.007 0 014.007 0h41.986A4.003 4.003 0 0150 4.007v8.986A4.007 4.007 0 0145.993 17H4.007A4.003 4.003 0 010 12.993V4.007z"/><rect x="67" width="17" height="17" rx="4"/></g></g></svg> Published with Ghost</a>
    </footer>
    
</body>
</html>
