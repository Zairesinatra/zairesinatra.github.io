<!DOCTYPE html>
<html lang="en">
<head>

    <title>Spring5</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="../assets/built/screen.css%3Fv=69401cbc3d.css" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.18.2/tocbot.css">
    <link rel="stylesheet" type="text/css" href="../assets/css/screen.css%3Fv=69401cbc3d.css" />
    <meta name="description" content="Java Spring5 æ¡†æ¶" />
    <link rel="icon" href="../content/images/size/w256h256/2021/07/ghost-orb.png" type="image/png" />
    <link rel="canonical" href="index.html" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="amp/index.html" />
    
    <meta property="og:site_name" content="zairesinatra" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Spring5" />
    <meta property="og:description" content="Java Spring5 æ¡†æ¶" />
    <meta property="og:url" content="yourdomain.com/spring5/" />
    <meta property="og:image" content="yourdomain.com/content/images/2022/05/GreyWhiteClouds.JPG" />
    <meta property="article:published_time" content="2020-05-25T12:20:00.000Z" />
    <meta property="article:modified_time" content="2022-12-26T15:58:32.000Z" />
    <meta property="article:tag" content="Technology growth" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Spring5" />
    <meta name="twitter:description" content="Java Spring5 æ¡†æ¶" />
    <meta name="twitter:url" content="yourdomain.com/spring5/" />
    <meta name="twitter:image" content="yourdomain.com/content/images/2022/05/GreyWhiteClouds.JPG" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Ziyi Xie" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Technology growth" />
    <meta name="twitter:site" content="@xieziyi0422" />
    <meta property="og:image:width" content="2000" />
    <meta property="og:image:height" content="1125" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "zairesinatra",
        "url": "yourdomain.com/",
        "logo": {
            "@type": "ImageObject",
            "url": "yourdomain.com/content/images/2021/07/zs-1.JPG",
            "width": 60,
            "height": 60
        }
    },
    "author": {
        "@type": "Person",
        "name": "Ziyi Xie",
        "image": {
            "@type": "ImageObject",
            "url": "yourdomain.com/content/images/2021/07/zs-2.JPG",
            "width": 1079,
            "height": 1079
        },
        "url": "yourdomain.com/author/ziyi/",
        "sameAs": []
    },
    "headline": "Spring5",
    "url": "yourdomain.com/spring5/",
    "datePublished": "2020-05-25T12:20:00.000Z",
    "dateModified": "2022-12-26T15:58:32.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "yourdomain.com/content/images/2022/05/GreyWhiteClouds.JPG",
        "width": 2000,
        "height": 1125
    },
    "keywords": "Technology growth",
    "description": "Java Spring5 æ¡†æ¶",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "yourdomain.com/"
    }
}
    </script>

    <meta name="generator" content="Ghost 5.25" />
    <link rel="alternate" type="application/rss+xml" title="zairesinatra" href="../rss/index.html" />
    <script defer src="https://cdn.jsdelivr.net/ghost/portal@~2.20/umd/portal.min.js" data-ghost="yourdomain.com/" data-key="f5d74add11f1d16d3e59c12945" data-api="yourdomain.com/ghost/api/content/" crossorigin="anonymous"></script><style id="gh-members-styles">.gh-post-upgrade-cta-content,
.gh-post-upgrade-cta {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    text-align: center;
    width: 100%;
    color: #ffffff;
    font-size: 16px;
}

.gh-post-upgrade-cta-content {
    border-radius: 8px;
    padding: 40px 4vw;
}

.gh-post-upgrade-cta h2 {
    color: #ffffff;
    font-size: 28px;
    letter-spacing: -0.2px;
    margin: 0;
    padding: 0;
}

.gh-post-upgrade-cta p {
    margin: 20px 0 0;
    padding: 0;
}

.gh-post-upgrade-cta small {
    font-size: 16px;
    letter-spacing: -0.2px;
}

.gh-post-upgrade-cta a {
    color: #ffffff;
    cursor: pointer;
    font-weight: 500;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a:hover {
    color: #ffffff;
    opacity: 0.8;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a.gh-btn {
    display: block;
    background: #ffffff;
    text-decoration: none;
    margin: 28px 0 0;
    padding: 8px 18px;
    border-radius: 4px;
    font-size: 16px;
    font-weight: 600;
}

.gh-post-upgrade-cta a.gh-btn:hover {
    opacity: 0.92;
}</style>
    <script defer src="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/sodo-search.min.js" data-key="f5d74add11f1d16d3e59c12945" data-styles="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/main.css" data-sodo-search="yourdomain.com/" crossorigin="anonymous"></script>
    <script defer src="../public/cards.min.js%3Fv=69401cbc3d"></script>
    <link rel="stylesheet" type="text/css" href="../public/cards.min.css%3Fv=69401cbc3d.css">
    <script defer src="../public/member-attribution.min.js%3Fv=69401cbc3d"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Q4HQV7NBSG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'G-Q4HQV7NBSG');
</script>

<!-- 2022 prismjs update -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/themes/prism-tomorrow.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/toolbar/prism-toolbar.min.css" rel="stylesheet">

<script>
window.addEventListener('DOMContentLoaded', (event) => {      
    document.querySelectorAll('pre[class*=language-]').forEach(function(node) {
        node.classList.add('line-numbers');
	});
    Prism.highlightAll();
});
</script>

<!-- prism -->
<style>
pre[class*="language-"] {
    margin: 0 0 1.5em !important;
}
pre[class*="line-numbers"]>code {
    padding: 0 ;
}
code {
    text-shadow: none !important;
}
.token.operator {
    background: none !important;
}

:not(pre)>code[class*="language-"],
pre[class*="language-"] {
    background: #202124 !important;
}
</style>

<!-- customer theme by zs -->
<style>
/* Generated with http://k88hudson.github.io/syntax-highlighting-theme-generator/www */
/* http://k88hudson.github.io/react-markdocs */
/**
 * @author k88hudson
 *
 * Based on prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */
/*********************************************************
* General
*/
/* Generated with http://k88hudson.github.io/syntax-highlighting-theme-generator/www */
/* http://k88hudson.github.io/react-markdocs */
/**
 * @author k88hudson
 *
 * Based on prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */
/*********************************************************
* General
*/
pre[class*="language-"],
code[class*="language-"] {
  color: #b0bec5;
  font-size: 13px;
  text-shadow: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  direction: ltr;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  line-height: 1.5;
  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;
  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}
pre[class*="language-"]::selection,
code[class*="language-"]::selection,
pre[class*="language-"]::mozselection,
code[class*="language-"]::mozselection {
  text-shadow: none;
  background: #b3d4fc;
}
@media print {
  pre[class*="language-"],
  code[class*="language-"] {
    text-shadow: none;
  }
}
pre[class*="language-"] {
  padding: 1em;
  margin: .5em 0;
  overflow: auto;
  background: #202124;
}
:not(pre) > code[class*="language-"] {
  padding: .1em .3em;
  border-radius: .3em;
  color: #db4c69;
  background: #f9f2f4;
}
/*********************************************************
* Tokens
*/
.namespace {
  opacity: .7;
}
.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
  color: #93a1a1;
}
.token.punctuation {
  color: #f3f3f3;
}
.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
  color: #88deff;
}
.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
  color: #e3f2fd;
}
.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
  color: #f3f3f3;
  background: #202124;
}
.token.atrule,
.token.attr-value,
.token.keyword {
  color: #06b4fe;
}
.token.function {
  color: #ff7043;
}
.token.regex,
.token.important,
.token.variable {
  color: #ff7043;
}
.token.important,
.token.bold {
  font-weight: bold;
}
.token.italic {
  font-style: italic;
}
.token.entity {
  cursor: help;
}
/*********************************************************
* Line highlighting
*/
pre[data-line] {
  position: relative;
}
pre[class*="language-"] > code[class*="language-"] {
  position: relative;
  z-index: 1;
}
.line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: #202124;
  box-shadow: inset 5px 0 0 #202124;
  z-index: 0;
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}
</style>

<!-- éŸ³ä¹æ’­æ”¾å™¨ -->
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><style>:root {--ghost-accent-color: #15171A;}</style>

</head>
<body class="post-template tag-technology-growth is-head-left-logo has-cover">
<div class="viewport">

    <header id="gh-head" class="gh-head outer">
        <div class="gh-head-inner inner">
            <div class="gh-head-brand">
                <a class="gh-head-logo" href="../index.html">
                        <img src="../content/images/2021/07/zs-1.JPG" alt="zairesinatra">
                </a>
                <button class="gh-search gh-icon-btn" data-ghost-search><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button>
                <button class="gh-burger"></button>
            </div>

            <nav class="gh-head-menu">
                <ul class="nav">
    <li class="nav-home"><a href="../index.html">Home</a></li>
    <li class="nav-welcome"><a href="../welcome/index.html">Welcome</a></li>
    <li class="nav-author"><a href="../selfintro/index.html">Author</a></li>
    <li class="nav-tags"><a href="../tags/index.html">Tags</a></li>
    <li class="nav-search"><a href="../index.html#searchinghost-easy">Search</a></li>
</ul>

            </nav>

            <div class="gh-head-actions">
                    <button class="gh-search gh-icon-btn" data-ghost-search><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button>
                            <a class="gh-head-button" href="index.html#/portal/signup" data-portal="signup">Subscribe</a>
            </div>
        </div>
    </header>

    <div class="site-content">
        



<main id="site-main" class="site-main">
<article class="article post tag-technology-growth ">

    <header class="article-header gh-canvas">

        <div class="article-tag post-card-tags">
                <span class="post-card-primary-tag">
                    <a href="../tag/technology-growth/index.html">Technology growth</a>
                </span>
        </div>

        <h1 class="article-title">Spring5</h1>

            <p class="article-excerpt">Java Spring5 æ¡†æ¶</p>

        <div class="article-byline">
        <section class="article-byline-content">

            <ul class="author-list">
                <li class="author-list-item">
                    <a href="../author/ziyi/index.html" class="author-avatar">
                        <img class="author-profile-image" src="../content/images/size/w100/2021/07/zs-2.JPG" alt="Ziyi Xie" />
                    </a>
                </li>
            </ul>

            <div class="article-byline-meta">
                <h4 class="author-name"><a href="../author/ziyi/index.html">Ziyi Xie</a></h4>
                <div class="byline-meta-content">
                    <time class="byline-meta-date" datetime="2020-05-25">May 25, 2020</time>
                        <span class="byline-reading-time"><span class="bull">&bull;</span> 40 min read</span>
                </div>
            </div>

        </section>
        </div>

            <figure class="article-image">
                <img
                    srcset="../content/images/size/w2000/2022/05/GreyWhiteClouds.JPG 2000w"
                    sizes="(min-width: 1400px) 1400px, 92vw"
                    src="../content/images/size/w2000/2022/05/GreyWhiteClouds.JPG"
                    alt="GreyWhiteClouds"
                />
                    <figcaption>GreyWhiteClouds</figcaption>
            </figure>

    </header>

    <section class="gh-content gh-canvas">
        <aside class="toc-container">
            <div class="toc"></div>
        </aside>
        <!--kg-card-begin: markdown--><h2 id="%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B">å¿«é€Ÿä¸Šæ‰‹</h2>
<h3 id="core-concepts">Core Concepts</h3>
<p><img src="https://res.cloudinary.com/dzb9ldnvl/image/upload/v1671815139/BackendDev/Spring/SpringFrameworkRuntime.png" alt="" loading="lazy"></p>
<p>(IOC) Inversion of Control æ§åˆ¶åè½¬çš„æ€æƒ³æ˜¯å°†å¯¹è±¡çš„åˆ›å»ºæƒç§»äº¤å¤–éƒ¨ï¼Œé¿å…å‡ºç°ä¸šåŠ¡å±‚ service ä¸æ•°æ®å±‚ dao æœ‰å¼ºè€¦åˆçš„æƒ…å†µã€‚</p>
<pre><code class="language-java">// å¼ºè€¦åˆ
public class XxxServiceImpl implements XxxService {
    private XxxDao xxxDao = new XxxDaoImpl();
    public void yyy(){
        xxxDao.yyy();
    }
}
// è§£è€¦
public class XxxServiceImpl implements XxxService {
    private XxxDao xxxDao; // å¯¹è±¡åˆ›å»ºæ§åˆ¶æƒç§»äº¤å¤–éƒ¨
    public void yyy(){
        xxxDao.yyy();
    }
}
</code></pre>
<pre><code class="language-java">public class XxxDaoImpl implements XxxDao {
    public void yyy() {
        System.out.println(&quot;xxx dao yyy&quot;);
    }
}
</code></pre>
<p>Spring æŠ€æœ¯å¯¹ IoC æ€æƒ³çš„å®ç°ï¼š</p>
<ol>
<li>Spring æä¾›ä¸€ä¸ªç”¨äºå……å½“â€œå¤–éƒ¨â€çš„ IoC å®¹å™¨</li>
<li>ä»ä¸»åŠ¨ new å‡ºå¯¹è±¡è½¬æ¢è‡³ç”±â€œå¤–éƒ¨â€æä¾›å¯¹è±¡</li>
<li>è¢« IoC å®¹å™¨æ¥ç®¡åˆ›å»ºä¸åˆå§‹åŒ–è¿‡ç¨‹çš„å¯¹è±¡å«åš Bean</li>
</ol>
<blockquote>
<p>Beans're special type of Pojos. There're some restrictions on POJO to be a bean.</p>
</blockquote>
<ul>
<li>POJO:
<ul>
<li>ä¸ç»§æ‰¿ä»»ä½•ç±»</li>
<li>ä¸å®ç°ä»»ä½•æ¥å£</li>
<li>ä¸åŒ…å«æ³¨è§£</li>
</ul>
</li>
<li>Beans:
<ul>
<li>ä¸å¯ä»¥é€šè¿‡åç§°è®¿é—®å­—æ®µï¼Œä»…èƒ½ä½¿ç”¨ getters å’Œ setters</li>
<li>ä¸€å®šå®ç° serializable æ¥å£ï¼Œæ˜¯å¯åºåˆ—åŒ–çš„ç±»</li>
<li>æ‰€æœ‰å­—æ®µéƒ½æ˜¯ç§æœ‰è®¿é—®ç±»å‹ private</li>
<li>ä¸€å®šå­˜åœ¨æ— å‚æ„é€ å‡½æ•°</li>
</ul>
</li>
</ul>
<p>åœ¨ IoC å®¹å™¨ä¸­å»ºç«‹ä¸åŒ Bean ä¹‹é—´ä¾èµ–å…³ç³»çš„è¿‡ç¨‹ç§°ä¸º (DI) Dependency Injection ä¾èµ–æ³¨å…¥ã€‚</p>
<p>ç”±äº service ä¸ dao éƒ½åŒåœ¨ IoCï¼Œé‚£ä¹ˆä¾èµ–æ³¨å…¥ç†æ‰€å½“ç„¶çš„å¯ä»¥è§£å†³ service è¿è¡Œæ—¶éœ€è¦ä¾èµ– dao çš„é—®é¢˜ã€‚</p>
<p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans">Spring</a> ä¸­ IoC å®¹å™¨çš„ä¸¤ç§è·å–æ–¹å¼ï¼šBeanFactory å’Œ ApplicationContext æ¥å£ã€‚</p>
<blockquote>
<p>The org.springframework.beans and org.springframework.context packages are the basis for Spring Frameworkâ€™s IoC container. The BeanFactory interface provides an advanced configuration mechanism capable of managing any type of object. ApplicationContext is a sub-interface of BeanFactory.</p>
</blockquote>
<blockquote>
<p>The org.springframework.context.ApplicationContext interface represents the Spring IoC container and is responsible for instantiating, configuring, and assembling the beans.</p>
</blockquote>
<blockquote>
<p>Several implementations of the ApplicationContext interface are supplied with Spring. In stand-alone applications, it is common to create an instance of ClassPathXmlApplicationContext or FileSystemXmlApplicationContext.</p>
</blockquote>
<h3 id="ioc-container-beans">IoC Container &amp; Beans</h3>
<p>åœ¨å¯¼å…¥ Spring åæ ‡å¹¶å®šä¹‰ Spring ç®¡ç†çš„ç±»åï¼Œåœ¨ resources ç›®å½•åˆ›å»º Spring é…ç½®æ–‡ä»¶ï¼Œé…ç½®å¯¹åº”ç±»ä½œä¸º Spring ç®¡ç†çš„ beanã€‚</p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
    &lt;version&gt;5.2.10.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<pre><code class="language-java">// ç»„ä»¶ç±»
public class HelloComponent { public void HelloMethod() { System.out.println(&quot;hello component...&quot;); } }
</code></pre>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;
    &lt;bean id=&quot;helloComponent&quot; class=&quot;com.xxx.HelloComponent&quot;&gt;&lt;/bean&gt;
    &lt;bean id=&quot;...&quot; class=&quot;...&quot;&gt;
        &lt;!-- collaborators and configuration for this bean go here --&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre>
<p>id attribute æŒ‡å®š bean çš„å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºç²¾ç¡®è·å–åˆ°ç»„ä»¶å¯¹è±¡ã€‚</p>
<p>class attribute é€šè¿‡å…¨ç±»åçš„å½¢å¼å®šä¹‰ bean çš„ç±»å‹ã€‚</p>
<pre><code class="language-java">// æµ‹è¯•ç±»
public class IOCTest {
    // åˆ›å»º IOC å®¹å™¨å¯¹è±¡
    private ApplicationContext iocContainer = new ClassPathXmlApplicationContext(&quot;helloComponent.xml&quot;);
    @Test
    public void testExperiment01() {
        // æ ¹æ® id ä» IoC å®¹å™¨å¯¹è±¡é‡Œè·å– bean =&gt; ç»„ä»¶å¯¹è±¡
        HelloComponent helloComponent = (helloComponent) iocContainer.getBean(&quot;helloComponent&quot;);
        helloComponent.HelloMethod();
    }
}
</code></pre>
<h3 id="bean-%E4%BD%9C%E7%94%A8%E5%9F%9F">Bean ä½œç”¨åŸŸ</h3>
<p>SF å…±æ”¯æŒå…­ä¸ªä½œç”¨åŸŸï¼Œå…¶ä¸­å››ä¸ªä»…åœ¨ web-aware ApplicationContext æ—¶å¯ä½¿ç”¨ã€‚</p>
<p>Bean ä½œç”¨åŸŸå°±æ˜¯é…ç½®åˆ›å»º Bean å®ä¾‹æ˜¯ prototype è¿˜æ˜¯ singletonã€‚é»˜è®¤å•ä¾‹ã€‚</p>
<p>&lt;bean /&gt; çš„ scope å±æ€§è®¾ç½®ä¸º singleton æˆ– prototype åˆ†åˆ«è¡¨ç¤ºå•å®ä¾‹æˆ–å¤šå®ä¾‹ã€‚</p>
<p>å•å®ä¾‹å¯¹è±¡åœ¨åŠ è½½é…ç½®æ–‡ä»¶çš„è¿‡ç¨‹ä¸­åˆ›å»ºï¼Œå¤šå®ä¾‹å¯¹è±¡åˆ›å»ºåœ¨è°ƒç”¨ getBean åã€‚</p>
<p>ä»é»˜è®¤åˆ›å»ºå•ä¾‹ bean å¯ä»¥çœ‹å‡º Spring æ›´å¤šçš„æ˜¯ç®¡ç†å¯å¤ç”¨çš„å¯¹è±¡ï¼Œå¦‚ï¼šservletã€serviceã€dao layer objects å’Œå·¥å…·å¯¹è±¡ã€‚å°è£…å®ä½“çš„åŸŸå¯¹è±¡ä¸é€‚åˆï¼ˆæœ‰çŠ¶æ€ï¼‰ã€‚</p>
<pre><code class="language-xml">&lt;!--&lt;bean id=&quot;myBean&quot; class=&quot;com.&lt;secret&gt;.spring5.factorybean.MyBean&quot;&gt;&lt;/bean&gt;--&gt;
&lt;bean id=&quot;myBean&quot; class=&quot;com.&lt;secret&gt;.spring5.factorybean.MyBean&quot; scope=&quot;singleton&quot;&gt;&lt;/bean&gt;
</code></pre>
<pre><code class="language-java">@Test
public void testFBean(){
    ApplicationContext context = new ClassPathXmlApplicationContext(&quot;bean7.xml&quot;);
    MyBean myBean = context.getBean(&quot;myBean&quot;, MyBean.class);
    MyBean myBean1 = context.getBean(&quot;myBean&quot;, MyBean.class);
    System.out.println(myBean); // com.&lt;secret&gt;.spring5.factorybean.MyBean@42d8062c
    System.out.println(myBean1); // com.&lt;secret&gt;.spring5.factorybean.MyBean@42d8062c 
}
</code></pre>
<h3 id="instantiating-beans">Instantiating Beans</h3>
<p><strong>å®ä¾‹åŒ– Beanï¼š</strong></p>
<ul>
<li>é€šå¸¸ Spring æ˜¯åœ¨å®¹å™¨æœ¬èº«é€šè¿‡åå°„è°ƒç”¨æ— å‚æ„é€ å‡½æ•°ç›´æ¥åˆ›å»º bean</li>
<li>å®¹å™¨è°ƒç”¨ static factory method é™æ€å·¥å‚æ–¹æ³•æ¥åˆ›å»º bean</li>
<li>å®¹å™¨è°ƒç”¨å®ä¾‹å·¥å‚åˆ›å»º beanï¼ˆéé™æ€ =&gt; éœ€è¦å…ˆ new å‡ºå·¥å‚å¯¹è±¡ï¼‰</li>
</ul>
<p>(Instantiation with a Constructor) æ„é€ å‡½æ•°æ–¹æ³•åˆ›å»º beanï¼š</p>
<ul>
<li>åº”æä¾›ä¸€ä¸ªæ— å‚æ„é€ å‡½æ•°ï¼ˆä¸å†™ä¹Ÿå¯ä»¥ï¼‰</li>
<li>å¦‚æœæ— å‚æ„é€ æ–¹æ³•ä¸æä¾›ï¼Œå®ä¾‹åŒ– Bean ä¼šæŠ›å‡º beanCreationException</li>
</ul>
<pre><code class="language-java">public class XxxDaoImpl implements XxxDao {
    public void yyy() { ... }
}
</code></pre>
<pre><code class="language-xml">&lt;bean id=&quot;xxxDao&quot; class=&quot;com.???.dao.impl.XxxDaoImpl&quot; /&gt;
</code></pre>
<p>(Instantiation with a Static Factory Method) é™æ€å·¥å‚æ–¹æ³•åˆ›å»º beanï¼š</p>
<ul>
<li>class attribute æŒ‡å®šåŒ…å«é™æ€å·¥å‚æ–¹æ³•çš„å…¨ç±»å</li>
<li>factory-method attribute æŒ‡å®šå·¥å‚æ–¹æ³•çš„åç§°</li>
</ul>
<pre><code class="language-java">public class XxxDaoFactory{ // é™æ€å·¥å‚
    public static XxxDao getXxxDao(){
        return new XxxDaoImpl(); 
    }
}
</code></pre>
<pre><code class="language-xml">&lt;bean id=&quot;xxxDao&quot; class=&quot;com.???.factory.XxxDaoFactory&quot; factory-method=&quot;getXxxDao&quot;/&gt;
</code></pre>
<p>(Instantiation by Using an Instance Factory Method) å®ä¾‹å·¥å‚æ–¹æ³•åˆ›å»º beanï¼š</p>
<ul>
<li>è¯¥æ–¹å¼å¯çœ‹ä½œä»å®¹å™¨ä¸­è°ƒç”¨ç°æœ‰ bean çš„éé™æ€æ–¹æ³•æ¥åˆ›å»ºæ–° bean</li>
<li>class attribute ç•™ç©º</li>
<li>factory-bean attribute æŒ‡å‘å·¥å‚ bean</li>
<li>factory-method attribute æŒ‡å‘å·¥å‚æ–¹æ³•å</li>
</ul>
<pre><code class="language-java">public class XxxDaoFactory{ // å®ä¾‹å·¥å‚
    public XxxDao getXxxDao(){
        return new XxxDaoImpl(); 
    }
}
</code></pre>
<pre><code class="language-xml">&lt;!-- é¢å¤–é…ç½®å·¥å‚ bean --&gt;
&lt;bean id=&quot;xxxDaoFactory&quot; class=&quot;com.???.factory.XxxDaoFactory&quot; /&gt;
&lt;bean id=&quot;xxxDao&quot; factory-method=&quot;getXxxDao&quot; factory-bean=&quot;xxxDaoFactory&quot;/&gt;
</code></pre>
<p>é€šè¿‡å®ä¾‹å·¥å‚æ–¹æ³•åˆ›å»º bean çš„ç¼ºé™·ï¼š</p>
<ul>
<li>é¢å¤–çš„å·¥å‚ bean æ ‡ç­¾é™¤äº†é…åˆå®ä¾‹åŒ– bean ä¹‹å¤–æ²¡æœ‰å®é™…çš„æ„ä¹‰</li>
<li>å› æ–¹æ³•åçš„ä¸ç¡®å®šï¼Œæ¯æ¬¡å®ä¾‹åŒ– bean éƒ½éœ€è¦å¯¹ factory-method è¿›è¡Œé…ç½®</li>
</ul>
<p>è§£å†³ä¸Šè¿°ç¼ºé™·ï¼šFactoryBean å¯ä»¥å‘å®¹å™¨ä¸­æ³¨å†Œä¸¤ä¸ª beanï¼šç» getObject æ–¹æ³•çš„è¿”å›å€¼æ‰€ä»£è¡¨çš„ bean å’Œå…¶è‡ªèº«ã€‚</p>
<p>â¤ï¸â€ğŸ”¥ ä½¿ç”¨ FactoryBean å®ä¾‹åŒ– beanï¼š</p>
<ul>
<li>å®ç° FactoryBean æ¥å£å¹¶é‡å†™æ¥å£ä¸­çš„ getObject å’Œ getObjectType æ–¹æ³•</li>
<li>getObject è¿”å›å·¥å‚ç”Ÿäº§çš„å¯¹è±¡ï¼ˆè¿™æ˜¯ Spring å®¹å™¨å°†ä½¿ç”¨çš„å¯¹è±¡ï¼‰</li>
<li>getObjectType è¿”å›æ­¤ FactoryBean ç”Ÿæˆçš„å¯¹è±¡ç±»å‹</li>
<li>class attribute è®¾ç½®ä¸ºç° FactoryBean çš„å…¨ç±»å</li>
</ul>
<blockquote>
<p>factory bean æ˜¯æŒ‡é…ç½®åœ¨å®¹å™¨ä¸­å¹¶é€šè¿‡å®ä¾‹æˆ–é™æ€å·¥å‚æ–¹æ³•è€Œåˆ›å»ºçš„ beanã€‚<br>
FactoryBean æ˜¯æŒ‡ç‰¹å®šäº Spring ä¸­ FactoryBean çš„å®ç°ç±»ã€‚<br>
FactoryBean åˆ›å»ºå®Œæˆåï¼Œæ‰€æœ‰çš„ bean å‡ä¸ºå»¶è¿ŸåŠ è½½</p>
</blockquote>
<pre><code class="language-java">public class XxxDaoFactoryBean implements FactoryBean&lt;XxxDao&gt;{
    // ä»£æ›¿åŸå§‹å®ä¾‹å·¥å‚ä¸­åˆ›å»ºå¯¹è±¡çš„æ–¹æ³•
    @Override
    public XxxDao getObject() throws Exception {
        return new XxxDaoImpl();
    }
    @Override
    public Class&lt;?&gt; getObjectType() {
        return XxxDao.class;
    }
}
</code></pre>
<pre><code class="language-xml">&lt;bean id=&quot;xxxDao&quot; class=&quot;com.???.factory.XxxDaoFactoryBean&quot;/&gt;
</code></pre>
<pre><code class="language-java">public class TestFactoryBean {
    @Test
    public void testFBean(){
        ApplicationContext ctx = new ClassPathXmlApplicationContext(&quot;fbBeam.xml&quot;);
        XxxDao xxxDao = (XxxDao) ctx.getBean(&quot;xxxDao&quot;);
        xxxDao.yyy();
    }
}
</code></pre>
<h3 id="lifecycle-callbacks">Lifecycle Callbacks</h3>
<p>åˆå§‹åŒ–å›è°ƒï¼š</p>
<ol>
<li>ä½¿ç”¨ @PostConstruct æ³¨è§£</li>
<li>å¯¹é…ç½®å…ƒæ•°æ®ä½¿ç”¨ init-method æ¥æŒ‡å®š void no-argument çš„æ–¹æ³•å</li>
<li>å®ç°æ¥å£ InitializingBean çš„ afterPropertiesSet æ–¹æ³•</li>
</ol>
<p>é”€æ¯å›è°ƒï¼š</p>
<ol>
<li>ä½¿ç”¨ @PreDestroy æ³¨è§£</li>
<li>å¯¹é…ç½®å…ƒæ•°æ®ä½¿ç”¨ destroy-method æ¥æŒ‡å®š void no-argument çš„æ–¹æ³•å</li>
<li>å®ç°æ¥å£ DisposableBean çš„ destroy æ–¹æ³•</li>
</ol>
<pre><code class="language-java">public class XxxDaoImpl implements XxxDao {
    public void yyy(){ ... }
    public void initFunc(){ ... }
    public void destroyFunc(){ ... }
}
</code></pre>
<pre><code class="language-xml">&lt;bean id=&quot;orders&quot; class=&quot;com.???.dao.impl.XxxDaoImpl&quot; init-method=&quot;initFunc&quot; destroy-method=&quot;destroyFunc&quot;/&gt;
</code></pre>
<pre><code class="language-java">public class TestLifeCycle {
    @Test
    public void testLifeCycle(){
        ClassPathXmlApplicationContext ctx = new ClassPathXmlApplicationContext(&quot;lifeCyclebean.xml&quot;);
        XxxDao xxxDao = (XxxDao) ctx.getBean(&quot;xxxDao&quot;);
        xxxDao.yyy();
        ctx.registerShutdownHook();  // å…³é—­å®¹å™¨ =&gt; æ•ˆæœåŒ close
//      ctx.close();
    }
}
</code></pre>
<p>ç”Ÿå‘½å‘¨æœŸï¼š</p>
<ol>
<li>åˆå§‹åŒ–å®¹å™¨ï¼šæ–°å»ºå®ä¾‹ã€æ‰§è¡Œæ„é€ ã€å±æ€§æ³¨å…¥ï¼ˆset æ“ä½œï¼‰ã€bean åˆå§‹åŒ–</li>
<li>ä½¿ç”¨ beanï¼šæ‰§è¡Œä¸šåŠ¡</li>
<li>å…³é—­/é”€æ¯å®¹å™¨ï¼šæ‰§è¡Œ bean é”€æ¯æ–¹æ³•</li>
</ol>
<p>Spring IOC å®¹å™¨æä¾›çš„æ‰©å±•æ¥å£ BeanPostProcessor å®šä¹‰äº†ä¸¤ä¸ªå›è°ƒæ–¹æ³•ï¼š</p>
<ul>
<li>postProcessBeforeInitialization åœ¨ bean å®ä¾‹åˆå§‹åŒ–å‰è°ƒç”¨</li>
<li>postProcessAfterInitialization åœ¨ bean å®ä¾‹åˆå§‹åŒ–åè°ƒç”¨</li>
</ul>
<p>åç½®å¤„ç†å™¨ä¼šå¯¹å½“å‰é…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰ bean éƒ½ç”Ÿæ•ˆã€‚</p>
<pre><code class="language-xml">&lt;bean id=&quot;myBeanPost&quot; class=&quot;com.&lt;secret&gt;.spring5.lifeCycle.MyBeanPost&quot;/&gt;
</code></pre>
<pre><code class="language-java">public class MyBeanPost implements BeanPostProcessor {
    @Nullable
    public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {
        System.out.println(&quot;åœ¨åˆå§‹åŒ–ä¹‹å‰æ‰§è¡Œçš„æ–¹æ³•&quot;);
        return bean;
    }
    @Nullable
    public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
        System.out.println(&quot;åœ¨åˆå§‹åŒ–ä¹‹åæ‰§è¡Œçš„æ–¹æ³•&quot;);
        return bean;
    }
}
</code></pre>
<!--kg-card-end: markdown--><!--kg-card-begin: markdown--><h2 id="%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5-di">ä¾èµ–æ³¨å…¥ DI</h2>
<p>å‘ç±»ä¸­ä¼ é€’æ•°æ®çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼šæ™®é€šæ–¹æ³•ï¼ˆset æ–¹æ³•ï¼‰å’Œæ„é€ æ–¹æ³•ã€‚</p>
<p>åˆ›å»º bean ä¸ä»…ä¼šä¾èµ–å¼•ç”¨æ•°æ®ç±»å‹ï¼Œä¹Ÿä¼šä¾èµ–åŸºæœ¬æ•°æ®ç±»å‹ã€‚</p>
<p>ä»¥ä¸Šï¼Œä¾èµ–æ³¨å…¥ä¼šåˆ†åˆ«å­˜åœ¨é€šè¿‡ setter æˆ–æ„é€ å™¨æ³¨å…¥ç®€å•æˆ–å¼•ç”¨ç±»å‹çš„å››ç§æ–¹å¼ã€‚</p>
<h3 id="setter-%E6%B3%A8%E5%85%A5">setter æ³¨å…¥</h3>
<p>Setter-based DIï¼Œå³ setter æ³¨å…¥æ˜¯é€šè¿‡å®¹å™¨åœ¨è°ƒç”¨æ— å‚æ„é€ å‡½æ•°æˆ–æ— å‚é™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ– bean åè°ƒç”¨å…¶ setter æ–¹æ³•æ¥å®ç°çš„ã€‚</p>
<p><strong>setter æ³¨å…¥å¼•ç”¨ç±»å‹ï¼š</strong></p>
<ul>
<li>bean ä¸­å®šä¹‰å¼•ç”¨ç±»å‹å±æ€§å¹¶æä¾›å¯è®¿é—®çš„ set æ–¹æ³•</li>
<li>é…ç½®ä¸­ä½¿ç”¨ property æ ‡ç­¾çš„ ref å±æ€§æ³¨å…¥å¼•ç”¨ç±»å‹å¯¹è±¡</li>
</ul>
<pre><code class="language-java">public class XxxServiceImpl implements XxxService {
    private XxxDao xxxDao;
    public void setXxxDao(XxxDao xxxDao) {
      this.xxxDao = xxxDao;
    }
}
</code></pre>
<pre><code class="language-xml">&lt;bean id=&quot;xxxDao&quot; class=&quot;com.xxx.dao.impl.XxxDaoImpl&quot;&gt;
&lt;bean id=&quot;xxxService&quot; class=&quot;com.xxx.service.impl.XxxServiceImpl&quot;&gt;
    &lt;property name=&quot;xxxDao&quot; ref=&quot;xxxDao&quot; /&gt;
&lt;/bean&gt;
</code></pre>
<p><strong>setter æ³¨å…¥ç®€å•ç±»å‹ï¼š</strong></p>
<ul>
<li>bean ä¸­å®šä¹‰ç®€å•ç±»å‹å±æ€§å¹¶æä¾›å¯è®¿é—®çš„ set æ–¹æ³•</li>
<li>é…ç½®ä¸­ä½¿ç”¨ property æ ‡ç­¾çš„ value å±æ€§æ³¨å…¥ç®€å•ç±»å‹å¯¹è±¡</li>
</ul>
<pre><code class="language-java">public class XxxServiceImpl implements XxxService {
    private int connectionNumber;
    public void setConnectionNumber(int connectionNumber) {
      this.connectionNumber = connectionNumber;
    }
}
</code></pre>
<pre><code class="language-xml">&lt;bean id=&quot;xxxService&quot; class=&quot;com.xxx.service.impl.XxxServiceImpl&quot;&gt;
    &lt;property name=&quot;connectionNumber&quot; value=&quot;6&quot; /&gt;
&lt;/bean&gt;
</code></pre>
<h3 id="%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5">æ„é€ å™¨æ³¨å…¥</h3>
<p>åœ¨åˆ›å»ºå¯¹è±¡æ—¶é»˜è®¤æ‰§è¡Œæ— å‚æ•°çš„æ„é€ ï¼Œè‹¥åœ¨ç±»ä¸­å®šä¹‰æœ‰å‚æ„é€ å™¨å´ä¸å®šä¹‰æ— å‚æ„é€ å™¨åˆ™ä¼šæŠ¥é”™ã€‚</p>
<p><strong>æ„é€ å™¨æ³¨å…¥å¼•ç”¨ç±»å‹ï¼š</strong></p>
<ul>
<li>bean ä¸­å®šä¹‰å¼•ç”¨ç±»å‹å±æ€§å¹¶æä¾›å¯è®¿é—®çš„æ„é€ æ–¹æ³•</li>
<li>é…ç½®ä¸­ä½¿ç”¨ constructor-arg æ ‡ç­¾çš„ ref å±æ€§æ³¨å…¥å¼•ç”¨ç±»å‹å¯¹è±¡</li>
</ul>
<pre><code class="language-java">public class XxxServiceImpl implements XxxService {
    private XxxDao xxxDao;
    public void setXxxDao(XxxDao xxxDao) {
      this.xxxDao = xxxDao;
    }
}
</code></pre>
<pre><code class="language-xml">&lt;bean id=&quot;xxxDao&quot; class=&quot;com.xxx.dao.impl.XxxDaoImpl&quot;&gt;
&lt;bean id=&quot;xxxService&quot; class=&quot;com.xxx.service.impl.XxxServiceImpl&quot;&gt;
    &lt;constructor-arg name=&quot;xxxDao&quot; ref=&quot;xxxDao&quot; /&gt;
&lt;/bean&gt;
</code></pre>
<p><strong>æ„é€ å™¨æ³¨å…¥ç®€å•ç±»å‹ï¼š</strong></p>
<ul>
<li>bean ä¸­å®šä¹‰ç®€å•ç±»å‹å±æ€§å¹¶æä¾›å¯è®¿é—®çš„æ„é€ æ–¹æ³•</li>
<li>é…ç½®ä¸­ä½¿ç”¨ constructor-arg æ ‡ç­¾çš„ value å±æ€§æ³¨å…¥ç®€å•ç±»å‹å¯¹è±¡</li>
</ul>
<pre><code class="language-java">public class XxxServiceImpl implements XxxService {
    private int connectionNumber;
    public void setConnectionNumber(int connectionNumber) {
      this.connectionNumber = connectionNumber;
    }
}
</code></pre>
<pre><code class="language-xml">&lt;bean id=&quot;xxxService&quot; class=&quot;com.xxx.service.impl.XxxServiceImpl&quot;&gt;
    &lt;constructor-arg name=&quot;xxxDao&quot; value=&quot;6&quot; /&gt;
&lt;/bean&gt;
</code></pre>
<p><strong>æ„é€ å™¨æ³¨å…¥çš„å‚æ•°é€‚é…ï¼š</strong></p>
<ul>
<li>é…ç½®ä¸­ä½¿ç”¨ constructor-arg æ ‡ç­¾çš„ type å±æ€§è®¾ç½®æŒ‰å½¢å‚ç±»å‹æ³¨å…¥</li>
<li>é…ç½®ä¸­ä½¿ç”¨ constructor-arg æ ‡ç­¾çš„ index å±æ€§è®¾ç½®æŒ‰å½¢å‚ä½ç½®æ³¨å…¥</li>
</ul>
<h3 id="%E4%BE%9D%E8%B5%96%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D">ä¾èµ–è‡ªåŠ¨è£…é…</h3>
<p>è‡ªåŠ¨è£…é…å³ IoC å®¹å™¨æ® bean ä¾èµ–çš„èµ„æºåœ¨å®¹å™¨é‡Œè‡ªåŠ¨æŸ¥æ‰¾å¹¶æ³¨å…¥ bean çš„è¿‡ç¨‹ã€‚</p>
<ul>
<li>é…ç½®ä¸­ä½¿ç”¨ bean æ ‡ç­¾çš„ autowire å±æ€§</li>
<li>è‡ªåŠ¨è£…é…ç”¨äºå¼•ç”¨ç±»å‹ä¾èµ–æ³¨å…¥ï¼Œä¸èƒ½å¯¹ç®€å•ç±»å‹è¿›è¡Œæ“ä½œ</li>
<li>ä½¿ç”¨ byType æŒ‰ç±»å‹è£…é…æ—¶å¿…é¡»ä¿è¯å®¹å™¨ä¸­ç›¸åŒç±»å‹çš„ bean å”¯ä¸€</li>
<li>ä½¿ç”¨ byName æŒ‰åç§°è£…é…æ—¶å¿…é¡»ä¿è¯å®¹å™¨ä¸­å…·æœ‰æŒ‡å®šåç§°çš„ bean</li>
<li>è‡ªåŠ¨è£…é…ä¼˜å…ˆçº§ä½äº setter æ³¨å…¥å’Œç‹—åœ¨å™¨æ³¨å…¥ï¼ŒåŒæ—¶å‡ºç°æ—¶è‡ªåŠ¨è£…é…å¤±æ•ˆ</li>
</ul>
<pre><code class="language-java">// è‡ªåŠ¨è£…é…ç±»
public class Emp {
    private Dept dept;
    @Override
    public String toString() { return &quot;Emp{&quot; + &quot;dept=&quot; + dept + '}'; }
    public void setDept(Dept dept) { this.dept = dept; }
    public void test(){ System.out.println(dept); }
}
</code></pre>
<pre><code class="language-java">// å¾…è£…é…ç±»
public class Dept {
    @Override
    public String toString() { return &quot;Dept{}&quot;; }
}
</code></pre>
<pre><code class="language-xml">&lt;!-- å®ç°è‡ªåŠ¨è£…é… =&gt; autowireå±æ€§ =&gt; ç”¨çš„è¾ƒå°‘ --&gt;
    &lt;!-- byName æ ¹æ®åç§°æ³¨å…¥ =&gt; æ³¨å…¥å€¼ bean çš„ id å€¼å’Œç±»å±æ€§åç§°ä¸€æ · --&gt;
    &lt;!-- byType æ ¹æ®ç±»å‹æ³¨å…¥ =&gt; å¤šä¸ª bean ä¸èƒ½è¿›è¡Œé€‰æ‹© --&gt;
&lt;bean id=&quot;emp&quot; class=&quot;com.&lt;secret&gt;.spring5.autowire.Emp&quot; autowire=&quot;byName&quot;/&gt;
&lt;bean id=&quot;dept&quot; class=&quot;com.&lt;secret&gt;.spring5.autowire.Dept&quot;&gt;&lt;/bean&gt;
</code></pre>
<pre><code class="language-java">public class TestAutoWire {
    // æµ‹è¯•è‡ªåŠ¨æ³¨å…¥
    @Test
    public void testAutoWire(){
        ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(&quot;bean9.xml&quot;);
        Emp emp = context.getBean(&quot;emp&quot;, Emp.class);
        System.out.println(emp);
        emp.test();
    }
}
</code></pre>
<p>Spring ä¼šå°†å±æ€§çš„ empty arguments è§†ä½œä¸ºç©ºå­—ç¬¦ä¸²ã€‚</p>
<pre><code class="language-xml">&lt;bean class=&quot;...&quot;&gt;&lt;property name=&quot;email&quot; value=&quot;&quot;/&gt;&lt;/bean&gt;
&lt;bean class=&quot;...&quot;&gt;&lt;property name=&quot;email&quot;&gt;&lt;null/&gt;&lt;/property&gt;&lt;/bean&gt;
</code></pre>
<p>ç‰¹æ®Šç¬¦å·çš„å¤„ç†ï¼š</p>
<ul>
<li>ä½¿ç”¨è½¬ä¹‰å­—ç¬¦è¿›è¡Œä»£æ›¿</li>
<li>property æ ‡ç­¾ä¸­çš„ value å±æ€§åº”æŠ½ç¦»æˆç‹¬ç«‹æ ‡ç­¾</li>
<li>value æ ‡ç­¾é€šè¿‡ <code>&lt;![CDATA[?]]&gt;</code> æ ‡ç­¾å†…å®¹åŒ…è£¹ç‰¹æ®Šç¬¦å·</li>
</ul>
<pre><code class="language-xml">&lt;bean id=&quot;user&quot; class=&quot;com.???.spring5.User&quot;&gt;
    &lt;property name=&quot;name&quot;&gt;
        &lt;value&gt;
            &lt;!-- CDATA[] å†…ä¸­å¡«å†™è¦è¾“å‡ºçš„å€¼ --&gt;
            &lt;![CDATA[&lt;&lt;okk&gt;&gt;]]&gt;
        &lt;/value&gt;
    &lt;/property&gt;
&lt;/bean&gt;
</code></pre>
<blockquote>
<p>The p-namespace lets you use the bean elementâ€™s attributes (instead of nested <code>&lt;property/&gt;</code> elements) to describe your property values collaborating beans, or both.</p>
</blockquote>
<p>ç®€åŒ– XML é…ç½®æ–‡ä»¶çš„ p-namespaceï¼š</p>
<ul>
<li>å¼•å…¥ nsï¼š<code>xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</code></li>
<li>åœ¨å¯¹åº”çš„ bean ä¸­ä½¿ç”¨ <code>p:å±æ€§</code> æ›¿ä»£ <code>&lt;property&gt;</code> æ ‡ç­¾</li>
<li>æ³¨æ„æ­¤æ–¹å¼ä¸éœ€è¦ä¿®æ”¹ xsi:schemaLocation</li>
</ul>
<pre><code class="language-xml">&lt;bean name=&quot;my_classicBean&quot; class=&quot;com.example.ExampleBean&quot;&gt;
    &lt;property name=&quot;email&quot; value=&quot;ok@gmail.com&quot;/&gt;
&lt;/bean&gt;
&lt;!-- ä¸Šä¸‹ä¸¤ç§æ–¹å¼ç­‰ä»· --&gt;
&lt;bean name=&quot;my_p-namespaceBean&quot; class=&quot;com.example.ExampleBean&quot; p:email=&quot;ok@gmail.com&quot;/&gt;
</code></pre>
<blockquote>
<p>The c-namespace, introduced in Spring 3.1, allows inlined attributes for configuring the constructor arguments rather then nested constructor-arg elements.</p>
</blockquote>
<p>ç®€åŒ– XML é…ç½®æ–‡ä»¶çš„ c-namespaceï¼š</p>
<ul>
<li>å¼•å…¥ nsï¼š<code>xmlns:c=&quot;http://www.springframework.org/schema/c&quot;</code></li>
<li>åœ¨å¯¹åº”çš„ bean ä¸­ä½¿ç”¨ <code>c:å±æ€§</code>ï¼ˆå…·ä½“åç§°å¯å®šåˆ¶ï¼‰ï¼Œè€Œéå­å…ƒç´ &lt;constructor-arg&gt;ï¼Œ</li>
</ul>
<pre><code class="language-xml">&lt;!-- traditional declaration --&gt;
&lt;bean id=&quot;foo&quot; class=&quot;x.y.Foo&quot;&gt;
    &lt;constructor-arg ref=&quot;bar&quot;/&gt;
    &lt;constructor-arg ref=&quot;baz&quot;/&gt;
    &lt;constructor-arg value=&quot;foo@bar.com&quot;/&gt;
&lt;/bean&gt;
&lt;!-- c-namespace declaration --&gt;
&lt;bean id=&quot;foo&quot; class=&quot;x.y.Foo&quot; c:bar-ref=&quot;bar&quot; c:baz-ref=&quot;baz&quot; c:email=&quot;foo@bar.com&quot;/&gt;
</code></pre>
<h3 id="%E9%9B%86%E5%90%88%E6%B3%A8%E5%85%A5">é›†åˆæ³¨å…¥</h3>
<p>æ³¨å…¥é›†åˆç±»å‹çš„å±æ€§ï¼Œå³æ³¨å…¥æ•°ç»„ã€Listã€Map ä»¥åŠ Setã€‚</p>
<pre><code class="language-java">public class XxxDaoImpl implements XxxDao {
    private int[] array;
    private List&lt;String&gt; list;
    private Map&lt;String, String&gt; map;
    private Set&lt;String&gt; set;
    private Properties properties;
    public void setArray(int[] array) { this.array = array; }
    public void setList(List&lt;String&gt; list) { this.list = list; }
    public void setMap(Map&lt;String, String&gt; maps) { this.maps = maps; }
    public void setSet(Set&lt;String&gt; sets) { this.sets = sets; }
    public void setProperties(Properties properties) { this.properties = properties; }
    public void test(){
        System.out.println(Arrays.toString(array));
        System.out.println(list);
        System.out.println(map);
        System.out.println(set);
        System.out.println(properties);
    }
}
</code></pre>
<pre><code class="language-xml">&lt;bean id=&quot;xxxDao&quot; class=&quot;com.???.dao.impl.XxxDaoImpl&quot;&gt;
    &lt;property name=&quot;array&quot;&gt;
        &lt;array&gt;
            &lt;value&gt;1&lt;/value&gt;
            &lt;value&gt;2&lt;/value&gt;
            &lt;value&gt;3&lt;/value&gt;
        &lt;/array&gt;
    &lt;/property&gt;
    &lt;property name=&quot;list&quot;&gt;
        &lt;list&gt;
            &lt;value&gt;yes&lt;/value&gt;
            &lt;value&gt;ok&lt;/value&gt;
        &lt;/list&gt;
    &lt;/property&gt;
    &lt;property name=&quot;map&quot;&gt;
        &lt;map&gt;
            &lt;entry key=&quot;JAVA&quot; value=&quot;java&quot;/&gt;
            &lt;entry key=&quot;JAVASCRIPT&quot; value=&quot;javascript&quot;/&gt;
        &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name=&quot;set&quot;&gt;
        &lt;set&gt;
            &lt;value&gt;MySQL&lt;/value&gt;
            &lt;value&gt;Redis&lt;/value&gt;
        &lt;/set&gt;
    &lt;/property&gt;
    &lt;property name=&quot;properties&quot;&gt;
        &lt;props&gt;
            &lt;prop key=&quot;msg&quot;&gt;msgcontext&lt;/prop&gt;
        &lt;/props&gt;
    &lt;/property&gt;
&lt;/bean&gt;
</code></pre>
<pre><code class="language-java">public class TestL {
    @Test
    public void testCollection1(){
        ApplicationContext ctx = new ClassPathXmlApplicationContext(&quot;beanDI.xml&quot;);
        XxxDao xxxDao = (XxxDao) ctx.getBean(&quot;xxxDao&quot;);
        xxxDao.test();
    }
}
</code></pre>
<p>åœ¨æ³¨å…¥ bean é›†åˆç±»å‹å±æ€§æ—¶ï¼Œå¯¹äºå­˜åœ¨å¯å¤ç”¨çš„é›†åˆï¼Œåº”æŠ½å–å•ç‹¬å°è£…ã€‚</p>
<pre><code class="language-java">/* é›†åˆæ³¨å…¥æå– */
public class BookExtract {
    private List&lt;String&gt; list;
    public void setList(List&lt;String&gt; list) { this.list = list; }
    public void test(){ System.out.println(list); }
}
</code></pre>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans ...
       xmlns:util=&quot;http://www.springframework.org/schema/util&quot;
       xsi:schemaLocation=&quot;...
                           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd&quot;&gt;
    &lt;!-- é›†åˆæ³¨å…¥éƒ¨åˆ†æå– --&gt;
    &lt;util:list id=&quot;bookList&quot;&gt;
        &lt;value&gt;js&lt;/value&gt;
        &lt;value&gt;java&lt;/value&gt;
        &lt;value&gt;nodejs&lt;/value&gt;
    &lt;/util:list&gt;
    &lt;bean id=&quot;bookExtract&quot; class=&quot;com.&lt;secret&gt;.spring5.bean.BookExtract&quot;&gt;
        &lt;property name=&quot;list&quot; ref=&quot;bookList&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre>
<pre><code class="language-java">public class TestL {
    // é›†åˆæ³¨å…¥éƒ¨åˆ†æŠ½å–æµ‹è¯•
    @Test
    public void testCollection2(){
        ApplicationContext context = new ClassPathXmlApplicationContext(&quot;bean6.xml&quot;);
        BookExtract be = context.getBean(&quot;bookExtract&quot;, BookExtract.class);
        be.test();
    }
}
</code></pre>
<h3 id="%E5%BC%95%E7%94%A8%E5%A4%96%E9%83%A8%E6%96%87%E4%BB%B6">å¼•ç”¨å¤–éƒ¨æ–‡ä»¶</h3>
<p>æ•°æ®æºå¯¹è±¡ç®¡ç†ï¼šå¯¼å…¥åæ ‡åé…ç½®æ•°æ®æºå¯¹è±¡ä½œä¸º Spring ç®¡ç†çš„ beanã€‚</p>
<pre><code class="language-xml">&lt;bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;&gt;
    &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;
    &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/spring_db&quot;/&gt;
    &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;
    &lt;property name=&quot;password&quot; value=&quot;yesok&quot;/&gt;
&lt;/bean&gt;
</code></pre>
<pre><code class="language-xml">&lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;
    &lt;property name=&quot;driverClass&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;
    &lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://localhost:3306/spring_db&quot;/&gt;
    &lt;property name=&quot;user&quot; value=&quot;root&quot;/&gt;
    &lt;property name=&quot;password&quot; value=&quot;yesok&quot;/&gt;
&lt;/bean&gt;
</code></pre>
<p>åŠ è½½ properties æ–‡ä»¶ï¼š</p>
<ul>
<li>å¼€å¯ context å‘½åç©ºé—´</li>
<li>ä½¿ç”¨ context ç©ºé—´åŠ è½½ properties æ–‡ä»¶</li>
<li>ä½¿ç”¨å ä½ç¬¦ <code>${}</code> è¯»å– properties æ–‡ä»¶ä¸­çš„å±æ€§</li>
</ul>
<pre><code class="language-xml">&lt;beans ...
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xsi:schemaLocation=&quot;...
       http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;
    &lt;context:property-placeholder location=&quot;classpath*:*.properties&quot;/&gt;
    &lt;bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;${jdbc.driverClass}&quot;/&gt;
        &lt;property name=&quot;url&quot; value=&quot;${jdbc.url}&quot;/&gt;
        &lt;property name=&quot;username&quot; value=&quot;${jdbc.userName}&quot;/&gt;
        &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;/&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre>
<pre><code class="language-yaml">jdbc.driverClass=com.mysql.cj.jdbc.Driver
jdbc.url=jdbc:mysql://localhost:3306/???
jdbc.userName=root
jdbc.password=yesok
</code></pre>
<!--kg-card-end: markdown--><!--kg-card-begin: markdown--><h2 id="%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91">æ³¨è§£å¼€å‘</h2>
<p>å’Œé…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œæ³¨è§£æœ¬èº«å¹¶ä¸æ‰§è¡Œï¼Œä»…åšä¸ºæ ‡è®°ã€‚å…·ä½“çš„åŠŸèƒ½æ˜¯æ¡†æ¶æ£€æµ‹åˆ°æ³¨è§£æ ‡è®°çš„ä½ç½®ï¼Œç„¶åé’ˆå¯¹è¿™ä¸ªä½ç½®æŒ‰ç…§æ³¨è§£æ ‡è®°çš„åŠŸèƒ½æ¥æ‰§è¡Œæ“ä½œã€‚</p>
<h3 id="%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91%E5%AE%9A%E4%B9%89-bean">æ³¨è§£å¼€å‘å®šä¹‰ bean</h3>
<p>åˆ›å»º bean å®ä¾‹ï¼ˆä¸‹åˆ—æ³¨è§£æ— æœ¬è´¨åŒºåˆ«ï¼‰ï¼š</p>
<ul>
<li><code>@Component</code> æ ‡è®°æ™®é€šç»„ä»¶</li>
<li><code>@Controller</code> æ ‡è®°è¡¨è¿°å±‚ç»„ä»¶</li>
<li><code>@Service</code> æ ‡è®°ä¸šåŠ¡å±‚ç»„ä»¶</li>
<li><code>@Repository</code> æ ‡è®°æ•°æ®å±‚ç»„ä»¶ï¼ˆDAO å’Œ Mapper æ¥å£ï¼‰</li>
</ul>
<p>ç»„ä»¶æ‰«æé…ç½®ï¼š</p>
<ul>
<li>é€šè¿‡ <code>@Component</code> æ³¨è§£å°†ç»„ä»¶ç±»è§†ä½œ bean</li>
<li>é€šè¿‡ <code>context:component-scan</code> æ ‡ç­¾çš„ <code>base-package</code> å±æ€§è¿›è¡Œæ‰«æ</li>
</ul>
<p>å­˜åœ¨å¤šä¸ªåŒ…éœ€è¦æ‰«æçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨é€—å·åˆ†éš”æˆ–è€…ç›´æ¥æ‰«æä¸Šå±‚ç›®å½•ã€‚</p>
<pre><code class="language-java">@Component(value = &quot;userAnnot&quot;)
public class UserAnnot {
    public void add(){ System.out.println(&quot;Annot add...&quot;); }
}
</code></pre>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;
    &lt;context:component-scan base-package=&quot;com.&lt;secret&gt;.spring5.wkAnnot&quot;/&gt;
&lt;/beans&gt;
</code></pre>
<pre><code class="language-java">/* æ³¨è§£æµ‹è¯•ç±» */
public class TestAnno {
    @Test
    public void testAnno1(){
        ApplicationContext ctx = new ClassPathXmlApplicationContext(&quot;bbean1.xml&quot;);
        UserAnnot ua = ctx.getBean(&quot;userAnnot&quot;, UserAnnot.class);
        System.out.println(ua);
        ua.add();
    }
}
</code></pre>
<p>ä½œç”¨èŒƒå›´ç”¨ @Scope å®šä¹‰ï¼Œç”Ÿå‘½å‘¨æœŸç”¨ @PostConstruct å’Œ @PreDestroy å®šä¹‰ã€‚</p>
<h3 id="%E7%BA%AF%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91">çº¯æ³¨è§£å¼€å‘</h3>
<p>Spring3 å¼€å¯çš„çº¯æ³¨è§£å¼€å‘å¯ä»¥é€šè¿‡é…ç½®ç±»æ›¿ä»£é…ç½®æ–‡ä»¶ã€‚</p>
<ul>
<li>@Configuration æ³¨è§£æ ‡è®°å½“å‰ç±»ä½œä¸ºé…ç½®ç±»ï¼Œä»£æ›¿é…ç½®æ–‡ä»¶ç»“æ„</li>
<li>@ComponentScan æ›¿ä»£ context:component-scan æ ‡ç­¾</li>
<li>@PropertySource å¯åŠ è½½ properties æ–‡ä»¶</li>
</ul>
<pre><code class="language-java">public class TestPureAnnot {
    @Test
    public void TestPureAnnot(){
        ApplicationContext ctx = new AnnotationConfigApplicationContext(SpringConfig.class);
        UserService userservice = ctx.getBean(&quot;userService&quot;, UserService.class);
        userservice.usMethod();
    }
}
</code></pre>
<pre><code class="language-java">@Configuration
@ComponentScan(basePackages = {&quot;com.&lt;secret&gt;.spring5.annoDev&quot;})
@PropertySource(&quot;classpath:jdbc.properties&quot;)
public class SpringConfig {}
</code></pre>
<h3 id="%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5">ä¾èµ–æ³¨å…¥</h3>
<p>è‡ªåŠ¨è£…é…ï¼š</p>
<ul>
<li><code>@Autowired</code> æ ¹æ® bean ç±»å‹è¿›è¡Œè£…é…</li>
<li><code>@Qualifier</code> æ ¹æ® bean åç§°è¿›è¡Œè£…é…</li>
<li><code>@Resource</code> æ—¢å¯æ ¹æ®ç±»å‹è£…é…ï¼Œä¹Ÿå¯æ ¹æ®åç§°è£…é…</li>
<li><code>@Value</code> è¿›è¡Œç®€å•ç±»å‹æ³¨å…¥</li>
</ul>
<p><code>@Qualifier</code> å¿…é¡»ä¾èµ– <code>@Autowired</code>ï¼Œç”¨äºè§£å†³ç›¸åŒç±»å‹ bean æ³¨å…¥çš„å†²çªã€‚</p>
<p>è‡ªåŠ¨è£…é…åŸºäºåå°„è®¾è®¡åˆ›å»ºå¯¹è±¡å¹¶æš´åŠ›åå°„å¯¹åº”å±æ€§ä¸ºç§æœ‰å±æ€§åˆå§‹åŒ–æ•°æ®ï¼Œå› æ­¤æ— éœ€æä¾› setter æ–¹æ³•ã€‚</p>
<p>è‡ªåŠ¨è£…é…å»ºè®®ä½¿ç”¨æ— å‚æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼ˆé»˜è®¤ï¼‰ï¼Œè‹¥ä¸æä¾›å¯¹åº”æ„é€ æ–¹æ³•ï¼Œåˆ™æä¾›å”¯ä¸€æ„é€ æ–¹æ³•ã€‚</p>
<pre><code class="language-java">@Service
public class UserService {
//    @Autowired // æ ¹æ®ç±»å‹è¿›è¡Œæ³¨å…¥
//    @Qualifier(value=&quot;userDaoImpl1&quot;)
//    private UserService userDao;
//    @Resource // æ ¹æ®ç±»å‹è¿›è¡Œæ³¨å…¥
    @Resource(name = &quot;userDaoImpl1&quot;) // æ ¹æ®åç§°è¿›è¡Œæ³¨å…¥
    private UserDao userDao;
    @Value(value=&quot;hz&quot;) // æ³¨å…¥æ™®é€šç±»å‹å±æ€§
    private String name;
    public void usMethod(){
        System.out.println(&quot;service usMethod&quot;);
        userDao.udiMethod();
        System.out.println(name);
    }
}
</code></pre>
<pre><code class="language-java">@Repository(value=&quot;userDaoImpl1&quot;)
public class UserDaoImpl implements UserDao{
    @Override
    public void udiMethod() { System.out.println(&quot;impl ado udiMethod&quot;); }
}
</code></pre>
<h3 id="%E7%AE%A1%E7%90%86%E7%AC%AC%E4%B8%89%E6%96%B9-bean">ç®¡ç†ç¬¬ä¸‰æ–¹ bean</h3>
<p>ç¬¬ä¸‰æ–¹ bean ç®¡ç†ï¼š</p>
<ul>
<li>ä½¿ç”¨ç‹¬ç«‹çš„é…ç½®ç±»ç®¡ç†ç¬¬ä¸‰æ–¹ bean</li>
<li>@Bean æ ‡è®°è¿”å›å€¼æ˜¯ bean çš„æ–¹æ³•</li>
<li>æ‰‹åŠ¨åŠ å…¥é…ç½®ç±»åˆ°æ ¸å¿ƒé…ç½®
<ul>
<li>å¯¼å…¥å¼ @Import æ³¨è§£</li>
<li>æ‰«æå¼ @ComponentScan æ³¨è§£ï¼ˆéœ€é¢å¤– @Configuration æ³¨è§£ï¼‰</li>
</ul>
</li>
</ul>
<pre><code class="language-java">// @Configuration
public class JdbcConfig {
    @Bean
    public DataSource dataSource(){
        DruidDataSource ds = new DruidDataSource();
        ds.setDriverClassName(&quot;com.mysql.jdbc.Driver&quot;);
        ds.setUrl(&quot;jdbc:mysql://localhost:3306/???&quot;);
        ds.setUsername(&quot;root&quot;);
        ds.setPassword(&quot;yesok&quot;);
        return ds;
    }
}
</code></pre>
<pre><code class="language-java">@Configuration
@Import({JdbcConfig.class}) // @ComponentScan({&quot;com.xxx.config&quot;})
public class SpringConfig {}
</code></pre>
<p>ç¬¬ä¸‰æ–¹ bean çš„ä¾èµ–æ³¨å…¥ï¼š</p>
<ul>
<li>ç®€å•ç±»å‹é€šè¿‡ @Value æ³¨è§£è¿›è¡Œæ³¨å…¥</li>
<li>å¼•ç”¨ç±»å‹æ³¨å…¥éœ€ä¸ºè¿”å› bean çš„æ–¹æ³•è®¾ç½®ç›¸åº”çš„å½¢å‚</li>
</ul>
<pre><code class="language-java">public class JdbcConfig {
    @Value(&quot;com.mysql.jdbc.Driver&quot;);
    private String driver;
    @Value(&quot;jdbc:mysql://localhost:3306/???&quot;);
    private String url;
    @Value(&quot;root&quot;);
    private String userName;
    @Value(&quot;password&quot;)
    private String password;
    @Bean
    public DataSource dataSource(XxxService xxxService){
        System.out.println(xxxService);
        DruidDataSource ds = new DruidDataSource();
        ds.setDriverClassName(driver);
        ds.setUrl(url);
        ds.setUsername(userName);
        ds.setPassword(password);
        return ds;
    }
}
</code></pre>
<pre><code class="language-java">@Configuration
@ComponentScan({&quot;com..???..config&quot;,&quot;com.???.service&quot;})
@Import({JdbcConfig.class})
public class SpringConfig {}
</code></pre>
<!--kg-card-end: markdown--><!--kg-card-begin: markdown--><h2 id="aspect-oriented-programming">Aspect Oriented Programming</h2>
<blockquote>
<p>AOP <strong>é¢å‘åˆ‡é¢ç¼–ç¨‹</strong>ï¼šåœ¨ä¸æƒŠåŠ¨åŸå§‹è®¾è®¡çš„åŸºç¡€ä¸Šè¿›è¡ŒåŠŸèƒ½çš„å¢å¼ºã€‚</p>
</blockquote>
<blockquote>
<p>In Spring AOP, aspects are implemented by using regular classes (the schema-based approach) or regular classes annotated with the @Aspect annotation (the @AspectJ style).</p>
</blockquote>
<h3 id="aop-basis">AOP Basis</h3>
<p>AOP æœ¯è¯­å¹¶ä¸æ˜¯ç‰¹å®šäº Springã€‚å› å…¶æŠ½è±¡æ€§ï¼ŒSpring ä¸ä¼šå¢åŠ é¢å¤–çš„æ¦‚å¿µã€‚</p>
<ul>
<li>è¿æ¥ç‚¹ JoinPointï¼šå·²å­˜åœ¨çš„åŠŸèƒ½ï¼Œå¯¹åº”å„ç±»çš„æ–¹æ³•ï¼Œæ‰§è¡Œä½ç½®ä¸é™</li>
<li>åˆ‡å…¥ç‚¹ Pointcutï¼šéœ€è¦è¿½åŠ åŠŸèƒ½çš„æ–¹æ³•ï¼Œå¯é€šè¿‡è¡¨è¾¾å¼åŒ¹é…å¯¹åº”çš„è¿æ¥ç‚¹</li>
<li>é€šçŸ¥ Adviceï¼šå·²æŠ½å–å‡ºçš„å…±æ€§åŠŸèƒ½ä¸å¢å¼ºé€»è¾‘ï¼Œä¾æ‰˜é€šçŸ¥ç±»ï¼ˆå®šä¹‰é€šçŸ¥ï¼‰</li>
<li>åˆ‡é¢ Aspectï¼šæè¿°é€šçŸ¥çš„å…±æ€§åŠŸèƒ½ä¸å¯¹åº”åˆ‡å…¥ç‚¹çš„å…³ç³»</li>
</ul>
<p>ä½¿ç”¨ pointcut designator ç¡®å®šå¯¹å…·ä½“ç±»é‡Œçš„å…·ä½“æ–¹æ³•è¿›è¡Œå¢å¼ºï¼š</p>
<pre><code class="language-java">// The format of an execution expression follows:
execution(modifiers-pattern? ret-type-pattern declaring-type-pattern?name-pattern(param-pattern) throws-pattern?)
</code></pre>
<p>AOP æ“ä½œçš„å®ç° AspectJ å¹¶éæ˜¯ Spring çš„ç»„æˆéƒ¨åˆ†ï¼Œè€Œæ˜¯ç‹¬ç«‹çš„ AOP æ¡†æ¶ï¼š</p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.aspectj&lt;/groupId&gt;
    &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;
    &lt;version&gt;1.9.19&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>æ³¨è§£æ“ä½œ AspectJ è¿›è¡Œ AOP å¼€å‘ï¼š</p>
<ul>
<li>å¯¼å…¥ AspectJ ç›¸å…³åæ ‡ï¼›spring-context åæ ‡é»˜è®¤ä¾èµ– spring-aop åæ ‡</li>
<li>å®šä¹‰ AOP æ¥å£ä¸å®ç°ç±»</li>
<li>å®šä¹‰é€šçŸ¥ç±»æŠ½å–é€šçŸ¥ï¼Œå¹¶é€šè¿‡ @Pointcut å®šä¹‰åˆ‡å…¥ç‚¹</li>
<li>ç»‘å®šåˆ‡å…¥ç‚¹ä¸é€šçŸ¥å…³ç³»ï¼Œå¹¶æŒ‡å®šé€šçŸ¥æ·»åŠ åˆ°åŸå§‹è¿æ¥ç‚¹çš„å…·ä½“æ‰§è¡Œä½ç½®</li>
<li>å®šä¹‰é€šçŸ¥ç±»æ¥å— Spring å®¹å™¨ç®¡ç†ï¼Œä¸”å®šä¹‰å½“å‰ç±»ä¸ºåˆ‡é¢ç±»</li>
<li>åœ¨ Spring æ ¸å¿ƒé…ç½®ä¸­å¼€å¯ Spring å¯¹ AOP æ³¨è§£çš„é©±åŠ¨æ”¯æŒ</li>
</ul>
<pre><code class="language-java">// è¢«å¢å¼ºç±»
@Component
public class User {
    public void uMethod(){ System.out.println(&quot;user method&quot;); }
}
</code></pre>
<p>åˆ‡å…¥ç‚¹çš„å®šä¹‰ä¾æ‰˜ä¸€ä¸ªä¸å…·æœ‰å®é™…æ„ä¹‰çš„æ–¹æ³•è¿›è¡Œï¼Œå³æ— å‚æ•°ï¼Œæ— è¿”å›å€¼ï¼Œæ— å®é™…é€»è¾‘ã€‚AOP é€šçŸ¥ç±»å‹æŸ¥çœ‹ã€€=&gt; <a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-advice">Declaring Advice</a></p>
<pre><code class="language-java">// å¢å¼ºç±» or é€šçŸ¥ç±» =&gt; ä¸åŒæ–¹æ³•ä»£è¡¨ä¸åŒé€šçŸ¥å†…å®¹
@Component // ç”Ÿæˆ bean
@Aspect // ç”Ÿæˆä»£ç†å¯¹è±¡ &amp; ä½œä¸º AOP å¤„ç†
@Order(3) // å¤šä¸ªå¢å¼ºç±»è®¾ç½®ä¼˜å…ˆçº§
public class UserProxy {
    // ç›¸åŒåˆ‡å…¥ç‚¹æŠ½å–
    @Pointcut(value=&quot;execution(* com.&lt;secret&gt;.spring5.aopanno.User.uMethod())&quot;)
    public void pointExtraction(){

    }
    // å‰ç½®é€šçŸ¥
    @Before(value=&quot;execution(* com.&lt;secret&gt;.spring5.aopanno.User.uMethod())&quot;)
    public void before(){
        // å‰ç½®é€šçŸ¥
        System.out.println(&quot;before...&quot;);
    }
    // åç½®é€šçŸ¥ =&gt; æ–¹æ³•ä¹‹å =&gt; å¼‚å¸¸ä¹Ÿæ‰§è¡Œ
    @After(value=&quot;pointExtraction()&quot;) // é‡ç”¨åˆ‡å…¥ç‚¹å®šä¹‰
    public void after(){
        System.out.println(&quot;after...&quot;);
    }
    // è¿”å›é€šçŸ¥ =&gt; è¿”å›å€¼ä¹‹åæ‰§è¡Œ
    @AfterReturning(value=&quot;pointExtraction()&quot;)
    public void afterReturning(){
        System.out.println(&quot;afterReturning...&quot;);
    }
    @AfterThrowing(value=&quot;execution(* com.&lt;secret&gt;.spring5.aopanno.User.uMethod())&quot;)
    public void afterThrowing(){
        System.out.println(&quot;afterThrowing...&quot;);
    }
    // ç¯ç»•é€šçŸ¥
    @Around(value=&quot;execution(* com.&lt;secret&gt;.spring5.aopanno.User.uMethod())&quot;)
    public Object around(ProceedingJoinPoint proceedingJoinPoint) throws Throwable{
        System.out.println(&quot;around before...&quot;);
        Object ret = proceedingJoinPoint.proceed();
        System.out.println(&quot;around after...&quot;);
        return ret;
    }
}
</code></pre>
<p>ä»¥ä¸‹å¼€å¯ Spring å¯¹ AOP æ³¨è§£é©±åŠ¨çš„æ”¯æŒæ–¹å¼ä»»é€‰å…¶ä¸€å³å¯ã€‚</p>
<pre><code class="language-java">@Configuration
@ComponentScan(basePackages = {&quot;com.???&quot;})
@EnableAspectJAutoProxy(proxyTargetClass = true)
public class ConfigAop {}
</code></pre>
<pre><code class="language-xml">&lt;beans ...
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;
       xsi:schemaLocation=&quot;...
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
                           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;&gt;
    &lt;!-- å¼€å¯æ³¨è§£æ‰«æ --&gt;
    &lt;context:component-scan base-package=&quot;com.&lt;secret&gt;.spring5.aopanno&quot;&gt;&lt;/context:component-scan&gt;
    &lt;!-- å¼€å¯ Aspect ç”Ÿæˆä»£ç†å¯¹è±¡ --&gt;
    &lt;aop:aspectj-autoproxy&gt;&lt;/aop:aspectj-autoproxy&gt;
&lt;/beans&gt;
</code></pre>
<p>xml æ“ä½œ AspectJ è¿›è¡Œ AOP å¼€å‘ï¼š</p>
<pre><code class="language-java">// è¢«å¢å¼ºç±»
public class Coffee { public void drink(){ System.out.println(&quot;drinking coffee...&quot;); } }
// ä»£ç†å¢å¼ºç±»
public class CoffeeProxy { public void before(){ System.out.println(&quot;coffee with ice&quot;); } }
</code></pre>
<pre><code class="language-xml">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
                           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;&gt;
    &lt;!-- åˆ›å»ºå¯¹è±¡ --&gt;
    &lt;bean id=&quot;coffee&quot; class=&quot;com.&lt;secret&gt;.spring5.aopxml.Coffee&quot;&gt;&lt;/bean&gt;
    &lt;bean id=&quot;coffeeProxy&quot; class=&quot;com.&lt;secret&gt;.spring5.aopxml.CoffeeProxy&quot;&gt;&lt;/bean&gt;
    &lt;!-- é…ç½®aopå¢å¼º --&gt;
    &lt;aop:config&gt;
        &lt;!-- åˆ‡å…¥ç‚¹ --&gt;
        &lt;aop:pointcut id=&quot;p&quot; expression=&quot;execution(* com.???.spring5.aopxml.Coffee.drink(..))&quot;/&gt;
        &lt;!-- é…ç½®åˆ‡é¢ --&gt;
        &lt;aop:aspect ref=&quot;coffeeProxy&quot;&gt;
            &lt;!-- å¢å¼ºä½œç”¨åœ¨å…·ä½“çš„æ–¹æ³•ä¸Š --&gt;
            &lt;aop:before method=&quot;before&quot; pointcut-ref=&quot;p&quot;/&gt;
        &lt;/aop:aspect&gt;
    &lt;/aop:config&gt;
&lt;/beans&gt;
</code></pre>
<h3 id="underlying-principle">Underlying Principle</h3>
<p>AOP å·¥ä½œæµç¨‹ï¼š</p>
<ol>
<li>Spring å®¹å™¨å¯åŠ¨å¹¶è¯»å–æ‰€æœ‰åˆ‡é¢é…ç½® @Aspect ä¸­çš„åˆ‡å…¥ç‚¹ @Pointcut</li>
<li>åˆå§‹åŒ– bean å¹¶åˆ¤æ–­ bean å¯¹åº”çš„ç±»ä¸­æ–¹æ³•æ˜¯å¦åŒ¹é…åˆ°ä»»æ„åˆ‡å…¥ç‚¹
<ul>
<li>åŒ¹é…å¤±è´¥æ—¶ï¼Œè·å– bean å¹¶è°ƒç”¨æ–¹æ³•æ‰§è¡Œ</li>
<li>åŒ¹é…æˆåŠŸæ—¶ï¼Œåˆ›å»ºç›®æ ‡å¯¹è±¡çš„ä»£ç†å¯¹è±¡ï¼Œæ ¹æ®ä»£ç†å¯¹è±¡çš„è¿è¡Œæ¨¡å¼è¿è¡ŒåŸå§‹æ–¹æ³•ä¸å¢å¼ºçš„å†…å®¹</li>
</ul>
</li>
</ol>
<p>é€šè¿‡åŠ¨æ€ä»£ç†å¢å¼ºç±»çš„æ–¹æ³•ï¼š</p>
<ul>
<li>åœ¨æœ‰æ¥å£æƒ…å†µä¸‹ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ï¼šåˆ›å»ºæ¥å£å®ç°ç±»ä»£ç†å¯¹è±¡</li>
<li>åœ¨æ²¡æœ‰æ¥å£æƒ…å†µä¸‹ä½¿ç”¨ CGLIB åŠ¨æ€ä»£ç†ï¼šåˆ›å»ºå­ç±»çš„ä»£ç†å¯¹è±¡</li>
</ul>
<pre><code class="language-java">public interface UserDao {
    public int add(int a,int b);
    public String update(String str);
}
</code></pre>
<pre><code class="language-java">public class UserDaoImpl implements UserDao{
    @Override
    public int add(int a, int b) {
        System.out.println(&quot;addæ–¹æ³•æ‰§è¡Œäº†&quot;);
        return a+b;
    }

    @Override
    public String update(String str) {
        System.out.println(&quot;updateæ–¹æ³•æ‰§è¡Œäº†&quot;);
        return str;
    }
}
</code></pre>
<pre><code class="language-java">public class JDKProxy {
    public static void main(String[] args){
        Class[] interfaces = {UserDao.class};
        // åˆ›å»ºæ¥å£å®ç°ç±»çš„ä»£ç†å¯¹è±¡
        // ç¬¬ä¸‰å‚æ•°ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»
//        Proxy.newProxyInstance(JDKProxy.class.getClassLoader(), interfaces, new InvocationHandler() {
//            @Override
//            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
//                return null;
//            }
//        })
        UserDaoImpl userDao = new UserDaoImpl();
        // æ¥å£ç­‰äºå®ç°ç±»çš„ä»£ç†å¯¹è±¡
        UserDao dao = (UserDao)Proxy.newProxyInstance(JDKProxy.class.getClassLoader(),interfaces, new UserDaoProxy(userDao));
        int result = dao.add(1, 2);
        System.out.println(result);
    }
}

// åˆ›å»ºä»£ç†å¯¹è±¡ä»£ç 
class UserDaoProxy implements InvocationHandler{
    // åˆ›å»ºçš„æ˜¯è°çš„ä»£ç†å¯¹è±¡,å°±å°†è°ä¼ é€’è¿‡æ¥
    // æœ‰å‚æ„é€ ä¼ é€’
    private Object obj;
    public UserDaoProxy(Object obj){
        this.obj = obj;
    }
    // å¯¹è±¡ä¸€åˆ›å»º,æ–¹æ³•å°±è°ƒç”¨
    // å¢å¼ºçš„é€»è¾‘
    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        // æ–¹æ³•ä¹‹å‰
        System.out.println(&quot;æ–¹æ³•å‰æ‰§è¡Œ =&gt; &quot;+method.getName()+&quot; =&gt; ä¼ é€’å‚æ•° =&gt; &quot;+ Arrays.toString(args));
        // è¢«å¢å¼ºçš„æ–¹æ³•æ‰§è¡Œ
        Object res = method.invoke(obj, args);
        // æ–¹æ³•ä¹‹å
        System.out.println(&quot;æ–¹æ³•åæ‰§è¡Œ =&gt; &quot;+obj);
        return res;
    }
}
</code></pre>
<h3 id="aop-%E9%80%9A%E7%9F%A5%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE">AOP é€šçŸ¥è·å–æ•°æ®</h3>
<p>è·å–åˆ‡å…¥ç‚¹æ–¹æ³•çš„å‚æ•°ï¼š</p>
<ul>
<li>JointPontï¼šé€‚ç”¨äºå‰ç½®ã€åç½®ã€è¿”å›ã€æŠ›å‡ºå¼‚å¸¸åé€šçŸ¥</li>
<li>ProceedJointPointï¼šé€‚ç”¨äºç¯ç»•é€šçŸ¥</li>
</ul>
<p>è·å–åˆ‡å…¥ç‚¹æ–¹æ³•è¿”å›å€¼ï¼š</p>
<ul>
<li>@AfterReturning ä¸­ä½¿ç”¨ returningï¼ˆè¡¥å…… value å±æ€§ï¼‰</li>
<li>@Around æ ‡è®°çš„ç¯ç»•é€šçŸ¥ä¸­å¯ä»¥ç›´æ¥å¯¹åŸå§‹æ–¹æ³•è°ƒç”¨è·å–è¿”å›å€¼ç»“æœ</li>
</ul>
<p>è·å–åˆ‡å…¥ç‚¹å¼‚å¸¸ä¿¡æ¯ï¼š</p>
<ul>
<li>@AfterThrowing ä¸­ä½¿ç”¨ throwing å½¢å‚æ¥æ”¶å¼‚å¸¸å¯¹è±¡</li>
<li>@Around æ ‡è®°çš„ç¯ç»•é€šçŸ¥ä¸­ä½¿ç”¨ <code>try...catch</code> å¯¹ proceed å—è¿›è¡ŒåŒ…è£¹</li>
</ul>
<!--kg-card-end: markdown--><!--kg-card-begin: markdown--><h2 id="spring-%E4%BA%8B%E5%8A%A1%E6%93%8D%E4%BD%9C">Spring äº‹åŠ¡æ“ä½œ</h2>
<p>äº‹åŠ¡æœ¬èº«å¸¸ä½œç”¨ä¿éšœæ•°æ®åº“æ“ä½œçš„ä¸€è‡´æ€§ï¼ŒSpring äº‹åŠ¡å¯åœ¨ service å±‚æˆ– dao å±‚ä¸Šè¿›è¡Œå¼€å±•ã€‚</p>
<p>æ³¨è§£å¼äº‹åŠ¡å¯ä»¥æ·»åŠ åˆ°å…·ä½“çš„ä¸šåŠ¡æ–¹æ³•ä¸Šï¼Œä¹Ÿå¯ä»¥æ·»åŠ åˆ°æ¥å£ä¸Šæ¥è¡¨ç¤ºå½“å‰æ¥å£çš„æ‰€æœ‰æ–¹æ³•éƒ½å¼€å¯äº‹åŠ¡ã€‚</p>
<p>ä½¿ç”¨ Spring äº‹åŠ¡ç®¡ç†æ³¨è§£ @Transactional æ·»åŠ åœ¨ä¸šåŠ¡å±‚æ¥å£ä¸Šè€Œéä¸šåŠ¡å±‚å®ç°ç±»ä¸­ï¼ˆè§£è€¦ï¼‰ã€‚</p>
<pre><code class="language-java">public interface XxxService{
    @Transactional
    public void transfer(...)
}
</code></pre>
<p>è®¾ç½®äº‹åŠ¡ç®¡ç†å™¨ï¼šä½¿ç”¨ Spring æä¾›çš„æ ‡å‡†æ¥å£ PlatformTransactionManagerã€‚</p>
<pre><code class="language-java">// åˆ›å»ºäº‹åŠ¡ç®¡ç†å™¨å¯¹è±¡
@Bean
public PlatformTransactionManager transactionManager(DataSource dataSource){
    DataSourceTransactionManager dstm = new DataSourceTransactionManager();
    dstm.setDataSource(dataSource);
    return dstm;
}
</code></pre>
<h3 id="%E6%B3%A8%E8%A7%A3%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86">æ³¨è§£å£°æ˜å¼äº‹åŠ¡ç®¡ç†</h3>
<p>å£°æ˜å¼äº‹åŠ¡ç®¡ç†åº•å±‚ä½¿ç”¨ AOP åŸç†ï¼Œå…¶ API æ˜¯æ ¹æ®ä»£è¡¨äº‹åŠ¡ç®¡ç†å™¨çš„æ¥å£ï¼Œé’ˆå¯¹ä¸åŒæ¡†æ¶æä¾›çš„ä¸åŒå®ç°ç±» =&gt; PlatformTransactionManagerã€‚</p>
<pre><code class="language-java">@Configuration // @Configuration =&gt; ä»£è¡¨é…ç½®ç±»
@ComponentScan(basePackages = &quot;com.&lt;secret&gt;.spring5.txdemo&quot;) // @ComponentScan =&gt; ç»„ä»¶æ‰«æ
@EnableTransactionManagement // @EnableTransactionManagement =&gt; å¼€å¯äº‹åŠ¡
public class TxConfig {
    // åˆ›å»ºæ•°æ®åº“è¿æ¥æ± 
    @Bean
    public DruidDataSource getDuridDataSource(){
        DruidDataSource dataSource = new DruidDataSource();
        dataSource.setDriverClassName(&quot;com.mysql.cj.jdbc.Driver&quot;);
        dataSource.setUrl(&quot;jdbc:mysql://localhost:3306/user_db&quot;);
        dataSource.setUsername(&quot;&lt;username&gt;&quot;);
        dataSource.setPassword(&quot;&lt;password&gt;&quot;);
        return dataSource;
    }
    // åˆ›å»ºjdbcæ¨¡æ¿å¯¹è±¡
    @Bean
    public JdbcTemplate getJdbcTemplate(DataSource dataSource){
        JdbcTemplate jdbcTemplate = new JdbcTemplate();
        // æ³¨å…¥ dataSource
        // IOC å®¹å™¨å·²å­˜åœ¨ dataSource å¯¹è±¡,æ ¹æ®ç±»å‹æ‰¾åˆ° dataSource å¯¹è±¡æ¯”åˆ›å»ºå¯¹è±¡æ›´å¥½
        // jdbcTemplate.setDataSource(getDuridDataSource());
        jdbcTemplate.setDataSource(dataSource);
        return jdbcTemplate;
    }
    // åˆ›å»ºäº‹åŠ¡ç®¡ç†å™¨å¯¹è±¡
    @Bean
    public DataSourceTransactionManager getDataSourceTransactionManager(DataSource dataSource){
        DataSourceTransactionManager transactionManager = new DataSourceTransactionManager();
        transactionManager.setDataSource(dataSource);
        return transactionManager;
    }
}
</code></pre>
<pre><code class="language-html">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
                           http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd
&quot;&gt;
    &lt;!-- å¼€å¯ç»„ä»¶æ‰«æ --&gt;
    &lt;context:component-scan base-package=&quot;com.&lt;secret&gt;.spring5.txdemo&quot;&gt;&lt;/context:component-scan&gt;
    &lt;!-- æ•°æ®åº“è¿æ¥æ±  --&gt;
    &lt;bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot; destroy-method=&quot;close&quot;&gt;
        &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/{yourdb}&quot; /&gt;
        &lt;property name=&quot;username&quot; value={yourusername} /&gt;
        &lt;property name=&quot;password&quot; value={yourpassword} /&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot; /&gt;
    &lt;/bean&gt;
    &lt;!-- jdbctemplateå¯¹è±¡ --&gt;
    &lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;
        &lt;!-- æ³¨å…¥datasource --&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;
    &lt;!-- åˆ›å»ºäº‹åŠ¡ç®¡ç†å™¨ --&gt;
    &lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
        &lt;!-- æ³¨å…¥æ•°æ®æº =&gt; æŒ‡å®šå¯¹å“ªä¸ªæ•°æ®åº“è¿›è¡Œäº‹åŠ¡ç®¡ç† --&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;
    &lt;!-- å¼€å¯äº‹åŠ¡æ³¨è§£ =&gt; æŒ‡å®šå“ªä¸ªäº‹åŠ¡ç®¡ç†å™¨å¼€å¯ --&gt;
    &lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot;&gt;&lt;/tx:annotation-driven&gt;
&lt;/beans&gt;
</code></pre>
<p>äº‹åŠ¡æ–¹æ³•å³å¯¹æ•°æ®åº“è¡¨æ•°æ®è¿›è¡Œå˜åŒ–çš„æ“ä½œã€‚æœ‰æˆ–æ— äº‹åŠ¡çš„æ–¹æ³•äº’ç›¸è°ƒç”¨çš„æ“ä½œè¿‡ç¨‹ç§°ä¸ºäº‹åŠ¡ä¼ æ’­è¡Œä¸ºã€‚<a href="https://www.baeldung.com/spring-transactional-propagation-isolation">äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º</a>å¯ä»¥ç”±ä¼ æ’­å±æ€§æŒ‡å®šã€‚</p>
<p>å¸¸è§çš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼š</p>
<ul>
<li>REQUIRED
<ul>
<li>æœ‰äº‹åŠ¡çš„ A æ–¹æ³•è°ƒç”¨æ— äº‹åŠ¡æ–¹æ³• B åï¼ŒB æ–¹æ³•ä½¿ç”¨ A æ–¹æ³•ä¸­äº‹åŠ¡</li>
<li>æ— äº‹åŠ¡ A æ–¹æ³•è°ƒç”¨æ— äº‹åŠ¡çš„ B æ–¹æ³•åï¼Œåˆ›å»ºæ–°äº‹åŠ¡</li>
</ul>
</li>
<li>REQUIRED_NEW
<ul>
<li>A æ–¹æ³•è°ƒç”¨æ— äº‹åŠ¡çš„æ–¹æ³• Bï¼Œä¸è®ºæ–¹æ³• A æ˜¯å¦æœ‰äº‹åŠ¡éƒ½åˆ›å»ºæ–°äº‹åŠ¡</li>
</ul>
</li>
</ul>
<pre><code class="language-java">@Service
// å¯ä»¥åŠ åœ¨ç±»ä¸Šæˆ–æ–¹æ³•ä¸Š =&gt; å‰è€…è¡¨ç¤ºæ‰€æœ‰æ–¹æ³•éƒ½æ·»åŠ ä¸Šäº†äº‹åŠ¡,åè€…åªæ˜¯æ­¤æ–¹æ³•æ·»åŠ äº‹åŠ¡.
// é»˜è®¤ä¼ æ’­è¡Œä¸ºå°±æ˜¯propagation.REQUIRED
// mysql é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯ REPEATABLE_READ
@Transactional(propagation = Propagation.REQUIRED,isolation = Isolation.REPEATABLE_READ,timeout = -1)
public class UserService {}
</code></pre>
<p>å¸¸è§çš„äº‹åŠ¡ç›¸å…³é…ç½®ï¼š</p>
<ul>
<li>rollbackFor è®¾ç½®äº‹åŠ¡å›æ»šå¼‚å¸¸ï¼Œè§£å†³éƒ¨åˆ†å¼‚å¸¸ä¸å›æ»šçš„æƒ…å†µ</li>
</ul>
<p>Spring åœ¨é‡è§ Error å’Œ Runtime å¼‚å¸¸æ—¶æ‰ä¼šå›æ»šï¼ŒIO å¼‚å¸¸ä¸ä¼šè¿›è¡Œå›æ»šã€‚</p>
<pre><code class="language-java">if(true) {throw new IOException();} // äº‹åŠ¡ä¸ç”Ÿæ•ˆ
</code></pre>
<p>åœ¨ @Transactional ä¸­è®¾ç½® <code>rollbackFor = {IOException.class}</code> è¿›è¡Œå›æ»šã€‚</p>
<pre><code class="language-java">@Transactional(rollbackFor = {IOException.class})
</code></pre>
<p>äº‹åŠ¡çš„éš”ç¦»æ€§æ˜¯ä¸ºè§£å†³åœ¨å¹¶å‘æ“ä½œä¸­äº§ç”Ÿçš„è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ç­‰é—®é¢˜ã€‚è„è¯»æ˜¯ä¸€ä¸ªæœªæäº¤çš„äº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡çš„æ•°æ®ï¼›ä¸å¯é‡å¤è¯»è¡¨ç¤ºä¸€ä¸ªæœªæäº¤çš„äº‹åŠ¡è¯»å–åˆ°äº†å¦ä¸€ä¸ªæäº¤äº†äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®ï¼ˆæ•°æ®ä¸å‡†ç¡®ï¼‰ï¼›å¹»è¯»æ˜¯ä¸€ä¸ªæœªæäº¤äº‹åŠ¡è¯»å–åˆ°äº†å¦ä¸€ä¸ªæäº¤äº‹åŠ¡æ·»åŠ çš„æ•°æ®ã€‚</p>
<p>äº‹åŠ¡éœ€åœ¨è¶…æ—¶æ—¶é—´ timeout å†…è¿›è¡Œæäº¤ï¼Œå¦åˆ™å›æ»šï¼Œé»˜è®¤å€¼ -1ã€‚</p>
<p>æ˜¯å¦åªè¯» readOnly æŒ‡æ˜¯å¦å¯åœ¨æŸ¥è¯¢çš„åŸºç¡€ä¸Šè¿›è¡Œæ·»åŠ ä¿®æ”¹ï¼Œé»˜è®¤ä¸º falseã€‚</p>
<p>å›æ»š rollbackFor è®¾ç½®å‡ºç°å“ªäº›å¼‚å¸¸è¿›è¡Œäº‹åŠ¡å›æ»šï¼›ä¸å›æ»š noRollBackFor è®¾ç½®å‡ºç°å“ªäº›å¼‚å¸¸ä¸è¿›è¡Œäº‹åŠ¡å›æ»šã€‚</p>
<h3 id="xml-%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86">XML å£°æ˜å¼äº‹åŠ¡ç®¡ç†</h3>
<p>é…ç½®äº‹åŠ¡ç®¡ç†å™¨ï¼Œé…ç½®é€šçŸ¥ï¼Œé…ç½®åˆ‡å…¥ç‚¹ä¸åˆ‡é¢ã€‚</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;
       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
                           http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd
                           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd
&quot;&gt;
    &lt;!-- å¼€å¯ç»„ä»¶æ‰«æ --&gt;
    &lt;context:component-scan base-package=&quot;com.&lt;secret&gt;.spring5.txdemo&quot;&gt;&lt;/context:component-scan&gt;
    &lt;!-- æ•°æ®åº“è¿æ¥æ±  --&gt;
    &lt;bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot; destroy-method=&quot;close&quot;&gt;
        &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/user_db&quot; /&gt;
        &lt;property name=&quot;username&quot; value=&quot;&lt;username&gt;&quot; /&gt;
        &lt;property name=&quot;password&quot; value=&quot;&lt;password&gt;&quot;/&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;
    &lt;/bean&gt;
    &lt;!-- jdbctemplateå¯¹è±¡ --&gt;
    &lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;
        &lt;!-- æ³¨å…¥datasource --&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;
    &lt;!-- åˆ›å»ºäº‹åŠ¡ç®¡ç†å™¨ --&gt;
    &lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
        &lt;!-- æ³¨å…¥æ•°æ®æº =&gt; æŒ‡å®šå¯¹å“ªä¸ªæ•°æ®åº“è¿›è¡Œäº‹åŠ¡ç®¡ç† --&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;
    &lt;!-- é…ç½®é€šçŸ¥ --&gt;
    &lt;tx:advice id=&quot;txadvice&quot;&gt;
        &lt;!-- é…ç½®äº‹åŠ¡ç›¸å…³å‚æ•° --&gt;
        &lt;tx:attributes&gt;
            &lt;!-- æŒ‡å®šå“ªç§è§„åˆ™çš„æ–¹æ³•ä¸Šæ·»åŠ äº‹åŠ¡ --&gt;
            &lt;!-- &lt;tx:method name=&quot;account*&quot;/&gt; --&gt;
            &lt;tx:method name=&quot;accountMoney&quot; propagation=&quot;REQUIRED&quot;&gt;&lt;/tx:method&gt;
        &lt;/tx:attributes&gt;
    &lt;/tx:advice&gt;
    &lt;!-- é…ç½®åˆ‡å…¥ç‚¹å’Œåˆ‡é¢ --&gt;
    &lt;aop:config&gt;
        &lt;!-- é…ç½®åˆ‡å…¥ç‚¹ --&gt;
        &lt;aop:pointcut id=&quot;pt&quot; expression=&quot;execution(* com.&lt;secret&gt;.spring5.txdemo.service.UserService.*(..))&quot;/&gt;
        &lt;!-- é…ç½®åˆ‡é¢ =&gt; äº‹åŠ¡åŠ åˆ°å…·ä½“æ–¹æ³•ä¸Š --&gt;
        &lt;aop:advisor advice-ref=&quot;txadvice&quot; pointcut-ref=&quot;pt&quot;&gt;&lt;/aop:advisor&gt;
    &lt;/aop:config&gt;
&lt;/beans&gt;
</code></pre>
<!--kg-card-end: markdown--><!--kg-card-begin: markdown--><h2 id="spring5-%E6%96%B0%E7%89%B9%E6%80%A7-%E5%85%B6%E4%BB%96">Spring5 æ–°ç‰¹æ€§ &amp; å…¶ä»–</h2>
<p>Spring5 æ¡†æ¶åŸºäº Java8 å®ç°ï¼Œè¿è¡Œæ—¶å…¼å®¹ JDK9ã€‚å…¶è‡ªå¸¦é€šç”¨æ—¥å¿—çš„å°è£…ï¼Œå·²ç§»é™¤ Log4jConfigListenerï¼Œå»ºè®®ä½¿ç”¨ Log4j2ã€‚</p>
<h3 id="log4j2">Log4j2</h3>
<ul>
<li>å¼•å…¥ jar åŒ…</li>
</ul>
<pre><code>log4j-api-2.11.2.jar
log4j-core-2.11.2.jar
log4j-slf4j-impl-2.11.2.jar
slf4j-api-1.7.30.jar
</code></pre>
<ul>
<li>åˆ›å»º Log4j2.xml é…ç½®æ–‡ä»¶</li>
</ul>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!--æ—¥å¿—çº§åˆ«ä»¥åŠä¼˜å…ˆçº§æ’åº: OFF &gt; FATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE &gt; ALL --&gt;
&lt;!--Configurationåé¢çš„statusç”¨äºè®¾ç½®log4j2è‡ªèº«å†…éƒ¨çš„ä¿¡æ¯è¾“å‡ºï¼Œå¯ä»¥ä¸è®¾ç½®ï¼Œå½“è®¾ç½®æˆtraceæ—¶ï¼Œå¯ä»¥çœ‹åˆ°log4j2å†…éƒ¨å„ç§è¯¦ç»†è¾“å‡º--&gt;
&lt;configuration status=&quot;DEBUG&quot;&gt;
    &lt;!--å…ˆå®šä¹‰æ‰€æœ‰çš„appender--&gt;
    &lt;appenders&gt;
        &lt;!--è¾“å‡ºæ—¥å¿—ä¿¡æ¯åˆ°æ§åˆ¶å°--&gt;
        &lt;console name=&quot;Console&quot; target=&quot;SYSTEM_OUT&quot;&gt;
            &lt;!--æ§åˆ¶æ—¥å¿—è¾“å‡ºçš„æ ¼å¼--&gt;
            &lt;PatternLayout pattern=&quot;%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n&quot;/&gt;
        &lt;/console&gt;
    &lt;/appenders&gt;
    &lt;!--ç„¶åå®šä¹‰loggerï¼Œåªæœ‰å®šä¹‰äº†loggerå¹¶å¼•å…¥çš„appenderï¼Œappenderæ‰ä¼šç”Ÿæ•ˆ--&gt;
    &lt;!--rootï¼šç”¨äºæŒ‡å®šé¡¹ç›®çš„æ ¹æ—¥å¿—ï¼Œå¦‚æœæ²¡æœ‰å•ç‹¬æŒ‡å®šLoggerï¼Œåˆ™ä¼šä½¿ç”¨rootä½œä¸ºé»˜è®¤çš„æ—¥å¿—è¾“å‡º--&gt;
    &lt;loggers&gt;
        &lt;root level=&quot;info&quot;&gt;
            &lt;appender-ref ref=&quot;Console&quot;/&gt;
        &lt;/root&gt;
    &lt;/loggers&gt;
&lt;/configuration&gt;
</code></pre>
<ul>
<li>æ‰‹åŠ¨è¾“å‡ºæ—¥å¿—</li>
</ul>
<pre><code class="language-java">public class UserLog {
    private static final Logger log = LoggerFactory.getLogger(UserLog.class);
    public static void main(String[] args) {
        log.info(&quot;hello log4j2&quot;);
        log.warn(&quot;hello log4j2&quot;);
    }
}
</code></pre>
<h3 id="nullable-%E6%B3%A8%E8%A7%A3">@Nullable æ³¨è§£</h3>
<p>@Nullable æ³¨è§£å¯ä»¥ä½¿ç”¨åœ¨æ–¹æ³•ã€å±æ€§ã€å‚æ•°ä¸Šï¼Œåˆ†åˆ«è¡¨ç¤ºæ–¹æ³•è¿”å›å¯ä»¥ä¸ºç©ºã€å±æ€§å€¼å¯ä»¥ä¸ºç©ºã€å‚æ•°å€¼å¯ä»¥ä¸ºç©ºï¼Œå¸¸ç”¨æ¥é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</p>
<h3 id="%E5%87%BD%E6%95%B0%E5%BC%8F%E9%A3%8E%E6%A0%BC">å‡½æ•°å¼é£æ ¼</h3>
<p>Spring5 åˆ›å»ºä¸€ä¸ªç±»çš„å¯¹è±¡å¯ä»¥ä½¿ç”¨æ³¨è§£æˆ–è€…é…ç½®æ–‡ä»¶ï¼Œè‹¥æ˜¯æ‰‹åŠ¨ new å¯¹è±¡è¿˜éœ€è¦åœ¨ Spring ä¸­è¿›è¡Œæ³¨å†Œã€‚æ–°ç‰¹æ€§æ”¯æŒå‡½æ•°å¼é£æ ¼åˆ›å»ºå¯¹è±¡ï¼Œäº¤ç»™ Spring ç®¡ç†ã€‚</p>
<pre><code class="language-java">public class GACACAC {
    @Test
    public void testGACAC(){
        // åˆ›å»º GenericApplicationContext
        GenericApplicationContext ctx = new GenericApplicationContext();
        // è°ƒç”¨contextæ–¹æ³•å¯¹è±¡æ³¨å†Œ
        ctx.refresh();
        // new å‡ºæ¥çš„å¯¹è±¡ä¼šåœ¨ spring5 å®Œæˆæ³¨å†Œ
        ctx.registerBean(&quot;personName&quot;,Person.class,()-&gt;new Person());
        // è·å–æ³¨å†Œçš„å¯¹è±¡
        // Person p = (Person)ctx.getBean(&quot;com.&lt;secret&gt;.spring5.txdemo.test.Person&quot;);
        Person p = (Person)ctx.getBean(&quot;personName&quot;);
        System.out.println(p);
    }
}
</code></pre>
<h3 id="%E6%95%B4%E5%90%88-junit45">æ•´åˆ JUnit4|5</h3>
<ul>
<li>å¼•å…¥ Spring é’ˆå¯¹æµ‹è¯•ä¾èµ–</li>
</ul>
<pre><code>spring-test-5.2.6.RELEASE.jar
</code></pre>
<ul>
<li>åˆ›å»ºæµ‹è¯•ç±»ï¼Œä½¿ç”¨æ³¨è§£æ–¹å¼å®Œæˆ</li>
</ul>
<pre><code class="language-java">// JUnit4
@RunWith(SpringJUnit4ClassRunner.class) // æŒ‡å®šå•å…ƒæµ‹è¯•æ¡†æ¶ç‰ˆæœ¬
@ContextConfiguration(&quot;classpath:xmlDeclarativeTxManager.xml&quot;) // åŠ è½½é…ç½®æ–‡ä»¶
public class JTest4 {
    @Autowired
    private UserService userService;
    @Test
    public void test1(){
        userService.accountMoney();
    }
}
// ---
// JUnit5
// éœ€å¼•å…¥ JUnit5 çš„ jar åŒ… =&gt; import org.junit.jupiter.api.Test;
// @ExtendWith(SpringExtension.class) // æ³¨è§£å¼•ç”¨
// @ContextConfiguration(&quot;classpath:xmlDeclarativeTxManager.xml&quot;)
@SpringJUnitConfig(locations = &quot;classpath:xmlDeclarativeTxManager.xml&quot;) // å¤åˆæ³¨è§£
public class JTest5 {
    @Autowired
    private UserService userService;
    @Test
    public void test1(){
        userService.accountMoney();
    }
}
</code></pre>
<h3 id="jdbctemplate">JdbcTemplate</h3>
<p>Spring å°è£… Template å½¢å¼çš„æ¨¡æ¿ç±»ï¼Œä¾¿äºæ“ä½œ Redisã€Mysql ç­‰æ•°æ®åº“ã€‚Service é€šå¸¸å­˜æ”¾ä¸šåŠ¡æ“ä½œï¼Œdao åˆ™å­˜æ”¾æ•°æ®åº“æ“ä½œï¼Œä¸å†™ä¸šåŠ¡ã€‚service æ³¨å…¥ daoï¼Œdao æ³¨å…¥ jdbctemplateï¼Œjdbctemplate æ³¨å…¥ DataSourceã€‚</p>
<pre><code class="language-java">druid-1.1.9.jar
mysql-connector-java-8.0.29.jar
spring-jdbc-5.2.6.RELEASE-sources.jar
spring-tx-5.2.6.RELEASE-sources.jar
spring-orm-5.2.6.RELEASE.jar // æ•´åˆå…¶ä»–æ¡†æ¶ mybatis hibernate
</code></pre>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;
    &lt;!-- å¼€å¯ç»„ä»¶æ‰«æ --&gt;
    &lt;context:component-scan base-package=&quot;com.&lt;secret&gt;.spring5&quot;&gt;&lt;/context:component-scan&gt;
    &lt;!-- æ•°æ®åº“è¿æ¥æ±  --&gt;
    &lt;bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot; destroy-method=&quot;close&quot;&gt;
        &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/user_db&quot; /&gt;
        &lt;property name=&quot;username&quot; value=&quot;&lt;username&gt;&quot; /&gt;
        &lt;property name=&quot;password&quot; value=&quot;&lt;password&gt;&quot;/&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;
    &lt;/bean&gt;
    &lt;!-- jdbctemplateå¯¹è±¡ --&gt;
    &lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;
        &lt;!-- æ³¨å…¥datasource =&gt; set æ–¹æ³•æ³¨å…¥ --&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre>
<pre><code class="language-java">public class Book {
    private String userId;
    private String username;
    private String ustatus;
    @Override
    public String toString() {...}
    &lt;GETTER...&gt;
    &lt;SETTER...&gt;
}
</code></pre>
<pre><code class="language-java">@Service
public class BookService {
    // æ³¨å…¥DAO
    @Autowired
    private BookDao bookDao;
    // æ·»åŠ æ–¹æ³•
    public void addBook(Book book){ bookDao.add(book); }
    // ä¿®æ”¹æ–¹æ³•
    public void updateBook(Book book){bookDao.updateBook(book); }
    // åˆ é™¤æ–¹æ³•
    public void deleteBook(String id){ bookDao.deleteBook(id); }
    // æŸ¥è¯¢è¡¨è®°å½•æ•°
    public int findCount(){ return bookDao.selectCount(); }
    // æŸ¥è¯¢è¡¨è®°å½•
    public Book findOne(String id){ return bookDao.findBookInfo(id); }
    // æŸ¥è¯¢è¿”å›é›†åˆ
    public List&lt;Book&gt; findAll(){ return bookDao.findAllBook(); }
    // æ‰¹é‡æ·»åŠ 
    public void batchAdd(List&lt;Object[]&gt; batchArgs){ bookDao.batchAddBook(batchArgs); }
    // æ‰¹é‡ä¿®æ”¹
    public void batchUpdate(List&lt;Object[]&gt; batchArgs){ bookDao.batchUpdateBook(batchArgs); }
    // æ‰¹é‡åˆ é™¤
    public void batchDelete(List&lt;Object[]&gt; batchArgs){ bookDao.batchDeleteBook(batchArgs); }
}
</code></pre>
<pre><code class="language-java">public interface BookDao {
    // æ·»åŠ çš„æ–¹æ³•
    void add(Book book);
    void updateBook(Book book);
    void deleteBook(String id);
    int selectCount();
    Book findBookInfo(String id);
    List&lt;Book&gt; findAllBook();
    void batchAddBook(List&lt;Object[]&gt; batchArgs);
    void batchUpdateBook(List&lt;Object[]&gt; batchArgs);
    void batchDeleteBook(List&lt;Object[]&gt; batchArgs);
}
</code></pre>
<pre><code class="language-java">@Repository
public class BookDaoImpl implements BookDao{
    // æ³¨å…¥JDBC
    @Autowired
    private JdbcTemplate jdbcTemplate;

    @Override
    public void add(Book book) {
        // è°ƒç”¨jdbc templateä¸­çš„updateæ–¹æ³•å®ç°æ·»åŠ æ“ä½œ
        String sql = &quot;INSERT INTO t_book VALUES(?,?,?)&quot;;
        Object[] args = {book.getUserId(), book.getUsername(), book.getUstatus()};
        int update = jdbcTemplate.update(sql,args);
        System.out.println(update);
    }

    @Override
    public void updateBook(Book book) {
        String sql = &quot;UPDATE t_book SET username=?,ustatus=? WHERE user_id=?&quot;;
        Object[] args = {book.getUsername(), book.getUstatus(),book.getUserId()};
        int update = jdbcTemplate.update(sql,args);
        System.out.println(update);
    }

    @Override
    public void deleteBook(String id) {
        String sql = &quot;DELETE FROM t_book WHERE user_id = ?&quot;;
        int update = jdbcTemplate.update(sql, id);
        System.out.println(update);
    }

    // æŸ¥è¯¢è¡¨ä¸­çš„è®°å½•æ•°
    @Override
    public int selectCount() {
        String sql = &quot;SELECT COUNT(*) FROM t_book&quot;;
        Integer count = jdbcTemplate.queryForObject(sql, Integer.class);
        return count;
    }

    @Override
    public Book findBookInfo(String id) {
        String sql = &quot;SELECT * FROM t_book WHERE user_id=?&quot;;
        // RowMapperæ˜¯ä¸åŒç±»å‹çš„æ¥å£,ä½¿ç”¨æ­¤æ¥å£å®ç°ç±»å®Œæˆæ•°æ®çš„å°è£…
        Book book = jdbcTemplate.queryForObject(sql, new BeanPropertyRowMapper&lt;Book&gt;(Book.class), id);
        return book;
    }

    @Override
    public List&lt;Book&gt; findAllBook() {
        String sql = &quot;SELECT * FROM t_book&quot;;
        List&lt;Book&gt; list = jdbcTemplate.query(sql, new BeanPropertyRowMapper&lt;Book&gt;(Book.class));
        return list;
    }

    @Override
    public void batchAddBook(List&lt;Object[]&gt; batchArgs) {
        String sql = &quot;INSERT INTO t_book VALUES(?,?,?)&quot;;
        int[] ints = jdbcTemplate.batchUpdate(sql,batchArgs);
        System.out.println(Arrays.toString(ints));
    }

    @Override
    public void batchUpdateBook(List&lt;Object[]&gt; batchArgs) {
        String sql = &quot;UPDATE t_book SET username=?,ustatus=? WHERE user_id=?&quot;;
        int[] ints = jdbcTemplate.batchUpdate(sql, batchArgs);
        System.out.println(ints);
    }

    @Override
    public void batchDeleteBook(List&lt;Object[]&gt; batchArgs) {
        String sql = &quot;DELETE FROM t_book WHERE user_id = ?&quot;;
        int[] ints = jdbcTemplate.batchUpdate(sql, batchArgs);
        System.out.println(Arrays.toString(ints));
    }
}
</code></pre>
<pre><code class="language-java">public class TestBook {
    @Test
    public void testAdd(){
        ApplicationContext context = new ClassPathXmlApplicationContext(&quot;jdbcTemp1.xml&quot;);
        BookService bookService = context.getBean(&quot;bookService&quot;, BookService.class);
        // æ·»åŠ 
        Book book = new Book();
        book.setUserId(&quot;1&quot;);
        book.setUsername(&quot;java&quot;);
        book.setUstatus(&quot;a&quot;);
        bookService.addBook(book);
    }
    @Test
    public void testUpdate(){
        ApplicationContext context = new ClassPathXmlApplicationContext(&quot;jdbcTemp1.xml&quot;);
        BookService bookService = context.getBean(&quot;bookService&quot;, BookService.class);
        // ä¿®æ”¹
        Book book = new Book();
        book.setUserId(&quot;1&quot;);
        book.setUsername(&quot;java&quot;);
        book.setUstatus(&quot;zs&quot;);
        bookService.updateBook(book);
    }
    @Test
    public void testDel(){
        ApplicationContext context = new ClassPathXmlApplicationContext(&quot;jdbcTemp1.xml&quot;);
        BookService bookService = context.getBean(&quot;bookService&quot;, BookService.class);
        // åˆ é™¤
        bookService.deleteBook(&quot;1&quot;);
    }
    @Test
    public void testFindCount(){
        ApplicationContext context = new ClassPathXmlApplicationContext(&quot;jdbcTemp1.xml&quot;);
        BookService bookService = context.getBean(&quot;bookService&quot;, BookService.class);
        // åˆ é™¤
        int count = bookService.findCount();
        System.out.println(count);
        System.out.println(count);
    }
    // æµ‹è¯•æŸ¥è¯¢è¿”å›å¯¹è±¡
    @Test
    public void testFindOne(){
        ApplicationContext context = new ClassPathXmlApplicationContext(&quot;jdbcTemp1.xml&quot;);
        BookService bookService = context.getBean(&quot;bookService&quot;, BookService.class);
        Book one = bookService.findOne(&quot;1&quot;);
        System.out.println(one);
    }

    @Test
    public void testfindAllBook(){
        ApplicationContext context = new ClassPathXmlApplicationContext(&quot;jdbcTemp1.xml&quot;);
        BookService bookService = context.getBean(&quot;bookService&quot;, BookService.class);
        List&lt;Book&gt; all = bookService.findAll();
        System.out.println(all);
    }
    @Test
    public void testAddBatchBooks(){
        ApplicationContext context = new ClassPathXmlApplicationContext(&quot;jdbcTemp1.xml&quot;);
        BookService bookService = context.getBean(&quot;bookService&quot;, BookService.class);
        List&lt;Object[]&gt; batchArgs = new ArrayList&lt;&gt;();
        Object[] o1 = {&quot;2&quot;,&quot;javascript&quot;,&quot;ok&quot;};
        Object[] o2 = {&quot;3&quot;,&quot;nodejs&quot;,&quot;okk&quot;};
        Object[] o3 = {&quot;4&quot;,&quot;C++&quot;,&quot;okkk&quot;};
        batchArgs.add(o1);
        batchArgs.add(o2);
        batchArgs.add(o3);
        bookService.batchAdd(batchArgs);
    }
    @Test
    public void testUpdateBatchBooks(){
        ApplicationContext context = new ClassPathXmlApplicationContext(&quot;jdbcTemp1.xml&quot;);
        BookService bookService = context.getBean(&quot;bookService&quot;, BookService.class);
        List&lt;Object[]&gt; batchArgs = new ArrayList&lt;&gt;();
        Object[] o1 = {&quot;javascript&quot;,&quot;yes&quot;,&quot;2&quot;};
        Object[] o2 = {&quot;nodejs&quot;,&quot;ok&quot;,&quot;3&quot;};
        Object[] o3 = {&quot;C++&quot;,&quot;okk&quot;,&quot;4&quot;};
        batchArgs.add(o1);
        batchArgs.add(o2);
        batchArgs.add(o3);
        bookService.batchUpdate(batchArgs);
    }
    @Test
    public void testDeleteBatchBooks(){
        ApplicationContext context = new ClassPathXmlApplicationContext(&quot;jdbcTemp1.xml&quot;);
        BookService bookService = context.getBean(&quot;bookService&quot;, BookService.class);
        List&lt;Object[]&gt; batchArgs = new ArrayList&lt;&gt;();
        Object[] o1 = {&quot;4&quot;};
        batchArgs.add(o1);
        bookService.batchDelete(batchArgs);
    }
}
</code></pre>
<!--kg-card-end: markdown--><!--kg-card-begin: markdown--><h2 id="bugs-%E8%A7%A3%E5%86%B3">Bugs è§£å†³</h2>
<ul>
<li>BeanDefinitionStoreException</li>
</ul>
<pre><code class="language-java">// æŠ¥é”™åŸæ–‡
org.springframework.beans.factory.BeanDefinitionStoreException: Unexpected exception parsing XML document from class path resource.
</code></pre>
<p>åœ¨å¼€å¯ç»„ä»¶æ‰«æçš„ base-package ä¸‹ï¼Œæ˜¯å¦å­˜åœ¨å¤šä¸ªéœ€è¦æ‰«æçš„æ–‡ä»¶ã€‚è‹¥å­˜åœ¨åˆ™éœ€è¦è¿›ä¸€æ­¥ç¼©å°æ‰«æèŒƒå›´ã€‚</p>
<ul>
<li>Exception encountered during context initialization</li>
</ul>
<pre><code class="language-java">// æŠ¥é”™åŸæ–‡
WARNING: Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'xxxService': Unsatisfied dependency expressed through field 'xxxDao';
</code></pre>
<p>åœ¨æµ‹è¯•ç±»ä¸­è¿›è¡Œè¿›ä¸€æ­¥éªŒè¯ï¼›æ¦‚ç‡æ€§åŠ è½½ xml æ–‡ä»¶é”™è¯¯ã€‚</p>
<ul>
<li>UnsatisfiedDependencyException</li>
</ul>
<pre><code class="language-java">org.springframework.context.support.AbstractApplicationContext refresh
WARNING: Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userDaoImpl': Unsatisfied dependency expressed through field 'jdbcTemplate'; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'getJdbcTemplate' defined in com.&lt;secret&gt;.spring5.txdemo.config.TxConfig: Unsatisfied dependency expressed through method 'getJdbcTemplate' parameter 0; nested exception is org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'javax.sql.DataSource' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
</code></pre>
<!--kg-card-end: markdown--><!--kg-card-begin: markdown--><h2 id="%E7%BB%93%E6%9D%9F">ç»“æŸ</h2>
<p>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨<a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh"> CC BY-SA 4.0 </a>åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
<!--kg-card-end: markdown-->
    </section>


    <section class="article-comments gh-canvas">
        
        <div id="disqus_thread"></div>
        <script>
            var disqus_config = function () {
                this.page.url = "yourdomain.com/spring5/";
                this.page.identifier = "ghost-628a557765e85e35e1c23b44"
            };
            (function() {
            var d = document, s = d.createElement('script');
            s.src = 'https://zsxzy.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
            })();
        </script>
    </section>
</article>
</main>

    <section class="footer-cta outer">
        <div class="inner">
            <h2 class="footer-cta-title">Sign up for more like this.</h2>
            <a class="footer-cta-button" href="index.html#/portal" data-portal>
                <div class="footer-cta-input">Enter your email</div>
                <span>Subscribe</span>
            </a>
        </div>
    </section>



            <aside class="read-more-wrap outer">
                <div class="read-more inner">
                        
<article class="post-card post">

    <a class="post-card-image-link" href="../g-toc-css/index.html">

        <img class="post-card-image"
            srcset="../content/images/size/w600/2022/04/SLAMDUNK.png 600w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="../content/images/size/w600/2022/04/SLAMDUNK.png"
            alt="SLAM DUNK"
            loading="lazy"
        />


    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../g-toc-css/index.html">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    G&amp;TOC&amp;CSS
                </h2>
            </header>
                <div class="post-card-excerpt">TOC çš„éœ€æ±‚å®ç°ä»¥åŠç›¸å…³çš„æ€è€ƒæ€»ç»“ã€‚</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2022-05-01">May 1, 2022</time>
                <span class="post-card-meta-length">6 min read</span>
        </footer>

    </div>

</article>
                        
<article class="post-card post">

    <a class="post-card-image-link" href="../mysqlnote/index.html">

        <img class="post-card-image"
            srcset="../content/images/size/w600/2022/04/cloud.jpg 600w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="../content/images/size/w600/2022/04/cloud.jpg"
            alt="mysql"
            loading="lazy"
        />


    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../mysqlnote/index.html">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    MySQL ç¬”è®°
                </h2>
            </header>
                <div class="post-card-excerpt">MYSQL åŸºç¡€ç¯‡</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2021-12-22">Dec 22, 2021</time>
                <span class="post-card-meta-length">82 min read</span>
        </footer>

    </div>

</article>
                        
<article class="post-card post">

    <a class="post-card-image-link" href="../zu-jian-tong-xun/index.html">

        <img class="post-card-image"
            srcset="../content/images/size/w600/2022/04/treecommunicate.jpg 600w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="../content/images/size/w600/2022/04/treecommunicate.jpg"
            alt="Component communication"
            loading="lazy"
        />


    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../zu-jian-tong-xun/index.html">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    ç»„ä»¶é€šè®¯
                </h2>
            </header>
                <div class="post-card-excerpt">Vuex|Redux|Pinia</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2021-10-01">Oct 1, 2021</time>
                <span class="post-card-meta-length">25 min read</span>
        </footer>

    </div>

</article>
                </div>
            </aside>



    </div>

    <footer class="site-footer outer">
        <div class="inner">
            <section class="copyright"><a href="../index.html">zairesinatra</a> &copy; 2022</section>
            <nav class="site-footer-nav">
                <ul><a href="https://beian.miit.gov.cn/" target="_blank">æ¹˜ICPå¤‡2021003061å·-1</a></ul>
                
            </nav>
            <div><a href="https://ghost.org/" target="_blank" rel="noopener">Powered by Ghost</a></div>
        </div>
    </footer>

</div>


<script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>
<script src="../assets/built/casper.js%3Fv=69401cbc3d"></script>
<script>
$(document).ready(function () {
    // Mobile Menu Trigger
    $('.gh-burger').click(function () {
        $('body').toggleClass('gh-head-open');
    });
    // FitVids - Makes video embeds responsive
    $(".gh-content").fitVids();
});
</script>

<!-- 2022 prismjs update -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/autoloader/prism-autoloader.min.js" onload="Prism.plugins.autoloader.languages_path='https://cdn.bootcss.com/prism/1.19.0/components/'"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-javascript.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-powershell.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-sql.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-jsx.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-java.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-less.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-sass.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-scss.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/toolbar/prism-toolbar.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
<script defer src="https://cdn.bootcss.com/prism/1.19.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>



<!-- music -->
<script src="http://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
<script src="http://cdn.jsdelivr.net/npm/meting@1.2.0/dist/Meting.min.js"></script>
<script>
	var meting_api='http://api.mizore.cn/meting/api.php?server=:server&type=:type&id=:id'
		$('.carousel').carousel({
			interval: 3000
		})
</script>
<!-- music -->
<!-- <div class="aplayer" data-id="7260570761" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false" data-volume="0.6" lrc-type="0"></div> -->
<!-- <a href="https://beian.miit.gov.cn/" target="_blank">æ¹˜ICPå¤‡2021003061å·-1</a> -->

<!-- searchinghost-easy -->
<script src="https://cdn.jsdelivr.net/gh/gmfmi/searchinghost-easy@latest/dist/searchinghost-easy-basic.js"></script>
<script>
    new SearchinGhostEasy({
        contentApiKey: 'e93d8b3520ae46be52c9a4b140'
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.18.2/tocbot.min.js"></script>
<script>
  tocbot.init({
    tocSelector: '.toc',
    contentSelector: '.gh-content',
    hasInnerContainers: true
  });
  var tc = document.querySelector(".toc-container");
var tch = tc.clientHeight;
var ah = document.querySelector(".article-header");
var ahh = ah.clientHeight;
window.addEventListener("scroll", function () {
if(document.body.clientWidth > 1170){
  var scrollY = document.documentElement.scrollTop || document.body.scrollTop;
  var ihh = window.innerHeight;
  if(scrollY >= ihh + tch + ahh){
    var ctc = document.querySelector(".toc-container");
    ctc.style.position="sticky";
    ctc.style.position="-webkit-sticky";
    ctc.style.top = "120px";
    ctc.style.marginLeft = "800px";
    ctc.style.minWidth= "260px";
  }
  if(scrollY < tch + ahh -10){
    var ctc = document.querySelector(".toc-container");
    ctc.style.position="";
    ctc.style.top = "";
    ctc.style.marginLeft = "";
    console.log("zszszs")
  }
}})
</script>
</body>
</html>
